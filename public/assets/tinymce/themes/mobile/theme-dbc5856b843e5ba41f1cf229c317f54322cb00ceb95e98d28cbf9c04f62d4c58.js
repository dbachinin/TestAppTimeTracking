!function(){"use strict";function r(n,e,t){var o=t||!1,r=function(){e(),o=!0},i=function(){n(),o=!1};return{on:r,off:i,toggle:function(){(o?i:r)()},isOn:function(){return o}}}function o(n,e,t,o,r){return n(t,o)?K.some(t):j.isFunction(r)&&r(t)?K.none():e(t,o,r)}function n(o,r){var n=function(n){var e=r(n);if(e<=0||null===e){var t=cu.get(n,o);return parseFloat(t)||0}return e},i=function(r,n){return Gn.foldl(n,function(n,e){var t=cu.get(r,e),o=t===undefined?0:parseInt(t,10);return isNaN(o)?n:n+o},0)};return{set:function(n,e){if(!j.isNumber(e)&&!e.match(/^[0-9]+$/))throw o+".set accepts only positive integer values. Value was "+e;var t=n.dom();tu.isSupported(t)&&(t.style[o]=e+"px")},get:n,getOuter:n,aggregate:i,max:function(n,e,t){var o=i(n,t);return o<e?e-o:0}}}function t(n,e){return u(document.createElement("canvas"),n,e)}function i(n){return n.getContext("2d")}function u(n,e,t){return n.width=e,n.height=t,n}function a(){return new(Qe.getOrDie("FileReader"))}function e(a){return new kf(function(n,e){function t(){u(),n(i)}function o(){u(),e("Unable to load data of type "+a.type+": "+r)}var r=URL.createObjectURL(a),i=new Image,u=function(){i.removeEventListener("load",t),i.removeEventListener("error",o)};i.addEventListener("load",t),i.addEventListener("error",o),i.src=r,i.complete&&t()})}function c(o){return new kf(function(n,t){var e=new XMLHttpRequest;e.open("GET",o,!0),e.responseType="blob",e.onload=function(){200==this.status&&n(this.response)},e.onerror=function(){var n,e=this;t(0===this.status?((n=new Error("No access to download image")).code=18,n.name="SecurityError",n):new Error("Error "+e.status+" downloading image"))},e.send()})}function s(n){var e=n.split(","),t=/data:([^;]+)/.exec(e[0]);if(!t)return K.none();for(var o,r,i,u=t[1],a=e[1],c=Cf.atob(a),s=c.length,f=Math.ceil(s/1024),l=new Array(f),d=0;d<f;++d){for(var m=1024*d,g=Math.min(m+1024,s),p=new Array(g-m),h=m,v=0;h<g;++v,++h)p[v]=c[h].charCodeAt(0);l[d]=(o=p,new(Qe.getOrDie("Uint8Array"))(o))}return K.some((r=l,i={type:u},new(Qe.getOrDie("Blob"))(r,i)))}function f(t){return new kf(function(n,e){s(t).fold(function(){e("uri is not base64: "+t)},n)})}function l(t){return new kf(function(n){var e=new a;e.onloadend=function(){n(e.result)},e.readAsDataURL(t)})}function O(){var e=function(n){var e=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:Cs('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+e+'"></div>'),tgroupBehaviours:pr([zf("adhoc-scrollable-toolbar",!0===n.scrollable?[Xo(function(n){cu.set(n.element(),"overflow-x","auto"),Ig.markAsHorizontal(n.element()),Vd.register(n.element())})]:[])]),components:[Uf.sketch({components:[Dg.parts().items({})]})],markers:{itemClass:Yi.resolve("toolbar-group-item")},items:n.items}},t=ed(Cg.sketch({dom:Cs('<div class="${prefix}-toolbar"></div>'),components:[Cg.parts().groups({})],toolbarBehaviours:pr([$i.config({toggleClass:Yi.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),vc.config({mode:"cyclic"})]),shell:!0})),n=ed(Uf.sketch({dom:{classes:[Yi.resolve("toolstrip")]},components:[td(t)],containerBehaviours:pr([$i.config({toggleClass:Yi.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),o=function(){Cg.setGroups(t,r.get()),$i.off(t)},r=Gr([]);return{wrapper:V.constant(n),toolbar:V.constant(t),createGroups:function(n){return Gn.map(n,V.compose(Dg.sketch,e))},setGroups:function(n){r.set(n),o()},setContextToolbar:function(n){$i.on(t),Cg.setGroups(t,n)},restoreToolbar:function(){$i.isOn(t)&&o()},refresh:function(){},focus:function(){vc.focusIn(t)}}}function d(){var i={};return{registerId:function(o,r,n){nn.each(n,function(n,e){var t=i[e]!==undefined?i[e]:{};t[r]=Vl(n,o),i[e]=t})},unregisterId:function(e){nn.each(i,function(n){n.hasOwnProperty(e)&&delete n[e]})},filterByType:function(n){return qt(i,n).map(function(n){return nn.mapToArray(n,function(n,e){return fp(e,n)})}).getOr([])},find:function(n,e,t){var r=Gt(e)(i);return cp(t,function(n){return t=r,ds(o=n).fold(function(){return K.none()},function(n){var e=Gt(n);return t.bind(e).map(function(n){return sp(o,n)})});var t,o},n)}}}function p(){var i=d(),u={},a=function(n){ds(n.element()).each(function(n){u[n]=undefined,i.unregisterId(n)})};return{find:function(n,e,t){return i.find(n,e,t)},filter:function(n){return i.filterByType(n)},register:function(n){var e,t,o=(t=(e=n).element(),ds(t).fold(function(){return ls("uid-",e.element())},function(n){return n}));Yt(u,o)&&function(n,e){var t=u[e];if(t!==n)throw new Error('The tagId "'+e+'" is already used by: '+di(t.element())+"\nCannot use it for: "+di(n.element())+"\nThe conflicting element is"+(Ge.inBody(t.element())?" ":" not ")+"already in the DOM");a(n)}(n,o);var r=[n];i.registerId(r,o,n.events()),u[o]=n},unregister:a,getById:function(n){return Gt(n)(u)}}}function E(n){var e=ed(Uf.sketch({dom:{classes:[Yi.resolve("outer-container")].concat(n.classes)},containerBehaviours:pr([Ur.config({alpha:dp(),omega:mp()})])}));return lp(e)}var m,g,h,v,b,y,w,x,S,T,k,C,D,M,A,B,R,I,F,N=function(n){return function(){return n}},V={noop:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e]},noarg:function(t){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t()}},compose:function(t,o){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return t(o.apply(null,arguments))}},constant:N,identity:function(n){return n},tripleEquals:function(n,e){return n===e},curry:function(i){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];for(var u=new Array(arguments.length-1),t=1;t<arguments.length;t++)u[t-1]=arguments[t];return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];for(var t=new Array(arguments.length),o=0;o<t.length;o++)t[o]=arguments[o];var r=u.concat(t);return i.apply(null,r)}},not:function(t){return function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return!t.apply(null,arguments)}},die:function(n){return function(){throw new Error(n)}},apply:function(n){return n()},call:function(n){n()},never:N(!1),always:N(!0)},H=function(e){return function(n){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&Array.prototype.isPrototypeOf(n)?"array":"object"===e&&String.prototype.isPrototypeOf(n)?"string":e}(n)===e}},j={isString:H("string"),isObject:H("object"),isArray:H("array"),isNull:H("null"),isBoolean:H("boolean"),isUndefined:H("undefined"),isFunction:H("function"),isNumber:H("number")},z=function(u){return function(){for(var n=new Array(arguments.length),e=0;e<n.length;e++)n[e]=arguments[e];if(0===n.length)throw new Error("Can't merge zero objects");for(var t={},o=0;o<n.length;o++){var r=n[o];for(var i in r)r.hasOwnProperty(i)&&(t[i]=u(t[i],r[i]))}return t}},L=z(function(n,e){return j.isObject(n)&&j.isObject(e)?L(n,e):e}),P=z(function(n,e){return e}),W={deepMerge:L,merge:P},U=V.never,G=V.always,$=function(){return q},q=(v={fold:function(n){return n()},is:U,isSome:U,isNone:G,getOr:h=function(n){return n},getOrThunk:g=function(n){return n()},getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},or:h,orThunk:g,map:$,ap:$,each:function(){},bind:$,flatten:$,exists:U,forall:G,filter:$,equals:m=function(n){return n.isNone()},equals_:m,toArray:function(){return[]},toString:V.constant("none()")},Object.freeze&&Object.freeze(v),v),_=function(t){var n=function(){return t},e=function(){return r},o=function(n){return n(t)},r={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:G,isNone:U,getOr:n,getOrThunk:n,getOrDie:n,or:e,orThunk:e,map:function(n){return _(n(t))},ap:function(n){return n.fold($,function(n){return _(n(t))})},each:function(n){n(t)},bind:o,flatten:n,exists:o,forall:o,filter:function(n){return n(t)?r:q},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(U,function(n){return e(t,n)})},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return r},K={some:_,none:$,from:function(n){return null===n||n===undefined?q:_(n)}},X=(b=Object.keys)===undefined?function(n){var e=[];for(var t in n)n.hasOwnProperty(t)&&e.push(t);return e}:b,Y=function(n,e){for(var t=X(n),o=0,r=t.length;o<r;o++){var i=t[o];e(n[i],i,n)}},J=function(o,r){var i={};return Y(o,function(n,e){var t=r(n,e,o);i[t.k]=t.v}),i},Q=function(n,t){var o=[];return Y(n,function(n,e){o.push(t(n,e))}),o},Z=function(n){return Q(n,function(n){return n})},nn={bifilter:function(n,t){var o={},r={};return Y(n,function(n,e){(t(n,e)?o:r)[e]=n}),{t:o,f:r}},each:Y,map:function(n,o){return J(n,function(n,e,t){return{k:e,v:o(n,e,t)}})},mapToArray:Q,tupleMap:J,find:function(n,e){for(var t=X(n),o=0,r=t.length;o<r;o++){var i=t[o],u=n[i];if(e(u,i,n))return K.some(u)}return K.none()},keys:X,values:Z,size:function(n){return Z(n).length}},en=(V.constant("contextmenu"),V.constant("touchstart")),tn=V.constant("touchmove"),on=V.constant("touchend"),rn=(V.constant("gesturestart"),V.constant("mousedown")),un=V.constant("mousemove"),an=(V.constant("mouseout"),V.constant("mouseup")),cn=V.constant("mouseover"),sn=(V.constant("focusin"),V.constant("keydown")),fn=V.constant("input"),ln=V.constant("change"),dn=(V.constant("focus"),V.constant("click")),mn=V.constant("transitionend"),gn=V.constant("selectstart"),pn=function(n){var e,t=!1;return function(){return t||(t=!0,e=n.apply(null,arguments)),e}},hn=function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var o=n[t];if(o.test(e))return o}return undefined}(n,e);if(!t)return{major:0,minor:0};var o=function(n){return Number(e.replace(t,"$"+n))};return bn(o(1),o(2))},vn=function(){return bn(0,0)},bn=function(n,e){return{major:n,minor:e}},yn={nu:bn,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?vn():hn(n,t)},unknown:vn},wn="Firefox",xn=function(n,e){return function(){return e===n}},Sn=function(n){var e=n.current;return{current:e,version:n.version,isEdge:xn("Edge",e),isChrome:xn("Chrome",e),isIE:xn("IE",e),isOpera:xn("Opera",e),isFirefox:xn(wn,e),isSafari:xn("Safari",e)}},Tn={unknown:function(){return Sn({current:undefined,version:yn.unknown()})},nu:Sn,edge:V.constant("Edge"),chrome:V.constant("Chrome"),ie:V.constant("IE"),opera:V.constant("Opera"),firefox:V.constant(wn),safari:V.constant("Safari")},kn="Windows",Cn="Android",On="Solaris",En="FreeBSD",Dn=function(n,e){return function(){return e===n}},Mn=function(n){var e=n.current;return{current:e,version:n.version,isWindows:Dn(kn,e),isiOS:Dn("iOS",e),isAndroid:Dn(Cn,e),isOSX:Dn("OSX",e),isLinux:Dn("Linux",e),isSolaris:Dn(On,e),isFreeBSD:Dn(En,e)}},An={unknown:function(){return Mn({current:undefined,version:yn.unknown()})},nu:Mn,windows:V.constant(kn),ios:V.constant("iOS"),android:V.constant(Cn),linux:V.constant("Linux"),osx:V.constant("OSX"),solaris:V.constant(On),freebsd:V.constant(En)},Bn=(y=Array.prototype.indexOf)===undefined?function(n,e){return jn(n,e)}:function(n,e){return y.call(n,e)},Rn=function(n,e){return-1<Bn(n,e)},In=function(n,e){for(var t=n.length,o=new Array(t),r=0;r<t;r++){var i=n[r];o[r]=e(i,r,n)}return o},Fn=function(n,e){for(var t=0,o=n.length;t<o;t++)e(n[t],t,n)},Nn=function(n,e){for(var t=n.length-1;0<=t;t--)e(n[t],t,n)},Vn=function(n,e){for(var t=[],o=0,r=n.length;o<r;o++){var i=n[o];e(i,o,n)&&t.push(i)}return t},Hn=function(n,e){for(var t=0,o=n.length;t<o;t++)if(e(n[t],t,n))return K.some(t);return K.none()},jn=function(n,e){for(var t=0,o=n.length;t<o;++t)if(n[t]===e)return t;return-1},zn=Array.prototype.push,Ln=function(n){for(var e=[],t=0,o=n.length;t<o;++t){if(!Array.prototype.isPrototypeOf(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);zn.apply(e,n[t])}return e},Pn=function(n,e){for(var t=0,o=n.length;t<o;++t)if(!0!==e(n[t],t,n))return!1;return!0},Wn=Array.prototype.slice,Un=j.isFunction(Array.from)?Array.from:function(n){return Wn.call(n)},Gn={map:In,each:Fn,eachr:Nn,partition:function(n,e){for(var t=[],o=[],r=0,i=n.length;r<i;r++){var u=n[r];(e(u,r,n)?t:o).push(u)}return{pass:t,fail:o}},filter:Vn,groupBy:function(n,e){if(0===n.length)return[];for(var t=e(n[0]),o=[],r=[],i=0,u=n.length;i<u;i++){var a=n[i],c=e(a);c!==t&&(o.push(r),r=[]),t=c,r.push(a)}return 0!==r.length&&o.push(r),o},indexOf:function(n,e){var t=Bn(n,e);return-1===t?K.none():K.some(t)},foldr:function(n,e,t){return Nn(n,function(n){t=e(t,n)}),t},foldl:function(n,e,t){return Fn(n,function(n){t=e(t,n)}),t},find:function(n,e){for(var t=0,o=n.length;t<o;t++){var r=n[t];if(e(r,t,n))return K.some(r)}return K.none()},findIndex:Hn,flatten:Ln,bind:function(n,e){var t=In(n,e);return Ln(t)},forall:Pn,exists:function(n,e){return Hn(n,e).isSome()},contains:Rn,equal:function(n,t){return n.length===t.length&&Pn(n,function(n,e){return n===t[e]})},reverse:function(n){var e=Wn.call(n,0);return e.reverse(),e},chunk:function(n,e){for(var t=[],o=0;o<n.length;o+=e){var r=n.slice(o,o+e);t.push(r)}return t},difference:function(n,e){return Vn(n,function(n){return!Rn(e,n)})},mapToObject:function(n,e){for(var t={},o=0,r=n.length;o<r;o++){var i=n[o];t[String(i)]=e(i,o)}return t},pure:function(n){return[n]},sort:function(n,e){var t=Wn.call(n,0);return t.sort(e),t},range:function(n,e){for(var t=[],o=0;o<n;o++)t.push(e(o));return t},head:function(n){return 0===n.length?K.none():K.some(n[0])},last:function(n){return 0===n.length?K.none():K.some(n[n.length-1])},from:Un},$n=function(n,e){var t=String(e).toLowerCase();return Gn.find(n,function(n){return n.search(t)})},qn=function(n,t){return $n(n,t).map(function(n){var e=yn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},_n=function(n,t){return $n(n,t).map(function(n){var e=yn.detect(n.versionRegexes,t);return{current:n.name,version:e}})},Kn=function(n,e){return e+n},Xn=function(n,e){return n+e},Yn=function(n,e){return n.substring(e)},Jn=function(n,e){return n.substring(0,n.length-e)},Qn=function(n){return""===n?K.none():K.some(n.substr(0,1))},Zn=function(n){return""===n?K.none():K.some(n.substring(1))},ne=function(n,e,t){return""===e||!(n.length<e.length)&&n.substr(t,t+e.length)===e},ee=function(n,e){return ne(n,e,0)},te=function(n,e){return ne(n,e,n.length-e.length)},oe={supplant:function(n,r){return n.replace(/\${([^{}]*)}/g,function(n,e){var t,o=r[e];return"string"==(t=typeof o)||"number"===t?o:n})},startsWith:ee,removeLeading:function(n,e){return ee(n,e)?Yn(n,e.length):n},removeTrailing:function(n,e){return te(n,e)?Jn(n,e.length):n},ensureLeading:function(n,e){return ee(n,e)?n:Kn(n,e)},ensureTrailing:function(n,e){return te(n,e)?n:Xn(n,e)},endsWith:te,contains:function(n,e){return-1!==n.indexOf(e)},trim:function(n){return n.replace(/^\s+|\s+$/g,"")},lTrim:function(n){return n.replace(/^\s+/g,"")},rTrim:function(n){return n.replace(/\s+$/g,"")},capitalize:function(n){return Qn(n).bind(function(e){return Zn(n).map(function(n){return e.toUpperCase()+n})}).getOr(n)}},re=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,ie=function(e){return function(n){return oe.contains(n,e)}},ue=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return oe.contains(n,"edge/")&&oe.contains(n,"chrome")&&oe.contains(n,"safari")&&oe.contains(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,re],search:function(n){return oe.contains(n,"chrome")&&!oe.contains(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return oe.contains(n,"msie")||oe.contains(n,"trident")}},{name:"Opera",versionRegexes:[re,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:ie("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:ie("firefox")},{name:"Safari",versionRegexes:[re,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(oe.contains(n,"safari")||oe.contains(n,"mobile/"))&&oe.contains(n,"applewebkit")}}],ae=[{name:"Windows",search:ie("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return oe.contains(n,"iphone")||oe.contains(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:ie("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:ie("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:ie("linux"),versionRegexes:[]},{name:"Solaris",search:ie("sunos"),versionRegexes:[]},{name:"FreeBSD",search:ie("freebsd"),versionRegexes:[]}],ce={browsers:V.constant(ue),oses:V.constant(ae)},se=function(n){var e,t,o,r,i,u,a,c,s,f,l,d=ce.browsers(),m=ce.oses(),g=qn(d,n).fold(Tn.unknown,Tn.nu),p=_n(m,n).fold(An.unknown,An.nu);return{browser:g,os:p,deviceType:(t=g,o=n,r=(e=p).isiOS()&&!0===/ipad/i.test(o),i=e.isiOS()&&!r,u=e.isAndroid()&&3===e.version.major,a=e.isAndroid()&&4===e.version.major,c=r||u||a&&!0===/mobile/i.test(o),s=e.isiOS()||e.isAndroid(),f=s&&!c,l=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(o),{isiPad:V.constant(r),isiPhone:V.constant(i),isTablet:V.constant(c),isPhone:V.constant(f),isTouch:V.constant(s),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:V.constant(l)})}},fe={detect:pn(function(){var n=navigator.userAgent;return se(n)})},le={tap:V.constant("alloy.tap")},de=V.constant("alloy.focus"),me=V.constant("alloy.blur.post"),ge=V.constant("alloy.receive"),pe=V.constant("alloy.execute"),he=V.constant("alloy.focus.item"),ve=le.tap,be=fe.detect().deviceType.isTouch()?le.tap:dn,ye=V.constant("alloy.longpress"),we=(V.constant("alloy.sandbox.close"),V.constant("alloy.system.init")),xe=V.constant("alloy.system.scroll"),Se=V.constant("alloy.system.attached"),Te=V.constant("alloy.system.detached"),ke=(V.constant("alloy.change.tab"),V.constant("alloy.dismiss.tab"),function(n,e){De(n,n.element(),e,{})}),Ce=function(n,e,t){De(n,n.element(),e,t)},Oe=function(n){ke(n,pe())},Ee=function(n,e,t){De(n,e,t,{})},De=function(n,e,t,o){var r=W.deepMerge({target:e},o);n.getSystem().triggerEvent(t,e,nn.map(r,V.constant))},Me=function(n){if(null===n||n===undefined)throw new Error("Node cannot be null or undefined");return{dom:V.constant(n)}},Ae={fromHtml:function(n,e){var t=(e||document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return Me(t.childNodes[0])},fromTag:function(n,e){var t=(e||document).createElement(n);return Me(t)},fromText:function(n,e){var t=(e||document).createTextNode(n);return Me(t)},fromDom:Me,fromPoint:function(n,e,t){return K.from(n.dom().elementFromPoint(e,t)).map(Me)}},Be=8,Re=9,Ie=1,Fe=3,Ne=function(n){return n.dom().nodeName.toLowerCase()},Ve=function(n){return n.dom().nodeType},He=function(e){return function(n){return Ve(n)===e}},je=He(Ie),ze=He(Fe),Le=He(Re),Pe={name:Ne,type:Ve,value:function(n){return n.dom().nodeValue},isElement:je,isText:ze,isDocument:Le,isComment:function(n){return Ve(n)===Be||"#comment"===Ne(n)}},We=pn(function(){return Ue(Ae.fromDom(document))}),Ue=function(n){var e=n.dom().body;if(null===e||e===undefined)throw"Body is not available yet";return Ae.fromDom(e)},Ge={body:We,getBody:Ue,inBody:function(n){var e=Pe.isText(n)?n.dom().parentNode:n.dom();return e!==undefined&&null!==e&&e.ownerDocument.body.contains(e)}},$e=function(n){return n.slice(0).sort()},qe={sort:$e,reqMessage:function(n,e){throw new Error("All required keys ("+$e(n).join(", ")+") were not specified. Specified keys were: "+$e(e).join(", ")+".")},unsuppMessage:function(n){throw new Error("Unsupported keys for object: "+$e(n).join(", "))},validateStrArr:function(e,n){if(!j.isArray(n))throw new Error("The "+e+" fields must be an array. Was: "+n+".");Gn.each(n,function(n){if(!j.isString(n))throw new Error("The value "+n+" in the "+e+" fields was not a string.")})},invalidTypeMessage:function(n,e){throw new Error("All values need to be of type: "+e+". Keys ("+$e(n).join(", ")+") were not.")},checkDupes:function(n){var t=$e(n);Gn.find(t,function(n,e){return e<t.length-1&&n===t[e+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+t.join(", ")+"].")})}},_e={immutable:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(e.length!==t.length)throw new Error('Wrong number of arguments to struct. Expected "['+e.length+']", got '+t.length+" arguments");var o={};return Gn.each(e,function(n,e){o[n]=V.constant(t[e])}),o}},immutableBag:function(r,i){var u=r.concat(i);if(0===u.length)throw new Error("You must specify at least one required or optional field.");return qe.validateStrArr("required",r),qe.validateStrArr("optional",i),qe.checkDupes(u),function(e){var t=nn.keys(e);Gn.forall(r,function(n){return Gn.contains(t,n)})||qe.reqMessage(r,t);var n=Gn.filter(t,function(n){return!Gn.contains(u,n)});0<n.length&&qe.unsuppMessage(n);var o={};return Gn.each(r,function(n){o[n]=V.constant(e[n])}),Gn.each(i,function(n){o[n]=V.constant(Object.prototype.hasOwnProperty.call(e,n)?K.some(e[n]):K.none())}),o}}},Ke=function(n,e){for(var t=[],o=function(n){return t.push(n),e(n)},r=e(n);(r=r.bind(o)).isSome(););return t},Xe="undefined"!=typeof window?window:Function("return this;")(),Ye=function(n,e){for(var t=e!==undefined&&null!==e?e:Xe,o=0;o<n.length&&t!==undefined&&null!==t;++o)t=t[n[o]];return t},Je=function(n,e){var t=n.split(".");return Ye(t,e)},Qe={getOrDie:function(n,e){var t=Je(n,e);if(t===undefined||null===t)throw n+" not available on this browser";return t}},Ze=Ie,nt=Re,et=function(n){return n.nodeType!==Ze&&n.nodeType!==nt||0===n.childElementCount},tt={all:function(n,e){var t=e===undefined?document:e.dom();return et(t)?[]:Gn.map(t.querySelectorAll(n),Ae.fromDom)},is:function(n,e){var t=n.dom();if(t.nodeType!==Ze)return!1;if(t.matches!==undefined)return t.matches(e);if(t.msMatchesSelector!==undefined)return t.msMatchesSelector(e);if(t.webkitMatchesSelector!==undefined)return t.webkitMatchesSelector(e);if(t.mozMatchesSelector!==undefined)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},one:function(n,e){var t=e===undefined?document:e.dom();return et(t)?K.none():K.from(t.querySelector(n)).map(Ae.fromDom)}},ot=function(n,e){return n.dom()===e.dom()},rt=(fe.detect().browser.isIE(),ot),it=function(n){return Ae.fromDom(n.dom().ownerDocument)},ut=function(n){var e=n.dom();return K.from(e.parentNode).map(Ae.fromDom)},at=function(n){var e=n.dom();return K.from(e.previousSibling).map(Ae.fromDom)},ct=function(n){var e=n.dom();return K.from(e.nextSibling).map(Ae.fromDom)},st=function(n){var e=n.dom();return Gn.map(e.childNodes,Ae.fromDom)},ft=function(n,e){var t=n.dom().childNodes;return K.from(t[e]).map(Ae.fromDom)},lt=_e.immutable("element","offset"),dt={owner:it,defaultView:function(n){var e=n.dom().ownerDocument.defaultView;return Ae.fromDom(e)},documentElement:function(n){var e=it(n);return Ae.fromDom(e.dom().documentElement)},parent:ut,findIndex:function(t){return ut(t).bind(function(n){var e=st(n);return Gn.findIndex(e,function(n){return rt(t,n)})})},parents:function(n,e){for(var t=j.isFunction(e)?e:V.constant(!1),o=n.dom(),r=[];null!==o.parentNode&&o.parentNode!==undefined;){var i=o.parentNode,u=Ae.fromDom(i);if(r.push(u),!0===t(u))break;o=i}return r},siblings:function(e){return ut(e).map(st).map(function(n){return Gn.filter(n,function(n){return!rt(e,n)})}).getOr([])},prevSibling:at,offsetParent:function(n){var e=n.dom();return K.from(e.offsetParent).map(Ae.fromDom)},prevSiblings:function(n){return Gn.reverse(Ke(n,at))},nextSibling:ct,nextSiblings:function(n){return Ke(n,ct)},children:st,child:ft,firstChild:function(n){return ft(n,0)},lastChild:function(n){return ft(n,n.dom().childNodes.length-1)},childNodesCount:function(n){return n.dom().childNodes.length},hasChildNodes:function(n){return n.dom().hasChildNodes()},leaf:function(n,e){var t=st(n);return 0<t.length&&e<t.length?lt(t[e],0):lt(n,e)}},mt=function(e,t){dt.parent(e).each(function(n){n.dom().insertBefore(t.dom(),e.dom())})},gt=function(n,e){n.dom().appendChild(e.dom())},pt={before:mt,after:function(n,e){dt.nextSibling(n).fold(function(){dt.parent(n).each(function(n){gt(n,e)})},function(n){mt(n,e)})},prepend:function(e,t){dt.firstChild(e).fold(function(){gt(e,t)},function(n){e.dom().insertBefore(t.dom(),n.dom())})},append:gt,appendAt:function(n,e,t){dt.child(n,t).fold(function(){gt(n,e)},function(n){mt(n,e)})},wrap:function(n,e){mt(n,e),gt(e,n)}},ht={before:function(e,n){Gn.each(n,function(n){pt.before(e,n)})},after:function(o,r){Gn.each(r,function(n,e){var t=0===e?o:r[e-1];pt.after(t,n)})},prepend:function(e,n){Gn.each(n.slice().reverse(),function(n){pt.prepend(e,n)})},append:function(e,n){Gn.each(n,function(n){pt.append(e,n)})}},vt=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},bt={empty:function(n){n.dom().textContent="",Gn.each(dt.children(n),function(n){vt(n)})},remove:vt,unwrap:function(n){var e=dt.children(n);0<e.length&&ht.before(n,e),vt(n)}},yt=function(n){ke(n,Te());var e=n.components();Gn.each(e,yt)},wt=function(n){var e=n.components();Gn.each(e,wt),ke(n,Se())},xt=function(n,e){St(n,e,pt.append)},St=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),Ge.inBody(n.element())&&wt(e),n.syncComponents()},Tt=function(n){yt(n),bt.remove(n.element()),n.getSystem().removeFromWorld(n)},kt=function(e){var n=dt.parent(e.element()).bind(function(n){return e.getSystem().getByDom(n).fold(K.none,K.some)});Tt(e),n.each(function(n){n.syncComponents()})},Ct=function(t){return{is:function(n){return t===n},isValue:V.always,isError:V.never,getOr:V.constant(t),getOrThunk:V.constant(t),getOrDie:V.constant(t),or:function(){return Ct(t)},orThunk:function(){return Ct(t)},fold:function(n,e){return e(t)},map:function(n){return Ct(n(t))},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return K.some(t)}}},Ot=function(e){return{is:V.never,isValue:V.never,isError:V.always,getOr:V.identity,getOrThunk:function(n){return n()},getOrDie:function(){return V.die(String(e))()},or:function(n){return n},orThunk:function(n){return n()},fold:function(n){return n(e)},map:function(){return Ot(e)},each:V.noop,bind:function(){return Ot(e)},exists:V.never,forall:V.always,toOption:K.none}},Et={value:Ct,error:Ot},Dt=function(u){if(!j.isArray(u))throw new Error("cases must be an array");if(0===u.length)throw new Error("there must be at least one case");var a=[],t={};return Gn.each(u,function(n,o){var e=nn.keys(n);if(1!==e.length)throw new Error("one and only one name per case");var r=e[0],i=n[r];if(t[r]!==undefined)throw new Error("duplicate key detected:"+r);if("cata"===r)throw new Error("cannot have a case named cata (sorry)");if(!j.isArray(i))throw new Error("case arguments must be an array");a.push(r),t[r]=function(){var n=arguments.length;if(n!==i.length)throw new Error("Wrong number of arguments to case "+r+". Expected "+i.length+" ("+i+"), got "+n);for(var t=new Array(n),e=0;e<t.length;e++)t[e]=arguments[e];return{fold:function(){if(arguments.length!==u.length)throw new Error("Wrong number of arguments to fold. Expected "+u.length+", got "+arguments.length);return arguments[o].apply(null,t)},match:function(n){var e=nn.keys(n);if(a.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+a.join(",")+"\nActual: "+e.join(","));if(!Gn.forall(a,function(n){return Gn.contains(e,n)}))throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+a.join(", "));return n[r].apply(null,t)},log:function(n){console.log(n,{constructors:a,constructor:r,params:t})}}}}),t},Mt=Dt([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),At=function(n){return Mt.defaultedThunk(V.constant(n))},Bt=Mt.strict,Rt=Mt.asOption,It=Mt.defaultedThunk,Ft=(Mt.asDefaultedOptionThunk,Mt.mergeWithThunk),Nt=(Dt([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var e=[],t=[];return Gn.each(n,function(n){n.fold(function(n){e.push(n)},function(n){t.push(n)})}),{errors:e,values:t}}),Vt=function(n){return V.compose(Et.error,Gn.flatten)(n)},Ht=function(n,e){var t,o,r=Nt(n);return 0<r.errors.length?Vt(r.errors):(t=r.values,o=e,Et.value(W.deepMerge.apply(undefined,[o].concat(t))))},jt=function(n){var e=Nt(n);return 0<e.errors.length?Vt(e.errors):Et.value(e.values)},zt=function(e){return function(n){return n.hasOwnProperty(e)?K.from(n[e]):K.none()}},Lt=function(n,e){return zt(e)(n)},Pt=function(n,e){var t={};return t[n]=e,t},Wt=function(n,e){return t=n,o=e,r={},Gn.each(o,function(n){t[n]!==undefined&&t.hasOwnProperty(n)&&(r[n]=t[n])}),r;var t,o,r},Ut=function(n,e){return t=n,o=e,r={},nn.each(t,function(n,e){Gn.contains(o,e)||(r[e]=n)}),r;var t,o,r},Gt=function(n){return zt(n)},$t=function(n,e){return t=n,o=e,function(n){return zt(t)(n).getOr(o)};var t,o},qt=function(n,e){return Lt(n,e)},_t=function(n,e){return Pt(n,e)},Kt=function(n){return e=n,t={},Gn.each(e,function(n){t[n.key]=n.value}),t;var e,t},Xt=function(n,e){return Ht(n,e)},Yt=function(n,e){return o=e,(t=n).hasOwnProperty(o)&&t[o]!==undefined&&null!==t[o];var t,o},Jt=Dt([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]},{thunk:["description"]},{func:["args","outputSchema"]}]),Qt=Dt([{field:["name","presence","type"]},{state:["name"]}]),Zt=function(){return Qe.getOrDie("JSON")},no=function(n,e,t){return Zt().stringify(n,e,t)},eo=function(n){return j.isObject(n)&&100<nn.keys(n).length?" removed due to size":no(n,null,2)},to=function(n,e){return Et.error([{path:n,getErrorInfo:e}])},oo=Dt([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),ro=function(t,o,r){return Lt(o,r).fold(function(){return n=r,e=o,to(t,function(){return'Could not find valid *strict* value for "'+n+'" in '+eo(e)});var n,e},Et.value)},io=function(n,e,t){var o=Lt(n,e).fold(function(){return t(n)},V.identity);return Et.value(o)},uo=function(r,a,n,c){return n.fold(function(i,e,n,t){var o=function(n){return t.extract(r.concat([i]),c,n).map(function(n){return Pt(e,c(n))})},u=function(n){return n.fold(function(){var n=Pt(e,c(K.none()));return Et.value(n)},function(n){return t.extract(r.concat([i]),c,n).map(function(n){return Pt(e,c(K.some(n)))})})};return n.fold(function(){return ro(r,a,i).bind(o)},function(n){return io(a,i,n).bind(o)},function(){return(n=a,e=i,Et.value(Lt(n,e))).bind(u);var n,e},function(n){return(e=a,t=i,o=n,r=Lt(e,t).map(function(n){return!0===n?o(e):n}),Et.value(r)).bind(u);var e,t,o,r},function(n){var e=n(a);return io(a,i,V.constant({})).map(function(n){return W.deepMerge(e,n)}).bind(o)})},function(n,e){var t=e(a);return Et.value(Pt(n,c(t)))})},ao=function(o){return{extract:function(t,n,e){return o(e,n).fold(function(n){return e=n,to(t,function(){return e});var e},Et.value)},toString:function(){return"val"},toDsl:function(){return Jt.itemOf(o)}}},co=function(n){var c=so(n),s=Gn.foldr(n,function(e,n){return n.fold(function(n){return W.deepMerge(e,_t(n,!0))},V.constant(e))},{});return{extract:function(n,e,t){var o,r,i,u=j.isBoolean(t)?[]:(o=t,r=nn.keys(o),Gn.filter(r,function(n){return Yt(o,n)})),a=Gn.filter(u,function(n){return!Yt(s,n)});return 0===a.length?c.extract(n,e,t):(i=a,to(n,function(){return"There are unsupported fields: ["+i.join(", ")+"] specified"}))},toString:c.toString,toDsl:c.toDsl}},so=function(c){return{extract:function(n,e,t){return o=n,r=t,i=c,u=e,a=Gn.map(i,function(n){return uo(o,r,n,u)}),Ht(a,{});var o,r,i,u,a},toString:function(){return"obj{\n"+Gn.map(c,function(n){return n.fold(function(n,e,t,o){return n+" -> "+o.toString()},function(n){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return Jt.objOf(Gn.map(c,function(n){return n.fold(function(n,e,t,o){return Qt.field(n,t,o)},function(n){return Qt.state(n)})}))}}},fo=function(r){return{extract:function(t,o,n){var e=Gn.map(n,function(n,e){return r.extract(t.concat(["["+e+"]"]),o,n)});return jt(e)},toString:function(){return"array("+r.toString()+")"},toDsl:function(){return Jt.arrOf(r)}}},lo=function(u,a){return{extract:function(t,o,r){var n,e,i=nn.keys(r);return(n=t,e=i,fo(ao(u)).extract(n,V.identity,e)).bind(function(n){var e=Gn.map(n,function(n){return oo.field(n,n,Bt(),a)});return so(e).extract(t,o,r)})},toString:function(){return"setOf("+a.toString()+")"},toDsl:function(){return Jt.setOf(u,a)}}},mo=V.constant(ao(Et.value)),go=(V.compose(fo,so),oo.state),po=oo.field,ho=function(t,e,o,r,i){return qt(r,i).fold(function(){return n=r,e=i,to(t,function(){
return'The chosen schema: "'+e+'" did not exist in branches: '+eo(n)});var n,e},function(n){return so(n).extract(t.concat(["branch: "+i]),e,o)})},vo=function(r,i){return{extract:function(e,t,o){return qt(o,r).fold(function(){return n=r,to(e,function(){return'Choice schema did not contain choice key: "'+n+'"'});var n},function(n){return ho(e,t,o,i,n)})},toString:function(){return"chooseOn("+r+"). Possible values: "+nn.keys(i)},toDsl:function(){return Jt.choiceOf(r,i)}}},bo=ao(Et.value),yo=function(n,e,t,o){return e.extract([n],t,o).fold(function(n){return Et.error({input:o,errors:n})},Et.value)},wo=function(n,e,t){return yo(n,e,V.constant,t)},xo=function(n){return n.fold(function(n){throw new Error(ko(n))},V.identity)},So=function(n,e,t){return xo((o=t,yo(n,e,V.identity,o)));var o},To=function(n,e,t){return xo(wo(n,e,t))},ko=function(n){return"Errors: \n"+(t=10<(e=n.errors).length?e.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):e,Gn.map(t,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()}))+"\n\nInput object: "+eo(n.input);var e,t},Co=function(n,e){return vo(n,e)},Oo=V.constant(bo),Eo=(w=j.isFunction,x="function",ao(function(n){var e=typeof n;return w(n)?Et.value(n):Et.error("Expected type: "+x+" but got: "+e)})),Do=function(n){return po(n,n,Bt(),mo())},Mo=function(n,e){return po(n,n,Bt(),e)},Ao=function(n){return Mo(n,Eo)},Bo=function(n,e){return po(n,n,Bt(),so(e))},Ro=function(n){return po(n,n,Rt(),mo())},Io=function(n,e){return po(n,n,Rt(),so(e))},Fo=function(n,e){return po(n,n,Rt(),co(e))},No=function(n,e){return po(n,n,At(e),mo())},Vo=function(n,e,t){return po(n,n,At(e),t)},Ho=function(n,e){return go(n,e)},jo=function(n){if(!Yt(n,"can")&&!Yt(n,"abort")&&!Yt(n,"run"))throw new Error("EventHandler defined by: "+no(n,null,2)+" does not have can, abort, or run!");return So("Extracting event.handler",co([No("can",V.constant(!0)),No("abort",V.constant(!1)),No("run",V.noop)]),n)},zo=function(n){var e,o,r,i,t=(e=n,o=function(n){return n.can},function(){var t=Array.prototype.slice.call(arguments,0);return Gn.foldl(e,function(n,e){return n&&o(e).apply(undefined,t)},!0)}),u=(r=n,i=function(n){return n.abort},function(){var t=Array.prototype.slice.call(arguments,0);return Gn.foldl(r,function(n,e){return n||i(e).apply(undefined,t)},!1)});return jo({can:t,abort:u,run:function(){var e=Array.prototype.slice.call(arguments,0);Gn.each(n,function(n){n.run.apply(undefined,e)})}})},Lo=Kt,Po=function(n,e){return{key:n,value:jo({abort:e})}},Wo=function(n,e){return{key:n,value:jo({run:e})}},Uo=function(n,e,t){return{key:n,value:jo({run:function(n){e.apply(undefined,[n].concat(t))}})}},Go=function(n){return function(o){return{key:n,value:jo({run:function(n,e){var t;t=e,rt(n.element(),t.event().target())&&o(n,e)}})}}},$o=function(n,e,t){var u,o,r=e.partUids()[t];return o=r,Wo(u=n,function(n,i){n.getSystem().getByUid(o).each(function(n){var e,t,o,r;t=(e=n).element(),o=u,r=i,e.getSystem().triggerEvent(o,t,r.event())})})},qo=function(n){return Wo(n,function(n,e){e.cut()})},_o=Go(Se()),Ko=Go(Te()),Xo=Go(we()),Yo=(S=pe(),function(n){return Wo(S,n)}),Jo=function(n){return Gn.map(n,function(n){return oe.endsWith(n,"/*")?n.substring(0,n.length-"/*".length):n})},Qo=function(n,e){var t=n.toString(),o=t.indexOf(")")+1,r=t.indexOf("("),i=t.substring(r+1,o-1).split(/,\s*/);return n.toFunctionAnnotation=function(){return{name:e,parameters:Jo(i)}},n},Zo=_e.immutableBag(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),nr=function(n){return{tag:n.tag(),classes:n.classes().getOr([]),attributes:n.attributes().getOr({}),styles:n.styles().getOr({}),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().getOr("<none>"),domChildren:n.domChildren().fold(function(){return"<none>"},function(n){return 0===n.length?"0 children, but still specified":String(n.length)})}},er=_e.immutableBag([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),tr=function(e,n,t){return n.fold(function(){return t.fold(function(){return{}},function(n){return _t(e,n)})},function(n){return t.fold(function(){return _t(e,n)},function(n){return _t(e,n)})})},or=function(e,t,o){return Xo(function(n){o(n,e,t)})},rr=function(n,e,t,o,r,i){var u,a,c=n,s=Io(e,[(u="config",a=n,po(u,u,Rt(),a))]);return ar(c,s,e,t,o,r,i)},ir=function(n,r,e){var t,o,i,u,a,c;return t=function(t){var o=arguments;return t.config({name:V.constant(n)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+n+". Using API: "+e)},function(n){var e=Array.prototype.slice.call(o,1);return r.apply(undefined,[t,n.config,n.state].concat(e))})},o=e,u=(i=r.toString()).indexOf(")")+1,a=i.indexOf("("),c=i.substring(a+1,u-1).split(/,\s*/),t.toFunctionAnnotation=function(){return{name:o,parameters:Jo(c.slice(0,1).concat(c.slice(3)))}},t},ur=function(n){return{key:n,value:undefined}},ar=function(t,n,o,r,e,i,u){var a=function(n){return Yt(n,o)?n[o]():K.none()},c=nn.map(e,function(n,e){return ir(o,n,e)}),s=nn.map(i,function(n,e){return Qo(n,e)}),f=W.deepMerge(s,c,{revoke:V.curry(ur,o),config:function(n){var e=To(o+"-config",t,n);return{key:o,value:{config:e,me:f,configAsRaw:pn(function(){return So(o+"-config",t,n)}),initialConfig:n,state:u}}},schema:function(){return n},exhibit:function(n,t){return a(n).bind(function(e){return qt(r,"exhibit").map(function(n){return n(t,e.config,e.state)})}).getOr(er({}))},name:function(){return o},handlers:function(n){return a(n).bind(function(e){return qt(r,"events").map(function(n){return n(e.config,e.state)})}).getOr({})}});return f},cr=function(n,e){return sr(n,e,{validate:j.isFunction,label:"function"})},sr=function(o,r,i){if(0===r.length)throw new Error("You must specify at least one required field.");return qe.validateStrArr("required",r),qe.checkDupes(r),function(e){var t=nn.keys(e);Gn.forall(r,function(n){return Gn.contains(t,n)})||qe.reqMessage(r,t),o(r,t);var n=Gn.filter(r,function(n){return!i.validate(e[n],n)});return 0<n.length&&qe.invalidTypeMessage(n,i.label),e}},fr=V.noop,lr={exactly:V.curry(cr,function(e,n){var t=Gn.filter(n,function(n){return!Gn.contains(e,n)});0<t.length&&qe.unsuppMessage(t)}),ensure:V.curry(cr,fr),ensureWith:V.curry(sr,fr)},dr=lr.ensure(["readState"]),mr=function(){return dr({readState:function(){return"No State required"}})},gr=Object.freeze({init:mr}),pr=function(n){return Kt(n)},hr=co([Do("fields"),Do("name"),No("active",{}),No("apis",{}),No("extra",{}),No("state",gr)]),vr=function(n){var e,t,o,r,i,u,a,c,s=So("Creating behaviour: "+n.name,hr,n);return e=s.fields,t=s.name,o=s.active,r=s.apis,i=s.extra,u=s.state,a=co(e),c=Io(t,[Fo("config",e)]),ar(a,c,t,o,r,i,u)},br=co([Do("branchKey"),Do("branches"),Do("name"),No("active",{}),No("apis",{}),No("extra",{}),No("state",gr)]),yr=V.constant(undefined),wr=(V.constant({}),V.constant({}),V.constant({}),V.constant(gr)),xr=function(n,e,t){if(!(j.isString(t)||j.isBoolean(t)||j.isNumber(t)))throw console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")},Sr=function(n,e,t){xr(n.dom(),e,t)},Tr=function(n,e){var t=n.dom().getAttribute(e);return null===t?undefined:t},kr=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},Cr={clone:function(n){return Gn.foldl(n.dom().attributes,function(n,e){return n[e.name]=e.value,n},{})},set:Sr,setAll:function(n,e){var t=n.dom();nn.each(e,function(n,e){xr(t,e,n)})},get:Tr,has:kr,remove:function(n,e){n.dom().removeAttribute(e)},hasNone:function(n){var e=n.dom().attributes;return e===undefined||null===e||0===e.length},transfer:function(r,i,n){Pe.isElement(r)&&Pe.isElement(i)&&Gn.each(n,function(n){var e,t,o;t=i,kr(e=r,o=n)&&!kr(t,o)&&Sr(t,o,Tr(e,o))})}},Or=function(n,e){var t=Cr.get(n,e);return t===undefined||""===t?[]:t.split(" ")},Er=Or,Dr=function(n,e,t){var o=Or(n,e).concat([t]);Cr.set(n,e,o.join(" "))},Mr=function(n,e,t){var o=Gn.filter(Or(n,e),function(n){return n!==t});0<o.length?Cr.set(n,e,o.join(" ")):Cr.remove(n,e)},Ar=function(n){return Er(n,"class")},Br=function(n,e){return Dr(n,"class",e)},Rr=function(n,e){return Mr(n,"class",e)},Ir=Ar,Fr=Br,Nr=Rr,Vr=function(n,e){Gn.contains(Ar(n),e)?Rr(n,e):Br(n,e)},Hr=function(n){return n.dom().classList!==undefined},jr=function(n,e){return Hr(n)&&n.dom().classList.contains(e)},zr={add:function(n,e){Hr(n)?n.dom().classList.add(e):Fr(n,e)},remove:function(n,e){var t;Hr(n)?n.dom().classList.remove(e):Nr(n,e),0===(Hr(t=n)?t.dom().classList:Ir(t)).length&&Cr.remove(t,"class")},toggle:function(n,e){return Hr(n)?n.dom().classList.toggle(e):Vr(n,e)},toggler:function(n,e){var t=Hr(n),o=n.dom().classList;return r(function(){t?o.remove(e):Nr(n,e)},function(){t?o.add(e):Fr(n,e)},jr(n,e))},has:jr},Lr=function(n,e,t){zr.remove(n,t),zr.add(n,e)},Pr=Object.freeze({toAlpha:function(n,e){Lr(n.element(),e.alpha(),e.omega())},toOmega:function(n,e){Lr(n.element(),e.omega(),e.alpha())},isAlpha:function(n,e){return zr.has(n.element(),e.alpha())},isOmega:function(n,e){return zr.has(n.element(),e.omega())},clear:function(n,e){zr.remove(n.element(),e.alpha()),zr.remove(n.element(),e.omega())}}),Wr=[Do("alpha"),Do("omega")],Ur=vr({fields:Wr,name:"swapping",apis:Pr}),Gr=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return Gr(t())}}},$r=function(n,e,t){for(var o=n.dom(),r=j.isFunction(t)?t:V.constant(!1);o.parentNode;){o=o.parentNode;var i=Ae.fromDom(o);if(e(i))return K.some(i);if(r(i))break}return K.none()},qr=function(n,e){return Gn.find(n.dom().childNodes,V.compose(e,Ae.fromDom)).map(Ae.fromDom)},_r=function(n,o){var r=function(n){for(var e=0;e<n.childNodes.length;e++){if(o(Ae.fromDom(n.childNodes[e])))return K.some(Ae.fromDom(n.childNodes[e]));var t=r(n.childNodes[e]);if(t.isSome())return t}return K.none()};return r(n.dom())},Kr={first:function(n){return _r(Ge.body(),n)},ancestor:$r,closest:function(n,e,t){return o(function(n){return e(n)},$r,n,e,t)},sibling:function(e,t){var n=e.dom();return n.parentNode?qr(Ae.fromDom(n.parentNode),function(n){return!rt(e,n)&&t(n)}):K.none()},child:qr,descendant:_r},Xr=function(n){var e=n!==undefined?n.dom():document;return K.from(e.activeElement).map(Ae.fromDom)},Yr=function(n){var e=dt.owner(n).dom();return n.dom()===e.activeElement},Jr=function(n){n.dom().focus()},Qr=function(n){n.dom().blur()},Zr=Xr,ni=function(e){return Xr(dt.owner(e)).filter(function(n){return e.dom().contains(n.dom())})},ei=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),ti=tinymce.util.Tools.resolve("tinymce.ThemeManager"),oi=function(n){var e=document.createElement("a");e.target="_blank",e.href=n.href,e.rel="noreferrer noopener";var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(e),e.dispatchEvent(t),document.body.removeChild(e)},ri={formatChanged:V.constant("formatChanged"),orientationChanged:V.constant("orientationChanged"),dropupDismissed:V.constant("dropupDismissed")},ii=function(n,e){var t=(e||document).createElement("div");return t.innerHTML=n,dt.children(Ae.fromDom(t))},ui=function(n){return n.dom().innerHTML},ai=ui,ci=function(n,e){var t=dt.owner(n).dom(),o=Ae.fromDom(t.createDocumentFragment()),r=ii(e,t);ht.append(o,r),bt.empty(n),pt.append(n,o)},si=function(n){var e=Ae.fromTag("div"),t=Ae.fromDom(n.dom().cloneNode(!0));return pt.append(e,t),ui(e)},fi=function(n,e){return Ae.fromDom(n.dom().cloneNode(e))},li=function(n){return fi(n,!1)},di=function(n){return e=li(n),si(e);var e},mi=Object.freeze({events:function(o){return Lo([Wo(ge(),function(r,i){var n,e,u=o.channels(),t=(n=nn.keys(u),(e=i).universal()?n:Gn.filter(n,function(n){return Gn.contains(e.channels(),n)}));Gn.each(t,function(n){var e=u[n](),t=e.schema(),o=To("channel["+n+"] data\nReceiver: "+di(r.element()),t,i.data());e.onReceive()(r,o)})})])}}),gi=function(n){for(var e=[],t=function(n){e.push(n)},o=0;o<n.length;o++)n[o].each(t);return e},pi=function(n,e){for(var t=0;t<n.length;t++){var o=e(n[t],t);if(o.isSome())return o}return K.none()},hi="unknown",vi=[],bi=["alloy/data/Fields","alloy/debugging/Debugging"],yi={logEventCut:V.noop,logEventStopped:V.noop,logNoParent:V.noop,logEventNoHandlers:V.noop,logEventResponse:V.noop,write:V.noop},wi=function(n,e,t){var o,r="*"===vi||Gn.contains(vi,n)?(o=[],{logEventCut:function(n,e,t){o.push({outcome:"cut",target:e,purpose:t})},logEventStopped:function(n,e,t){o.push({outcome:"stopped",target:e,purpose:t})},logNoParent:function(n,e,t){o.push({outcome:"no-parent",target:e,purpose:t})},logEventNoHandlers:function(n,e){o.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,t){o.push({outcome:"response",purpose:t,target:e})},write:function(){Gn.contains(["mousemove","mouseover","mouseout",we()],n)||console.log(n,{event:n,target:e.dom(),sequence:Gn.map(o,function(n){return Gn.contains(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+di(n.target)+")":n.outcome})})}}):yi,i=t(r);return r.write(),i},xi=(V.constant(yi),V.constant(!0),V.constant([Do("menu"),Do("selectedMenu")])),Si=V.constant([Do("item"),Do("selectedItem")]),Ti=(V.constant(co(Si().concat(xi()))),V.constant(co(Si()))),ki=Bo("initSize",[Do("numColumns"),Do("numRows")]),Ci=function(n,e,t){var o;return function(){var n=new Error;if(n.stack!==undefined){var e=n.stack.split("\n");Gn.find(e,function(e){return 0<e.indexOf("alloy")&&!Gn.exists(bi,function(n){return-1<e.indexOf(n)})}).getOr(hi)}}(),po(e,e,t,(o=function(n){return Et.value(function(){return n.apply(undefined,arguments)})},ao(function(n){return o(n)})))},Oi=function(n){return Ci(0,n,At(V.noop))},Ei=function(n){return Ci(0,n,At(K.none))},Di=function(n){return Ci(0,n,Bt())},Mi=function(n){return Ci(0,n,Bt())},Ai=function(n,e){return Ho(n,V.constant(e))},Bi=function(n){return Ho(n,V.identity)},Ri=V.constant(ki),Ii=[Mo("channels",lo(Et.value,co([Di("onReceive"),No("schema",Oo())])))],Fi=vr({fields:Ii,name:"receiving",active:mi}),Ni=function(n,e){var t=zi(n,e),o=e.aria();o.update()(n,o,t)},Vi=function(n,e){zr.toggle(n.element(),e.toggleClass()),Ni(n,e)},Hi=function(n,e){zr.add(n.element(),e.toggleClass()),Ni(n,e)},ji=function(n,e){zr.remove(n.element(),e.toggleClass()),Ni(n,e)},zi=function(n,e){return zr.has(n.element(),e.toggleClass())},Li=function(n,e,t){(e.selected()?Hi:ji)(n,e,t)},Pi=Object.freeze({onLoad:Li,toggle:Vi,isOn:zi,on:Hi,off:ji}),Wi=Object.freeze({exhibit:function(){return er({})},events:function(n,e){var t,o,r,i=(t=n,o=e,r=Vi,Yo(function(n){r(n,t,o)})),u=or(n,e,Li);return Lo(Gn.flatten([n.toggleOnExecute()?[i]:[],[u]]))}}),Ui=function(n,e,t){Cr.set(n.element(),"aria-expanded",t)},Gi=[No("selected",!1),Do("toggleClass"),No("toggleOnExecute",!0),Vo("aria",{mode:"none"},Co("mode",{pressed:[No("syncWithExpanded",!1),Ai("update",function(n,e,t){Cr.set(n.element(),"aria-pressed",t),e.syncWithExpanded()&&Ui(n,e,t)})],checked:[Ai("update",function(n,e,t){Cr.set(n.element(),"aria-checked",t)})],expanded:[Ai("update",Ui)],selected:[Ai("update",function(n,e,t){Cr.set(n.element(),"aria-selected",t)})],none:[Ai("update",V.noop)]}))],$i=vr({fields:Gi,name:"toggling",active:Wi,apis:Pi}),qi=function(t,o){return Fi.config({channels:_t(ri.formatChanged(),{onReceive:function(n,e){e.command===t&&o(n,e.state)}})})},_i=function(n){return Fi.config({channels:_t(ri.orientationChanged(),{onReceive:n})})},Ki=function(n,e){return{key:n,value:{onReceive:e}}},Xi="tinymce-mobile",Yi={resolve:function(n){return Xi+"-"+n},prefix:V.constant(Xi)},Ji=function(n,e){e.ignore()||(Jr(n.element()),e.onFocus()(n))},Qi=Object.freeze({focus:Ji,blur:function(n,e){e.ignore()||Qr(n.element())},isFocused:function(n){return Yr(n.element())}}),Zi=Object.freeze({exhibit:function(n,e){return e.ignore()?er({}):er({attributes:{tabindex:"-1"}})},events:function(t){return Lo([Wo(de(),function(n,e){Ji(n,t),e.stop()})])}}),nu=[Oi("onFocus"),No("ignore",!1)],eu=vr({fields:nu,name:"focusing",active:Zi,apis:Qi}),tu={isSupported:function(n){return n.style!==undefined}},ou=function(n,e,t){if(!j.isString(t))throw console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);tu.isSupported(n)&&n.style.setProperty(e,t)},ru=function(n,e){tu.isSupported(n)&&n.style.removeProperty(e)},iu=function(n,e,t){var o=n.dom();ou(o,e,t)},uu=function(n,e){return tu.isSupported(n)?n.style.getPropertyValue(e):""},au=function(n,e){var t=n.dom(),o=uu(t,e);return K.from(o).filter(function(n){return 0<n.length})},cu={copy:function(n,e){var t=n.dom(),o=e.dom();tu.isSupported(t)&&tu.isSupported(o)&&(o.style.cssText=t.style.cssText)},set:iu,preserve:function(n,e){var t=Cr.get(n,"style"),o=e(n);return(t===undefined?Cr.remove:Cr.set)(n,"style",t),o},setAll:function(n,e){var t=n.dom();nn.each(e,function(n,e){ou(t,e,n)})},setOptions:function(n,e){var t=n.dom();nn.each(e,function(n,e){n.fold(function(){ru(t,e)},function(n){ou(t,e,n)})})},remove:function(n,e){var t=n.dom();ru(t,e),Cr.has(n,"style")&&""===oe.trim(Cr.get(n,"style"))&&Cr.remove(n,"style")},get:function(n,e){var t=n.dom(),o=window.getComputedStyle(t).getPropertyValue(e),r=""!==o||Ge.inBody(n)?o:uu(t,e);return null===r?undefined:r},getRaw:au,getAllRaw:function(n){var e={},t=n.dom();if(tu.isSupported(t))for(var o=0;o<t.style.length;o++){var r=t.style.item(o);e[r]=t.style[r]}return e},isValidValue:function(n,e,t){var o=Ae.fromTag(n);return iu(o,e,t),au(o,e).isSome()},reflow:function(n){return n.dom().offsetWidth},transfer:function(o,r,n){Pe.isElement(o)&&Pe.isElement(r)&&Gn.each(n,function(n){var e,t;e=r,au(o,t=n).each(function(n){au(e,t).isNone()&&iu(e,t,n)})})}},su=n("height",function(n){return Ge.inBody(n)?n.dom().getBoundingClientRect().height:n.dom().offsetHeight}),fu=function(n){return su.get(n)},lu=function(n,e,t){return Gn.filter(dt.parents(n,t),e)},du=function(n,e){return Gn.filter(dt.siblings(n),e)},mu=function(n){return tt.all(n)},gu=function(n,e,t){return lu(n,function(n){return tt.is(n,e)},t)},pu=function(n,e){return du(n,function(n){return tt.is(n,e)})},hu=function(n,e){return tt.all(e,n)},vu=function(n,e,t){return Kr.ancestor(n,function(n){return tt.is(n,e)},t)},bu=function(n){return tt.one(n)},yu=vu,wu=function(n,e){return tt.one(e,n)},xu=function(n,e,t){return o(tt.is,vu,n,e,t)},Su={BACKSPACE:V.constant([8]),TAB:V.constant([9]),ENTER:V.constant([13]),SHIFT:V.constant([16]),CTRL:V.constant([17]),ALT:V.constant([18]),CAPSLOCK:V.constant([20]),ESCAPE:V.constant([27]),SPACE:V.constant([32]),PAGEUP:V.constant([33]),PAGEDOWN:V.constant([34]),END:V.constant([35]),HOME:V.constant([36]),LEFT:V.constant([37]),UP:V.constant([38]),RIGHT:V.constant([39]),DOWN:V.constant([40]),INSERT:V.constant([45]),DEL:V.constant([46]),META:V.constant([91,93,224]),F10:V.constant([121])},Tu=function(n,e,t){var o=Gn.reverse(n.slice(0,e)),r=Gn.reverse(n.slice(e+1));return Gn.find(o.concat(r),t)},ku=function(n,e,t){var o=Gn.reverse(n.slice(0,e));return Gn.find(o,t)},Cu=function(n,e,t){var o=n.slice(0,e),r=n.slice(e+1);return Gn.find(r.concat(o),t)},Ou=function(n,e,t){var o=n.slice(e+1);return Gn.find(o,t)},Eu=function(e){return function(n){return Gn.contains(e,n.raw().which)}},Du=function(n){return function(e){return Gn.forall(n,function(n){return n(e)})}},Mu=function(n){return!0===n.raw().shiftKey},Au=function(n){return!0===n.raw().ctrlKey},Bu=(V.not(Au),V.not(Mu)),Ru=function(n,e){return{matches:n,classification:e}},Iu=function(n,e,t,o){var r=n+e;return o<r?t:r<t?o:r},Fu=function(n,e,t){return n<=e?e:t<=n?t:n},Nu=function(e,t){var n=hu(e.element(),"."+t.highlightClass());Gn.each(n,function(n){zr.remove(n,t.highlightClass()),e.getSystem().getByDom(n).each(function(n){t.onDehighlight()(e,n)})})},Vu=function(n,e,t,o){var r=Hu(n,e,t,o);Nu(n,e),zr.add(o.element(),e.highlightClass()),r||e.onHighlight()(n,o)},Hu=function(n,e,t,o){return zr.has(o.element(),e.highlightClass())},ju=function(n,e,t,o){var r=hu(n.element(),"."+e.itemClass());return K.from(r[o]).fold(function(){return Et.error("No element found with index "+o)},n.getSystem().getByDom)},zu=function(n,e){return wu(n.element(),"."+e.itemClass()).bind(n.getSystem().getByDom)},Lu=function(n,e){var t=hu(n.element(),"."+e.itemClass());return(0<t.length?K.some(t[t.length-1]):K.none()).bind(n.getSystem().getByDom)},Pu=function(t,e,n,o){var r=hu(t.element(),"."+e.itemClass());return Gn.findIndex(r,function(n){return zr.has(n,e.highlightClass())}).bind(function(n){var e=Iu(n,o,0,r.length-1);return t.getSystem().getByDom(r[e])})},Wu=Object.freeze({dehighlightAll:Nu,dehighlight:function(n,e,t,o){var r=Hu(n,e,t,o);zr.remove(o.element(),e.highlightClass()),r&&e.onDehighlight()(n,o)},highlight:Vu,highlightFirst:function(e,t,o){zu(e,t,o).each(function(n){Vu(e,t,o,n)})},highlightLast:function(e,t,o){Lu(e,t,o).each(function(n){Vu(e,t,o,n)})},highlightAt:function(e,t,o,n){ju(e,t,o,n).fold(function(n){throw new Error(n)},function(n){Vu(e,t,o,n)})},highlightBy:function(e,t,o,n){var r=hu(e.element(),"."+t.itemClass()),i=gi(Gn.map(r,function(n){return e.getSystem().getByDom(n).toOption()}));Gn.find(i,n).each(function(n){Vu(e,t,o,n)})},isHighlighted:Hu,getHighlighted:function(n,e){return wu(n.element(),"."+e.highlightClass()).bind(n.getSystem().getByDom)},getFirst:zu,getLast:Lu,getPrevious:function(n,e){return Pu(n,e,0,-1)},getNext:function(n,e){return Pu(n,e,0,1)}}),Uu=[Do("highlightClass"),Do("itemClass"),Oi("onHighlight"),Oi("onDehighlight")],Gu=vr({fields:Uu,name:"highlighting",apis:Wu}),$u=function(){return{get:function(n){return ni(n.element())},set:function(n,e){n.getSystem().triggerFocus(e,n.element())}}},qu=function(n,e,u,t,o,i){var a=function(e,t,o,r){var n,i;return(n=u(e,t,o,r),i=t.event(),Gn.find(n,function(n){return n.matches(i)}).map(function(n){return n.classification})).bind(function(n){return n(e,t,o,r)})},r={schema:function(){return n.concat([No("focusManager",$u()),Ai("handler",r),Ai("state",e)])},processKey:a,toEvents:function(o,r){var n=t(o,r),e=Lo(i.map(function(t){return Wo(de(),function(n,e){t(n,o,r,e),e.stop()})}).toArray().concat([Wo(sn(),function(n,e){a(n,e,o,r).each(function(){e.stop()})})]));return W.deepMerge(n,e)},toApis:o};return r},_u=function(n){var e=[Ro("onEscape"),Ro("onEnter"),No("selector",'[data-alloy-tabstop="true"]'),No("firstTabstop",0),No("useTabstopAt",V.constant(!0)),Ro("visibilitySelector")].concat([n]),u=function(n,e){var t=n.visibilitySelector().bind(function(n){return xu(e,n)}).getOr(e);return 0<fu(t)},a=function(e,n,t,o,r){return r(n,t,function(n){return u(e=o,t=n)&&e.useTabstopAt()(t);var e,t}).fold(function(){return o.cyclic()?K.some(!0):K.none()},function(n){return o.focusManager().set(e,n),K.some(!0)})},r=function(e,n,t,o){var r,i,u=hu(e.element(),t.selector());return(r=e,i=t,i.focusManager().get(r).bind(function(n){return xu(n,i.selector())})).bind(function(n){return Gn.findIndex(u,V.curry(rt,n)).bind(function(n){return a(e,u,n,t,o)})})},t=V.constant([Ru(Du([Mu,Eu(Su.TAB())]),function(n,e,t){var o=t.cyclic()?Tu:ku;return r(n,0,t,o)}),Ru(Eu(Su.TAB()),function(n,e,t){var o=t.cyclic()?Cu:Ou;return r(n,0,t,o)}),Ru(Eu(Su.ESCAPE()),function(e,t,n){return n.onEscape().bind(function(n){return n(e,t)})}),Ru(Du([Bu,Eu(Su.ENTER())]),function(e,t,n){return n.onEnter().bind(function(n){return n(e,t)})})]),o=V.constant({}),i=V.constant({});return qu(e,mr,t,o,i,K.some(function(e,t){var n,o,r,i;(n=e,o=t,r=hu(n.element(),o.selector()),i=Gn.filter(r,function(n){return u(o,n)}),K.from(i[o.firstTabstop()])).each(function(n){t.focusManager().set(e,n)})}))},Ku=_u(Ho("cyclic",V.constant(!1))),Xu=_u(Ho("cyclic",V.constant(!0))),Yu=function(n){return"input"===Pe.name(n)&&"radio"!==Cr.get(n,"type")||"textarea"===Pe.name(n)},Ju=function(n,e,t){return Yu(t)&&Eu(Su.SPACE())(e.event())?K.none():(Ee(n,t,pe()),K.some(!0))},Qu=[No("execute",Ju),No("useSpace",!1),No("useEnter",!0),No("useControlEnter",!1),No("useDown",!1)],Zu=function(n,e,t){return t.execute()(n,e,n.element())},na=V.constant({}),ea=V.constant({}),ta=qu(Qu,mr,function(n,e,t){var o=t.useSpace()&&!Yu(n.element())?Su.SPACE():[],r=t.useEnter()?Su.ENTER():[],i=t.useDown()?Su.DOWN():[],u=o.concat(r).concat(i);return[Ru(Eu(u),Zu)].concat(t.useControlEnter()?[Ru(Du([Au,Eu(Su.ENTER())]),Zu)]:[])},na,ea,K.none()),oa=function(){var t=Gr(K.none());return dr({readState:V.constant({}),setGridSize:function(n,e){t.set(K.some({numRows:V.constant(n),numColumns:V.constant(e)}))},getNumRows:function(){return t.get().map(function(n){return n.numRows()})},getNumColumns:function(){return t.get().map(function(n){return n.numColumns()})}})},ra=Object.freeze({flatgrid:oa,init:function(n){return n.state()(n)}}),ia=function(n){return"rtl"===cu.get(n,"direction")?"rtl":"ltr"},ua=function(e,t){return function(n){return"rtl"===ia(n)?t:e}},aa=function(i){return function(n,e,t,o){var r=i(n.element());return la(r,n,e,t,o)}},ca=function(n,e){var t=ua(n,e);return aa(t)},sa=function(n,e){var t=ua(e,n);return aa(t)},fa=function(r){return function(n,e,t,o){return la(r,n,e,t,o)}},la=function(e,t,n,o,r){return o.focusManager().get(t).bind(function(n){return e(t.element(),n,o,r)}).map(function(n){return o.focusManager().set(t,n),!0})},da=fa,ma=fa,ga=fa,pa=function(n){var e;return!((e=n.dom()).offsetWidth<=0&&e.offsetHeight<=0)},ha=_e.immutableBag(["index","candidates"],[]),va=function(n,e,t){return ba(n,e,t,pa)},ba=function(n,e,t){var o,r,i=V.curry(rt,e),u=hu(n,t),a=Gn.filter(u,pa);return o=a,r=i,Gn.findIndex(o,r).map(function(n){return ha({index:n,candidates:o})})},ya=function(n,e){return Gn.findIndex(n,function(n){return rt(e,n)})},wa=function(t,n,o,e){return e(Math.floor(n/o),n%o).bind(function(n){var e=n.row()*o+n.column();return 0<=e&&e<t.length?K.some(t[e]):K.none()})},xa=function(r,n,i,u,a){return wa(r,n,u,function(n,e){var t=n===i-1?r.length-n*u:u,o=Iu(e,a,0,t-1);return K.some({row:V.constant(n),column:V.constant(o)})})},Sa=function(i,n,u,a,c){return wa(i,n,a,function(n,e){var t=Iu(n,c,0,u-1),o=t===u-1?i.length-t*a:a,r=Fu(e,0,o-1);return K.some({row:V.constant(t),column:V.constant(r)})})},Ta=[Do("selector"),No("execute",Ju),Ei("onEscape"),No("captureTab",!1),Ri()],ka=function(r){return function(n,e,t,o){return va(n,e,t.selector()).bind(function(n){return r(n.candidates(),n.index(),o.getNumRows().getOr(t.initSize().numRows()),o.getNumColumns().getOr(t.initSize().numColumns()))})}},Ca=function(n,e,t){return t.captureTab()?K.some(!0):K.none()},Oa=ka(function(n,e,t,o){return xa(n,e,t,o,-1)}),Ea=ka(function(n,e,t,o){return xa(n,e,t,o,1)}),Da=ka(function(n,e,t,o){return Sa(n,e,t,o,-1)}),Ma=ka(function(n,e,t,o){return Sa(n,e,t,o,1)}),Aa=V.constant([Ru(Eu(Su.LEFT()),ca(Oa,Ea)),Ru(Eu(Su.RIGHT()),sa(Oa,Ea)),Ru(Eu(Su.UP()),da(Da)),Ru(Eu(Su.DOWN()),ma(Ma)),Ru(Du([Mu,Eu(Su.TAB())]),Ca),Ru(Du([Bu,Eu(Su.TAB())]),Ca),Ru(Eu(Su.ESCAPE()),function(n,e,t){return t.onEscape()(n,e)}),Ru(Eu(Su.SPACE().concat(Su.ENTER())),function(e,t,o){return(n=e,r=o,r.focusManager().get(n).bind(function(n){return xu(n,r.selector())})).bind(function(n){return o.execute()(e,t,n)});var n,r})]),Ba=V.constant({}),Ra=qu(Ta,oa,Aa,Ba,{},K.some(function(e,t){wu(e.element(),t.selector()).each(function(n){t.focusManager().set(e,n)})})),Ia=function(n,e,t,r){return va(n,t,e).bind(function(n){var e=n.index(),t=n.candidates(),o=Iu(e,r,0,t.length-1);return K.from(t[o])})},Fa=[Do("selector"),No("getInitial",K.none),No("execute",Ju),No("executeOnMove",!1)],Na=function(e,t,o){return(n=e,r=o,r.focusManager().get(n).bind(function(n){return xu(n,r.selector())})).bind(function(n){return o.execute()(e,t,n)});var n,r},Va=function(n,e,t){return Ia(n,t.selector(),e,-1)},Ha=function(n,e,t){return Ia(n,t.selector(),e,1)},ja=function(o){return function(n,e,t){return o(n,e,t).bind(function(){return t.executeOnMove()?Na(n,e,t):K.some(!0)})}},za=V.constant({}),La=V.constant({}),Pa=qu(Fa,mr,function(){return[Ru(Eu(Su.LEFT().concat(Su.UP())),ja(ca(Va,Ha))),Ru(Eu(Su.RIGHT().concat(Su.DOWN())),ja(sa(Va,Ha))),Ru(Eu(Su.ENTER()),Na),Ru(Eu(Su.SPACE()),Na)]},za,La,K.some(function(e,t){t.getInitial()(e).or(wu(e.element(),t.selector())).each(function(n){t.focusManager().set(e,n)})})),Wa=_e.immutableBag(["rowIndex","columnIndex","cell"],[]),Ua=function(n,e,t){return K.from(n[e]).bind(function(n){return K.from(n[t]).map(function(n){return Wa({rowIndex:e,columnIndex:t,cell:n})})})},Ga=function(n,e,t,o){var r=n[e].length,i=Iu(t,o,0,r-1);return Ua(n,e,i)},$a=function(n,e,t,o){var r=Iu(t,o,0,n.length-1),i=n[r].length,u=Fu(e,0,i-1);return Ua(n,r,u)},qa=function(n,e,t,o){var r=n[e].length,i=Fu(t+o,0,r-1);return Ua(n,e,i)},_a=function(n,e,t,o){var r=Fu(t+o,0,n.length-1),i=n[r].length,u=Fu(e,0,i-1);return Ua(n,r,u)},Ka=[Bo("selectors",[Do("row"),Do("cell")]),No("cycles",!0),No("previousSelector",K.none),No("execute",Ju)],Xa=function(n,e){return function(t,o,u){var a=u.cycles()?n:e;return xu(o,u.selectors().row()).bind(function(n){var e=hu(n,u.selectors().cell());return ya(e,o).bind(function(r){var i=hu(t,u.selectors().row());return ya(i,n).bind(function(n){var e,t,o=(e=i,t=u,Gn.map(e,function(n){return hu(n,t.selectors().cell())}));return a(o,n,r).map(function(n){return n.cell()})})})})}},Ya=Xa(function(n,e,t){return Ga(n,e,t,-1)},function(n,e,t){return qa(n,e,t,-1)}),Ja=Xa(function(n,e,t){return Ga(n,e,t,1)},function(n,e,t){return qa(n,e,t,1)}),Qa=Xa(function(n,e,t){return $a(n,t,e,-1)},function(n,e,t){return _a(n,t,e,-1)}),Za=Xa(function(n,e,t){return $a(n,t,e,1)},function(n,e,t){return _a(n,t,e,1)}),nc=V.constant([Ru(Eu(Su.LEFT()),ca(Ya,Ja)),Ru(Eu(Su.RIGHT()),sa(Ya,Ja)),Ru(Eu(Su.UP()),da(Qa)),Ru(Eu(Su.DOWN()),ma(Za)),Ru(Eu(Su.SPACE().concat(Su.ENTER())),function(e,t,o){return ni(e.element()).bind(function(n){return o.execute()(e,t,n)})})]),ec=V.constant({}),tc=V.constant({}),oc=qu(Ka,mr,nc,ec,tc,K.some(function(e,t){t.previousSelector()(e).orThunk(function(){var n=t.selectors();return wu(e.element(),n.cell())}).each(function(n){t.focusManager().set(e,n)})})),rc=[Do("selector"),No("execute",Ju),No("moveOnTab",!1)],ic=function(e,t,o){return o.focusManager().get(e).bind(function(n){return o.execute()(e,t,n)})},uc=function(n,e,t){return Ia(n,t.selector(),e,-1)},ac=function(n,e,t){return Ia(n,t.selector(),e,1)},cc=V.constant([Ru(Eu(Su.UP()),ga(uc)),Ru(Eu(Su.DOWN()),ga(ac)),Ru(Du([Mu,Eu(Su.TAB())]),function(n,e,t){return t.moveOnTab()?ga(uc)(n,e,t):K.none()}),Ru(Du([Bu,Eu(Su.TAB())]),function(n,e,t){return t.moveOnTab()?ga(ac)(n,e,t):K.none()}),Ru(Eu(Su.ENTER()),ic),Ru(Eu(Su.SPACE()),ic)]),sc=V.constant({}),fc=V.constant({}),lc=qu(rc,mr,cc,sc,fc,K.some(function(e,t){wu(e.element(),t.selector()).each(function(n){t.focusManager().set(e,n)})})),dc=[Ei("onSpace"),Ei("onEnter"),Ei("onShiftEnter"),Ei("onLeft"),Ei("onRight"),Ei("onTab"),Ei("onShiftTab"),Ei("onUp"),Ei("onDown"),Ei("onEscape"),Ro("focusIn")],mc=V.constant({}),gc=V.constant({}),pc=qu(dc,mr,function(n,e,t){return[Ru(Eu(Su.SPACE()),t.onSpace()),Ru(Du([Bu,Eu(Su.ENTER())]),t.onEnter()),Ru(Du([Mu,Eu(Su.ENTER())]),t.onShiftEnter()),Ru(Du([Mu,Eu(Su.TAB())]),t.onShiftTab()),Ru(Du([Bu,Eu(Su.TAB())]),t.onTab()),Ru(Eu(Su.UP()),t.onUp()),Ru(Eu(Su.DOWN()),t.onDown()),Ru(Eu(Su.LEFT()),t.onLeft()),Ru(Eu(Su.RIGHT()),t.onRight()),Ru(Eu(Su.SPACE()),t.onSpace()),Ru(Eu(Su.ESCAPE()),t.onEscape())]},mc,gc,K.some(function(e,t){return t.focusIn().bind(function(n){return n(e,t)})})),hc={acyclic:Ku.schema(),cyclic:Xu.schema(),flow:Pa.schema(),flatgrid:Ra.schema(),matrix:oc.schema(),execution:ta.schema(),menu:lc.schema(),special:pc.schema()},vc=rr(Co((k=So("Creating behaviour: "+(T={branchKey:"mode",branches:hc,name:"keying",active:{events:function(n,e){return n.handler().toEvents(n,e)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(n,e,t,o,r){Yt(t,"setGridSize")?t.setGridSize(o,r):console.error("Layout does not support setGridSize")}},state:ra}).name,br,T)).branchKey,k.branches),k.name,k.active,k.apis,k.extra,k.state),bc=function(o,n){return e=o,t={},r=Gn.map(n,function(n){return e=n.name(),t="Cannot configure "+n.name()+" for "+o,po(e,e,Rt(),ao(function(){return Et.error("The field: "+e+" is forbidden. "+t)}));var e,t}).concat([Ho("dump",V.identity)]),po(e,e,At(t),so(r));var e,t,r},yc=function(n){return n.dump()},wc="placeholder",xc=Dt([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),Sc=function(n,e,t,o){return t.uiType===wc?(i=t,u=o,(r=n).exists(function(n){return n!==i.owner})?xc.single(!0,V.constant(i)):qt(u,i.name).fold(function(){throw new Error("Unknown placeholder component: "+i.name+"\nKnown: ["+nn.keys(u)+"]\nNamespace: "+r.getOr("none")+"\nSpec: "+no(i,null,2))},function(n){return n.replace()})):xc.single(!1,V.constant(t));var r,i,u},Tc=function(i,u,a,c){return Sc(i,0,a,c).fold(function(n,e){
var t=e(u,a.config,a.validated),o=qt(t,"components").getOr([]),r=Gn.bind(o,function(n){return Tc(i,u,n,c)});return[W.deepMerge(t,{components:r})]},function(n,e){return e(u,a.config,a.validated)})},kc=function(e,t,n,o){var r,i,u,a,c=nn.map(o,function(n,e){return t=e,o=n,r=!1,{name:V.constant(t),required:function(){return o.fold(function(n){return n},function(n){return n})},used:function(){return r},replace:function(){if(!0===r)throw new Error("Trying to use the same placeholder more than once: "+t);return r=!0,o}};var t,o,r}),s=(r=e,i=t,u=n,a=c,Gn.bind(u,function(n){return Tc(r,i,n,a)}));return nn.each(c,function(n){if(!1===n.used()&&n.required())throw new Error("Placeholder: "+n.name()+" was not found in components list\nNamespace: "+e.getOr("none")+"\nComponents: "+no(t.components(),null,2))}),s},Cc=xc.single,Oc=xc.multiple,Ec=V.constant(wc),Dc=0,Mc=function(n){var e=(new Date).getTime();return n+"_"+Math.floor(1e9*Math.random())+ ++Dc+String(e)},Ac=Dt([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),Bc=No("factory",{sketch:V.identity}),Rc=No("schema",[]),Ic=Do("name"),Fc=po("pname","pname",It(function(n){return"<alloy."+Mc(n.name)+">"}),Oo()),Nc=No("defaults",V.constant({})),Vc=No("overrides",V.constant({})),Hc=so([Bc,Rc,Ic,Fc,Nc,Vc]),jc=so([Bc,Rc,Ic,Nc,Vc]),zc=so([Bc,Rc,Ic,Fc,Nc,Vc]),Lc=so([Bc,Rc,Ic,Do("unit"),Fc,Nc,Vc]),Pc=function(n){var e=function(n){return n.name()};return n.fold(e,e,e,e)},Wc=function(t,o){return function(n){var e=To("Converting part type",o,n);return t(e)}},Uc=Wc(Ac.required,Hc),Gc=(Wc(Ac.external,jc),Wc(Ac.optional,zc)),$c=Wc(Ac.group,Lc),qc=V.constant("entirety"),_c=function(n,e,t,o){var r=t;return W.deepMerge(e.defaults()(n,t,o),t,{uid:n.partUids()[e.name()]},e.overrides()(n,t,o),{"debug.sketcher":_t("part-"+e.name(),r)})},Kc=function(r,n){var i={};return Gn.each(n,function(n){var e;(e=n,e.fold(K.some,K.none,K.some,K.some)).each(function(t){var o=Xc(r,t.pname());i[t.name()]=function(n){var e=So("Part: "+t.name()+" in "+r,so(t.schema()),n);return W.deepMerge(o,{config:n,validated:e})}})}),i},Xc=function(n,e){return{uiType:Ec(),owner:n,name:e}},Yc=function(n,e,t){return o=e,r=t,i={},u={},Gn.each(r,function(n){n.fold(function(o){i[o.pname()]=Cc(!0,function(n,e,t){return o.factory().sketch(_c(n,o,e,t))})},function(n){var e=o.parts()[n.name()]();u[n.name()]=V.constant(_c(o,n,e[qc()]()))},function(o){i[o.pname()]=Cc(!1,function(n,e,t){return o.factory().sketch(_c(n,o,e,t))})},function(t){i[t.pname()]=Oc(!0,function(e){var n=e[t.name()]();return Gn.map(n,function(n){return t.factory().sketch(W.deepMerge(t.defaults()(e,n),n,t.overrides()(e,n)))})})})}),{internals:V.constant(i),externals:V.constant(u)};var o,r,i,u},Jc=function(n,e,t){return kc(K.some(n),e,e.components(),t)},Qc=function(n,e,t){var o=e.partUids()[t];return n.getSystem().getByUid(o).toOption()},Zc=function(n,e,t){return Qc(n,e,t).getOrDie("Could not find part: "+t)},ns=function(e,n){var t,o=(t=n,Gn.map(t,Pc));return Kt(Gn.map(o,function(n){return{key:n,value:e+"-"+n}}))},es=function(e){return po("partUids","partUids",Ft(function(n){return ns(n.uid,e)}),Oo())},ts=Mc("alloy-premade"),os=Mc("api"),rs=function(n){return _t(ts,n)},is=function(o){return n=function(n){var e=Array.prototype.slice.call(arguments,0),t=n.config(os);return o.apply(undefined,[t].concat(e))},t=(e=o.toString()).indexOf(")")+1,r=e.indexOf("("),i=e.substring(r+1,t-1).split(/,\s*/),n.toFunctionAnnotation=function(){return{name:"OVERRIDE",parameters:Jo(i.slice(1))}},n;var n,e,t,r,i},us=V.constant(os),as=V.constant("alloy-id-"),cs=V.constant("data-alloy-id"),ss=as(),fs=cs(),ls=function(n,e){var t=Mc(ss+n);return Cr.set(e,fs,t),t},ds=function(n){var e=Pe.isElement(n)?Cr.get(n,fs):null;return K.from(e)},ms=function(n){return Mc(n)},gs=(V.constant(fs),function(n,e,t,o,r){var i,u,a=(u=r,(0<(i=o).length?[Bo("parts",i)]:[]).concat([Do("uid"),No("dom",{}),No("components",[]),Bi("originalSpec"),No("debug.sketcher",{})]).concat(u));return To(n+" [SpecSchema]",co(a.concat(e)),t)}),ps=function(n,e,t,o,r){var i,u=hs(r),a=(i=t,Gn.bind(i,function(n){return n.fold(K.none,K.some,K.none,K.none).map(function(n){return Bo(n.name(),n.schema().concat([Bi(qc())]))}).toArray()})),c=es(t),s=gs(n,e,u,a,[c]),f=Yc(0,s,t),l=Jc(n,s,f.internals());return W.deepMerge(o(s,l,u,f.externals()),{"debug.sketcher":_t(n,r)})},hs=function(n){return W.deepMerge({uid:ms("uid")},n)},vs=co([Do("name"),Do("factory"),Do("configFields"),No("apis",{}),No("extraApis",{})]),bs=co([Do("name"),Do("factory"),Do("configFields"),Do("partFields"),No("apis",{}),No("extraApis",{})]),ys=function(n){var a=So("Sketcher for "+n.name,vs,n),e=nn.map(a.apis,is),t=nn.map(a.extraApis,function(n,e){return Qo(n,e)});return W.deepMerge({name:V.constant(a.name),partFields:V.constant([]),configFields:V.constant(a.configFields),sketch:function(n){return e=a.name,t=a.configFields,o=a.factory,i=hs(r=n),u=gs(e,t,i,[],[]),W.deepMerge(o(u,i),{"debug.sketcher":_t(e,r)});var e,t,o,r,i,u}},e,t)},ws=function(n){var e=So("Sketcher for "+n.name,bs,n),t=Kc(e.name,e.partFields),o=nn.map(e.apis,is),r=nn.map(e.extraApis,function(n,e){return Qo(n,e)});return W.deepMerge({name:V.constant(e.name),partFields:V.constant(e.partFields),configFields:V.constant(e.configFields),sketch:function(n){return ps(e.name,e.configFields,e.partFields,e.factory,n)},parts:V.constant(t)},o,r)},xs=ys({name:"Button",factory:function(n){var e,t,o,r=(e=n.action(),t=function(n,e){e.stop(),Oe(n)},o=fe.detect().deviceType.isTouch()?[Wo(ve(),t)]:[Wo(dn(),t),Wo(rn(),function(n,e){e.cut()})],Lo(Gn.flatten([e.map(function(t){return Wo(pe(),function(n,e){t(n),e.stop()})}).toArray(),o]))),i=qt(n.dom(),"attributes").bind(Gt("type")),u=qt(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:r,behaviours:W.deepMerge(pr([eu.config({}),vc.config({mode:"execution",useSpace:!0,useEnter:!0})]),yc(n.buttonBehaviours())),domModification:{attributes:W.deepMerge(i.fold(function(){return u.is("button")?{type:"button"}:{}},function(){return{}}),{role:n.role().getOr("button")})},eventOrder:n.eventOrder()}},configFields:[No("uid",undefined),Do("dom"),No("components",[]),bc("buttonBehaviours",[eu,vc]),Ro("action"),Ro("role"),No("eventOrder",{})]}),Ss=Object.freeze({events:function(){return Lo([Po(gn(),V.constant(!0))])},exhibit:function(){return er({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}}),Ts=vr({fields:[],name:"unselecting",active:Ss}),ks=function(n){var e,t,o,r=Ae.fromHtml(n),i=dt.children(r),u=(t=(e=r).dom().attributes!==undefined?e.dom().attributes:[],Gn.foldl(t,function(n,e){return"class"===e.name?n:W.deepMerge(n,_t(e.name,e.value))},{})),a=(o=r,Array.prototype.slice.call(o.dom().classList,0)),c=0===i.length?{}:{innerHtml:ai(r)};return W.deepMerge({tag:Pe.name(r),classes:a,attributes:u},c)},Cs=function(n){var e=oe.supplant(n,{prefix:Yi.prefix()});return ks(e)},Os=function(n){return{dom:Cs(n)}},Es=function(n){return pr([$i.config({toggleClass:Yi.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),qi(n,function(n,e){(e?$i.on:$i.off)(n)})])},Ds=function(n,e,t){return xs.sketch({dom:Cs('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:e,buttonBehaviours:W.deepMerge(pr([Ts.config({})]),t)})},Ms={forToolbar:Ds,forToolbarCommand:function(n,e){return Ds(e,function(){n.execCommand(e)},{})},forToolbarStateAction:function(n,e,t,o){var r=Es(t);return Ds(e,o,r)},forToolbarStateCommand:function(n,e){var t=Es(e);return Ds(e,function(){n.execCommand(e)},t)}},As=function(n,e,t){return Math.max(e,Math.min(t,n))},Bs=function(n,e,t,o,r,i,u){var a=t-e;if(o<n.left)return e-1;if(o>n.right)return t+1;var c,s,f,l,d=Math.min(n.right,Math.max(o,n.left))-n.left,m=As(d/n.width*a+e,e-1,t+1),g=Math.round(m);return i&&e<=m&&m<=t?(c=m,s=e,f=t,l=r,u.fold(function(){var n=c-s,e=Math.round(n/l)*l;return As(s+e,s-1,f+1)},function(n){var e=(c-n)%l,t=Math.round(e/l),o=Math.floor((c-n)/l),r=Math.floor((f-n)/l),i=n+Math.min(r,o+t)*l;return Math.max(n,i)})):g},Rs="slider.change.value",Is=fe.detect().deviceType.isTouch(),Fs=function(n){var e;return(e=n.event().raw(),Is&&e.touches!==undefined&&1===e.touches.length?K.some(e.touches[0]):Is&&e.touches!==undefined?K.none():Is||e.clientX===undefined?K.none():K.some(e)).map(function(n){return n.clientX})},Ns=function(n,e){Ce(n,Rs,{value:e})},Vs=function(i,u,a,n){return Fs(n).map(function(n){var e,t,o,r;return e=i,o=n,r=Bs(a,(t=u).min(),t.max(),o,t.stepSize(),t.snapToGrid(),t.snapStart()),Ns(e,r),n})},Hs=function(n,e){var t,o,r,i,u=(t=e.value().get(),o=e.min(),r=e.max(),i=e.stepSize(),t<o?t:r<t?r:t===o?o-1:Math.max(o,t-i));Ns(n,u)},js=function(n,e){var t,o,r,i,u=(t=e.value().get(),o=e.min(),r=e.max(),i=e.stepSize(),r<t?t:t<o?o:t===r?r+1:Math.min(r,t+i));Ns(n,u)},zs=V.constant(Rs),Ls=fe.detect().deviceType.isTouch(),Ps=function(n,o){return Gc({name:n+"-edge",overrides:function(n){var e=Lo([Uo(en(),o,[n])]),t=Lo([Uo(rn(),o,[n]),Uo(un(),function(n,e){e.mouseIsDown().get()&&o(n,e)},[n])]);return{events:Ls?e:t}}})},Ws=[Ps("left",function(n,e){Ns(n,e.min()-1)}),Ps("right",function(n,e){Ns(n,e.max()+1)}),Uc({name:"thumb",defaults:V.constant({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:Lo([$o(en(),n,"spectrum"),$o(tn(),n,"spectrum"),$o(on(),n,"spectrum")])}}}),Uc({schema:[Ho("mouseIsDown",function(){return Gr(!1)})],name:"spectrum",overrides:function(o){var t=function(n,e){var t=n.element().dom().getBoundingClientRect();Vs(n,o,t,e)},n=Lo([Wo(en(),t),Wo(tn(),t)]),e=Lo([Wo(rn(),t),Wo(un(),function(n,e){o.mouseIsDown().get()&&t(n,e)})]);return{behaviours:pr(Ls?[]:[vc.config({mode:"special",onLeft:function(n){return Hs(n,o),K.some(!0)},onRight:function(n){return js(n,o),K.some(!0)}}),eu.config({})]),events:Ls?n:e}}})],Us=function(n,e,t){e.store().manager().onLoad(n,e,t)},Gs=function(n,e,t){e.store().manager().onUnload(n,e,t)},$s=Object.freeze({onLoad:Us,onUnload:Gs,setValue:function(n,e,t,o){e.store().manager().setValue(n,e,t,o)},getValue:function(n,e,t){return e.store().manager().getValue(n,e,t)}}),qs=Object.freeze({events:function(e,t){var n=e.resetOnDom()?[_o(function(n){Us(n,e,t)}),Ko(function(n){Gs(n,e,t)})]:[or(e,t,Us)];return Lo(n)}}),_s=function(){var n=Gr(null);return dr({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},Ks=function(){var n=Gr({});return dr({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},Xs=Object.freeze({memory:_s,dataset:Ks,manual:function(){return dr({readState:function(){}})},init:function(n){return n.store().manager().state(n)}}),Ys=function(n,e,t,o){e.store().getDataKey(),t.set({}),e.store().setData()(n,o),e.onSetValue()(n,o)},Js=[Ro("initialValue"),Do("getFallbackEntry"),Do("getDataKey"),Do("setData"),Ai("manager",{setValue:Ys,getValue:function(n,e,t){var o=e.store().getDataKey()(n),r=t.get();return qt(r,o).fold(function(){return e.store().getFallbackEntry()(o)},function(n){return n})},onLoad:function(e,t,o){t.store().initialValue().each(function(n){Ys(e,t,o,n)})},onUnload:function(n,e,t){t.set({})},state:Ks})],Qs=[Do("getValue"),No("setValue",V.noop),Ro("initialValue"),Ai("manager",{setValue:function(n,e,t,o){e.store().setValue()(n,o),e.onSetValue()(n,o)},getValue:function(n,e){return e.store().getValue()(n)},onLoad:function(e,t){t.store().initialValue().each(function(n){t.store().setValue()(e,n)})},onUnload:V.noop,state:mr})],Zs=[Vo("store",{mode:"memory"},Co("mode",{memory:[Ro("initialValue"),Ai("manager",{setValue:function(n,e,t,o){t.set(o),e.onSetValue()(n,o)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store().initialValue().each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:_s})],manual:Qs,dataset:Js})),Oi("onSetValue"),No("resetOnDom",!1)],nf=vr({fields:Zs,name:"representing",active:qs,apis:$s,extra:{setValueFrom:function(n,e){var t=nf.getValue(e);nf.setValue(n,t)}},state:Xs}),ef=fe.detect().deviceType.isTouch(),tf=[Do("min"),Do("max"),No("stepSize",1),No("onChange",V.noop),No("onInit",V.noop),No("onDragStart",V.noop),No("onDragEnd",V.noop),No("snapToGrid",!1),Ro("snapStart"),Do("getInitialValue"),bc("sliderBehaviours",[vc,nf]),Ho("value",function(n){return Gr(n.min)})].concat(ef?[]:[Ho("mouseIsDown",function(){return Gr(!1)})]),of=n("width",function(n){return n.dom().offsetWidth}),rf=function(n,e){of.set(n,e)},uf=function(n){return of.get(n)},af=fe.detect().deviceType.isTouch(),cf=ws({name:"Slider",configFields:tf,partFields:Ws,factory:function(c,n){var s=c.max()-c.min(),f=function(n){var e=n.element().dom().getBoundingClientRect();return(e.left+e.right)/2},r=function(n){return Zc(n,c,"thumb")},i=function(n){var e,t,o,r,i=Zc(n,c,"spectrum").element().dom().getBoundingClientRect(),u=n.element().dom().getBoundingClientRect(),a=(e=n,t=i,(r=(o=c).value().get())<o.min()?Qc(e,o,"left-edge").fold(function(){return 0},function(n){return f(n)-t.left}):r>o.max()?Qc(e,o,"right-edge").fold(function(){return t.width},function(n){return f(n)-t.left}):(o.value().get()-o.min())/s*t.width);return i.left-u.left+a},u=function(n){var e=i(n),t=r(n),o=uf(t.element())/2;cu.set(t.element(),"left",e-o+"px")},t=function(n,e){var t=c.value().get(),o=r(n);return t!==e||cu.getRaw(o.element(),"left").isNone()?(c.value().set(e),u(n),c.onChange()(n,o,e),K.some(!0)):K.none()},e=af?[Wo(en(),function(n){c.onDragStart()(n,r(n))}),Wo(on(),function(n){c.onDragEnd()(n,r(n))})]:[Wo(rn(),function(n,e){e.stop(),c.onDragStart()(n,r(n)),c.mouseIsDown().set(!0)}),Wo(an(),function(n){c.onDragEnd()(n,r(n)),c.mouseIsDown().set(!1)})];return{uid:c.uid(),dom:c.dom(),components:n,behaviours:W.deepMerge(pr(Gn.flatten([af?[]:[vc.config({mode:"special",focusIn:function(n){return Qc(n,c,"spectrum").map(vc.focusIn).map(V.constant(!0))}})],[nf.config({store:{mode:"manual",getValue:function(){return c.value().get()}}})]])),yc(c.sliderBehaviours())),events:Lo([Wo(zs(),function(n,e){t(n,e.event().value())}),_o(function(n){c.value().set(c.getInitialValue()());var e=r(n);u(n),c.onInit()(n,e,c.value().get())})].concat(e)),apis:{resetToMin:function(n){t(n,c.min())},resetToMax:function(n){t(n,c.max())},refresh:u},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,e){n.resetToMin(e)},resetToMax:function(n,e){n.resetToMax(e)},refresh:function(n,e){n.refresh(e)}}}),sf=function(e,t,o){return Ms.forToolbar(t,function(){var n=o();e.setContextToolbar([{label:t+" group",items:n}])},{})},ff=function(n){return[(r=n,i=function(n){return n<0?"black":360<n?"white":"hsl("+n+", 100%, 50%)"},cf.sketch({dom:Cs('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[cf.parts()["left-edge"](Os('<div class="${prefix}-hue-slider-black"></div>')),cf.parts().spectrum({dom:Cs('<div class="${prefix}-slider-gradient-container"></div>'),components:[Os('<div class="${prefix}-slider-gradient"></div>')],behaviours:pr([$i.config({toggleClass:Yi.resolve("thumb-active")})])}),cf.parts()["right-edge"](Os('<div class="${prefix}-hue-slider-white"></div>')),cf.parts().thumb({dom:Cs('<div class="${prefix}-slider-thumb"></div>'),behaviours:pr([$i.config({toggleClass:Yi.resolve("thumb-active")})])})],onChange:function(n,e,t){var o=i(t);cu.set(e.element(),"background-color",o),r.onChange(n,e,o)},onDragStart:function(n,e){$i.on(e)},onDragEnd:function(n,e){$i.off(e)},onInit:function(n,e,t){var o=i(t);cu.set(e.element(),"background-color",o)},stepSize:10,min:0,max:360,getInitialValue:r.getInitialValue,sliderBehaviours:pr([_i(cf.refresh)])}))];var r,i},lf=function(n,o){var e={onChange:function(n,e,t){o.undoManager.transact(function(){o.formatter.apply("forecolor",{value:t}),o.nodeChanged()})},getInitialValue:function(){return-1}};return sf(n,"color",function(){return ff(e)})},df=co([Do("getInitialValue"),Do("onChange"),Do("category"),Do("sizes")]),mf=function(n){var r=So("SizeSlider",df,n);return cf.sketch({dom:{tag:"div",classes:[Yi.resolve("slider-"+r.category+"-size-container"),Yi.resolve("slider"),Yi.resolve("slider-size-container")]},onChange:function(n,e,t){var o;0<=(o=t)&&o<r.sizes.length&&r.onChange(t)},onDragStart:function(n,e){$i.on(e)},onDragEnd:function(n,e){$i.off(e)},min:0,max:r.sizes.length-1,stepSize:1,getInitialValue:r.getInitialValue,snapToGrid:!0,sliderBehaviours:pr([_i(cf.refresh)]),components:[cf.parts().spectrum({dom:Cs('<div class="${prefix}-slider-size-container"></div>'),components:[Os('<div class="${prefix}-slider-size-line"></div>')]}),cf.parts().thumb({dom:Cs('<div class="${prefix}-slider-thumb"></div>'),behaviours:pr([$i.config({toggleClass:Yi.resolve("thumb-active")})])})]})},gf=function(n,e,t){for(var o=n.dom(),r=j.isFunction(t)?t:V.constant(!1);o.parentNode;){o=o.parentNode;var i=Ae.fromDom(o),u=e(i);if(u.isSome())return u;if(r(i))break}return K.none()},pf=function(n,e,t){return e(n).orThunk(function(){return t(n)?K.none():gf(n,e,t)})},hf=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],vf=function(n){var e,t,o=n.selection.getStart(),r=Ae.fromDom(o),i=Ae.fromDom(n.getBody()),u=(e=function(n){return rt(i,n)},t=r,(Pe.isElement(t)?K.some(t):dt.parent(t)).map(function(n){return pf(n,function(n){return cu.getRaw(n,"font-size")},e).getOrThunk(function(){return cu.get(n,"font-size")})}).getOr(""));return Gn.find(hf,function(n){return u===n}).getOr("medium")},bf={candidates:V.constant(hf),get:function(n){var e,t=vf(n);return(e=t,Gn.findIndex(hf,function(n){return n===e})).getOr(2)},apply:function(o,n){var e;(e=n,K.from(hf[e])).each(function(n){var e,t;t=n,vf(e=o)!==t&&e.execCommand("fontSize",!1,t)})}},yf=bf.candidates(),wf=function(n){return[Os('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),(e=n,mf({onChange:e.onChange,sizes:yf,category:"font",getInitialValue:e.getInitialValue})),Os('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')];var e},xf=function(n){var e=n.uid!==undefined&&Yt(n,"uid")?n.uid:ms("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(K.none,K.some)},asSpec:function(){return W.deepMerge(n,{uid:e})}}},Sf={create:t,clone:function(n){var e;return i(e=t(n.width,n.height)).drawImage(n,0,0),e},resize:u,get2dContext:i,get3dContext:function(n){var e=null;try{e=n.getContext("webgl")||n.getContext("experimental-webgl")}catch(h){}return e||(e=null),e}},Tf={getWidth:function(n){return n.naturalWidth||n.width},getHeight:function(n){return n.naturalHeight||n.height}},kf=window.Promise?window.Promise:function(){function c(n,e){return function(){n.apply(e,arguments)}}function i(t){var o=this;null!==this._state?n(function(){var n=o._state?t.onFulfilled:t.onRejected;if(null!==n){var e;try{e=n(o._value)}catch(f){return void t.reject(f)}t.resolve(e)}else(o._state?t.resolve:t.reject)(o._value)}):this._deferreds.push(t)}function r(n){try{if(n===this)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"==typeof n||"function"==typeof n)){var e=n.then;if("function"==typeof e)return void a(c(e,n),c(r,this),c(t,this))}this._state=!0,this._value=n,o.call(this)}catch(f){t.call(this,f)}}function t(n){this._state=!1,this._value=n,o.call(this)}function o(){for(var n=0,e=this._deferreds.length;n<e;n++)i.call(this,this._deferreds[n]);this._deferreds=null}function u(n,e,t,o){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=o}function a(n,e,t){var o=!1;try{n(function(n){o||(o=!0,e(n))},function(n){o||(o=!0,t(n))})}catch(r){if(o)return;o=!0,t(r)}}var s=function(n){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof n)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],a(n,c(r,this),c(t,this))},n=s.immediateFn||"function"==typeof setImmediate&&setImmediate||function(n){setTimeout(n,1)},f=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};return s.prototype["catch"]=function(n){return this.then(null,n)},s.prototype.then=function(t,o){var r=this;return new s(function(n,e){i.call(r,new u(t,o,n,e))})},s.all=function(n){var a=Array.prototype.slice.call(1===arguments.length&&f(n)?n:arguments);return new s(function(o,r){function i(e,n){try{if(n&&("object"==typeof n||"function"==typeof n)){var t=n.then;if("function"==typeof t)return void t.call(n,function(n){i(e,n)},r)}a[e]=n,0==--u&&o(a)}catch(c){r(c)}}if(0===a.length)return o([]);for(var u=a.length,n=0;n<a.length;n++)i(n,a[n])})},s.resolve=function(e){return e&&"object"==typeof e&&e.constructor===s?e:new s(function(n){n(e)})},s.reject=function(t){return new s(function(n,e){e(t)})},s.race=function(r){return new s(function(n,e){for(var t=0,o=r.length;t<o;t++)r[t].then(n,e)})},s}(),Cf={atob:function(n){return Qe.getOrDie("atob")(n)},requestAnimationFrame:function(n){Qe.getOrDie("requestAnimationFrame")(n)}},Of={blobToImage:e,imageToBlob:function(n){var e=n.src;return 0===e.indexOf("data:")?f(e):c(e)},blobToArrayBuffer:function(t){return new kf(function(n){var e=new a;e.onloadend=function(){n(e.result)},e.readAsArrayBuffer(t)})},blobToDataUri:l,blobToBase64:function(n){return l(n).then(function(n){return n.split(",")[1]})},dataUriToBlobSync:s,canvasToBlob:function(n,t,o){return t=t||"image/png",HTMLCanvasElement.prototype.toBlob?new kf(function(e){n.toBlob(function(n){e(n)},t,o)}):f(n.toDataURL(t,o))},canvasToDataURL:function(n,e,t){return e=e||"image/png",n.then(function(n){return n.toDataURL(e,t)})},blobToCanvas:function(n){return e(n).then(function(n){var e,t;return e=n,URL.revokeObjectURL(e.src),t=Sf.create(Tf.getWidth(n),Tf.getHeight(n)),Sf.get2dContext(t).drawImage(n,0,0),t})},uriToBlob:function(n){return 0===n.indexOf("blob:")?c(n):0===n.indexOf("data:")?f(n):null}},Ef=function(n){return Of.blobToBase64(n)},Df=function(u){var e=xf({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:Lo([qo(dn()),Wo(ln(),function(n,e){var t,o,r;(t=e,o=t.event(),r=o.raw().target.files||o.raw().dataTransfer.files,K.from(r[0])).each(function(n){var r,i;r=u,Ef(i=n).then(function(o){r.undoManager.transact(function(){var n=r.editorUpload.blobCache,e=n.create(Mc("mceu"),i,o);n.add(e);var t=r.dom.createHTML("img",{src:e.blobUri()});r.insertContent(t)})})})})])});return xs.sketch({dom:Cs('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[e.asSpec()],action:function(n){e.get(n).element().dom().click()}})},Mf=function(n){return n.dom().textContent},Af=function(n,e){n.dom().textContent=e},Bf=function(n){return 0<n.length},Rf=function(n){return n===undefined||null===n?"":n},If=function(e,t,n){return n.text.filter(Bf).fold(function(){return Cr.get(n=e,"href")===Mf(n)?K.some(t):K.none();var n},K.some)},Ff=function(n){var e=Ae.fromDom(n.selection.getStart());return xu(e,"a")},Nf={getInfo:function(n){return Ff(n).fold(function(){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:K.none()}},function(n){return t=Mf(e=n),o=Cr.get(e,"href"),r=Cr.get(e,"title"),i=Cr.get(e,"target"),{url:Rf(o),text:t!==o?Rf(t):"",title:Rf(r),target:Rf(i),link:K.some(e)};var e,t,o,r,i})},applyInfo:function(r,i){i.url.filter(Bf).fold(function(){var n;n=r,i.link.bind(V.identity).each(function(){n.execCommand("unlink")})},function(t){var n,e,o=(n=i,(e={}).href=t,n.title.filter(Bf).each(function(n){e.title=n}),n.target.filter(Bf).each(function(n){e.target=n}),e);i.link.bind(V.identity).fold(function(){var n=i.text.filter(Bf).getOr(t);r.insertContent(r.dom.createHTML("a",o,r.dom.encode(n)))},function(e){var n=If(e,t,i);Cr.setAll(e,o),n.each(function(n){Af(e,n)})})})},query:Ff},Vf=fe.detect(),Hf=function(n,e){var t=e.selection.getRng();n(),e.selection.setRng(t)},jf=function(n,e){(Vf.os.isAndroid()?Hf:V.apply)(e,n)},zf=function(n,e){var t,o;return{key:n,value:{config:{},me:(t=n,o=Lo(e),vr({fields:[Do("enabled")],name:t,active:{events:V.constant(o)}})),configAsRaw:V.constant({}),initialConfig:{},state:wr()}}},Lf=Object.freeze({getCurrent:function(n,e){return e.find()(n)}}),Pf=[Do("find")],Wf=vr({fields:Pf,name:"composing",apis:Lf}),Uf=ys({name:"Container",factory:function(n){return{uid:n.uid(),dom:W.deepMerge({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:yc(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[No("components",[]),bc("containerBehaviours",[]),No("events",{}),No("domModification",{}),No("eventOrder",{})]}),Gf=ys({name:"DataField",factory:function(e){return{uid:e.uid(),dom:e.dom(),behaviours:W.deepMerge(pr([nf.config({store:{mode:"memory",initialValue:e.getInitialValue()()}}),Wf.config({find:K.some})]),yc(e.dataBehaviours())),events:Lo([_o(function(n){nf.setValue(n,e.getInitialValue()())})])}},configFields:[Do("uid"),Do("dom"),Do("getInitialValue"),bc("dataBehaviours",[nf,Wf])]}),$f=function(n,e){if(e===undefined)throw new Error("Value.set was undefined");n.dom().value=e},qf=function(n){return n.dom().value},_f=ys({name:"Input",configFields:V.constant([Ro("data"),No("inputAttributes",{}),No("inputStyles",{}),No("type","input"),No("tag","input"),No("inputClasses",[]),Oi("onSetValue"),No("styles",{}),Ro("placeholder"),No("eventOrder",{}),bc("inputBehaviours",[nf,eu]),No("selectOnFocus",!0)])(),factory:function(n){return{uid:n.uid(),dom:(t=n,{tag:t.tag(),attributes:W.deepMerge(Kt([{key:"type",value:t.type()}].concat(t.placeholder().map(function(n){return{key:"placeholder",value:n}}).toArray())),t.inputAttributes()),styles:t.inputStyles(),classes:t.inputClasses()}),components:[],behaviours:(e=n,W.deepMerge(pr([nf.config({store:{mode:"manual",initialValue:e.data().getOr(undefined),getValue:function(n){return qf(n.element())},setValue:function(n,e){qf(n.element())!==e&&$f(n.element(),e)}},onSetValue:e.onSetValue()}),eu.config({onFocus:!1===e.selectOnFocus()?V.noop:function(n){var e=n.element(),t=qf(e);e.dom().setSelectionRange(0,t.length)}})]),yc(e.inputBehaviours()))),eventOrder:n.eventOrder()};var e,t}}),Kf=Object.freeze({exhibit:function(n,e){return er({attributes:Kt([{key:e.tabAttr(),value:"true"}])})}}),Xf=[No("tabAttr","data-alloy-tabstop")],Yf=vr({fields:Xf,name:"tabstopping",active:Kf}),Jf=function(n,e){var t=xf(_f.sketch({placeholder:e,onSetValue:function(n){ke(n,fn())},inputBehaviours:pr([Wf.config({find:K.some}),Yf.config({}),vc.config({mode:"execution"})]),selectOnFocus:!1})),o=xf(xs.sketch({dom:Cs('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var e=t.get(n);nf.setValue(e,"")}}));return{name:n,spec:Uf.sketch({dom:Cs('<div class="${prefix}-input-container"></div>'),components:[t.asSpec(),o.asSpec()],containerBehaviours:pr([$i.config({toggleClass:Yi.resolve("input-container-empty")}),Wf.config({find:function(n){return K.some(t.get(n))}}),zf("input-clearing",[Wo(fn(),function(n){var e=t.get(n);(0<nf.getValue(e).length?$i.off:$i.on)(n)})])])})}},Qf=["input","button","textarea"],Zf=function(n,e,t){e.disabled()&&il(n,e,t)},nl=function(n){return Gn.contains(Qf,Pe.name(n.element()))},el=function(n){Cr.set(n.element(),"disabled","disabled")},tl=function(n){Cr.remove(n.element(),"disabled")},ol=function(n){Cr.set(n.element(),"aria-disabled","true")},rl=function(n){Cr.set(n.element(),"aria-disabled","false")},il=function(e,n){n.disableClass().each(function(n){zr.add(e.element(),n)}),(nl(e)?el:ol)(e)},ul=function(n){return nl(n)?Cr.has(n.element(),"disabled"):"true"===Cr.get(n.element(),"aria-disabled")},al=Object.freeze({enable:function(e,n){n.disableClass().each(function(n){zr.remove(e.element(),n)}),(nl(e)?tl:rl)(e)},disable:il,isDisabled:ul,onLoad:Zf}),cl=Object.freeze({exhibit:function(n,e){return er({classes:e.disabled()?e.disableClass().map(Gn.pure).getOr([]):[]})},events:function(n,e){return Lo([Po(pe(),function(n){return ul(n)}),or(n,e,Zf)])}}),sl=[No("disabled",!1),Ro("disableClass")],fl=vr({fields:sl,name:"disabling",active:cl,apis:al}),ll=[bc("formBehaviours",[nf])],dl=function(n){return"<alloy.field."+n+">"},ml=function(r,n,e){return W.deepMerge({"debug.sketcher":{Form:e},uid:r.uid(),dom:r.dom(),components:n,behaviours:W.deepMerge(pr([nf.config({store:{mode:"manual",getValue:function(n){var e,t,o=(e=r,t=n.getSystem(),nn.map(e.partUids(),function(n){return V.constant(t.getByUid(n))}));return nn.map(o,function(n){return n().bind(Wf.getCurrent).map(nf.getValue)})},setValue:function(t,n){nn.each(n,function(e,n){Qc(t,r,n).each(function(n){Wf.getCurrent(n).each(function(n){nf.setValue(n,e)})})})}}})]),yc(r.formBehaviours())),apis:{getField:function(n,e){return Qc(n,r,e).bind(Wf.getCurrent)}}})},gl=(is(function(n,e,t){return n.getField(e,t)}),function(n){var i,e=(i=[],{field:function(n,e){return i.push(n),t="form",o=dl(n),r=e,{uiType:Ec(),owner:t,name:o,config:r,validated:{}};var t,o,r},record:function(){return i}}),t=n(e),o=e.record(),r=Gn.map(o,function(n){return Uc({name:n,pname:dl(n)})});return ps("form",ll,r,ml,t)}),pl=function(n){var e=Gr(K.none()),t=function(){e.get().each(n)};return{clear:function(){t(),e.set(K.none())},isSet:function(){return e.get().isSome()},set:function(n){t(),e.set(K.some(n))}}},hl={destroyable:function(){return pl(function(n){n.destroy()})},unbindable:function(){return pl(function(n){n.unbind()})},api:function(){var e=Gr(K.none()),t=function(){e.get().each(function(n){n.destroy()})};return{clear:function(){t(),e.set(K.none())},isSet:function(){return e.get().isSome()},set:function(n){t(),e.set(K.some(n))},run:function(n){e.get().each(n)}}},value:function(){var e=Gr(K.none());return{clear:function(){e.set(K.none())},set:function(n){e.set(K.some(n))},isSet:function(){return e.get().isSome()},on:function(n){e.get().each(n)}}}},vl=function(n){return{xValue:n,points:[]}},bl=function(n,e){if(e===n.xValue)return n;var t=0<e-n.xValue?1:-1,o={direction:t,xValue:e};return{xValue:e,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===t?n.points.slice(0,n.points.length-1):n.points).concat([o])}},yl=function(n){if(0===n.points.length)return 0;var e=n.points[0].direction,t=n.points[n.points.length-1].direction;return-1===e&&-1===t?-1:1===e&&1===t?1:0},wl=function(n){var o="navigateEvent",e=so([Do("fields"),No("maxFieldIndex",n.fields.length-1),Do("onExecute"),Do("getInitialValue"),Ho("state",function(){return{dialogSwipeState:hl.value(),currentScreen:Gr(0)}})]),u=So("SerialisedDialog",e,n),r=function(e,n,t){return xs.sketch({dom:Cs('<span class="${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:function(n){Ce(n,o,{direction:e})},buttonBehaviours:pr([fl.config({disableClass:Yi.resolve("toolbar-navigation-disabled"),disabled:!t})])})},i=function(n,r){var i=hu(n.element(),"."+Yi.resolve("serialised-dialog-screen"));wu(n.element(),"."+Yi.resolve("serialised-dialog-chain")).each(function(o){0<=u.state.currentScreen.get()+r&&u.state.currentScreen.get()+r<i.length&&(cu.getRaw(o,"left").each(function(n){var e=parseInt(n,10),t=uf(i[0]);cu.set(o,"left",e-r*t+"px")}),u.state.currentScreen.set(u.state.currentScreen.get()+r))})},a=function(o){var n=hu(o.element(),"input");K.from(n[u.state.currentScreen.get()]).each(function(n){o.getSystem().getByDom(n).each(function(n){var e,t;e=o,t=n.element(),e.getSystem().triggerFocus(t,e.element())})});var e=s.get(o);Gu.highlightAt(e,u.state.currentScreen.get())},c=xf(gl(function(t){return{dom:Cs('<div class="${prefix}-serialised-dialog"></div>'),components:[Uf.sketch({dom:Cs('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:Gn.map(u.fields,function(n,e){return e<=u.maxFieldIndex?Uf.sketch({dom:Cs('<div class="${prefix}-serialised-dialog-screen"></div>'),components:Gn.flatten([[r(-1,"previous",0<e)],[t.field(n.name,n.spec)],[r(1,"next",e<u.maxFieldIndex)]])}):t.field(n.name,n.spec)})})],formBehaviours:pr([_i(function(n,e){var t;t=e,wu(n.element(),"."+Yi.resolve("serialised-dialog-chain")).each(function(n){cu.set(n,"left",-u.state.currentScreen.get()*t.width+"px")})}),vc.config({mode:"special",focusIn:function(n){a(n)},onTab:function(n){return i(n,1),K.some(!0)},onShiftTab:function(n){return i(n,-1),K.some(!0)}}),zf("form-events",[_o(function(e){u.state.currentScreen.set(0),u.state.dialogSwipeState.clear();var n=s.get(e);Gu.highlightFirst(n),u.getInitialValue(e).each(function(n){nf.setValue(e,n)})}),Yo(u.onExecute),Wo(mn(),function(n,e){"left"===e.event().raw().propertyName&&a(n)}),Wo(o,function(n,e){var t=e.event().direction()
;i(n,t)})])])}})),s=xf({dom:Cs('<div class="${prefix}-dot-container"></div>'),behaviours:pr([Gu.config({highlightClass:Yi.resolve("dot-active"),itemClass:Yi.resolve("dot-item")})]),components:Gn.bind(u.fields,function(n,e){return e<=u.maxFieldIndex?[Os('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:Cs('<div class="${prefix}-serializer-wrapper"></div>'),components:[c.asSpec(),s.asSpec()],behaviours:pr([vc.config({mode:"special",focusIn:function(n){var e=c.get(n);vc.focusIn(e)}}),zf("serializer-wrapper-events",[Wo(en(),function(n,e){u.state.dialogSwipeState.set(vl(e.event().raw().touches[0].clientX))}),Wo(tn(),function(n,e){u.state.dialogSwipeState.on(function(n){e.event().prevent(),u.state.dialogSwipeState.set(bl(n,e.event().raw().touches[0].clientX))})}),Wo(on(),function(o){u.state.dialogSwipeState.on(function(n){var e=c.get(o),t=-1*yl(n);i(e,t)})})])])}},xl=pn(function(t,o){return[{label:"the link group",items:[wl({fields:[Jf("url","Type or paste URL"),Jf("text","Link text"),Jf("title","Link title"),Jf("target","Link target"),(n="link",{name:n,spec:Gf.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return K.none()}})})],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return K.some(Nf.getInfo(o))},onExecute:function(n){var e=nf.getValue(n);Nf.applyInfo(o,e),t.restoreToolbar(),o.focus()}})]}];var n}),Sl=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],Tl={events:Lo([(C=de(),D=function(n,e){var t,o,r=e.event().originator(),i=e.event().target();return o=i,!(rt(t=r,n.element())&&!rt(t,o)&&(console.warn(de()+" did not get interpreted by the desired target. \nOriginator: "+di(r)+"\nTarget: "+di(i)+"\nCheck the "+de()+" event handlers"),1))},{key:C,value:jo({can:D})})])},kl=V.identity,Cl=lr.exactly(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn","isConnected"]),Ol=function(e){var n=function(n){return function(){throw new Error("The component must be in a context to send: "+n+"\n"+di(e().element())+" is not in context.")}};return Cl({debugInfo:V.constant("fake"),triggerEvent:n("triggerEvent"),triggerFocus:n("triggerFocus"),triggerEscape:n("triggerEscape"),build:n("build"),addToWorld:n("addToWorld"),removeFromWorld:n("removeFromWorld"),addToGui:n("addToGui"),removeFromGui:n("removeFromGui"),getByUid:n("getByUid"),getByDom:n("getByDom"),broadcast:n("broadcast"),broadcastOn:n("broadcastOn"),isConnected:V.constant(!1)})},El=function(e,n){var t=Gn.map(n,function(n){return po(n.name(),n.name(),Rt(),so([Do("config"),No("state",gr)]))}),o=wo("component.behaviours",so(t),e.behaviours).fold(function(n){throw new Error(ko(n)+"\nComplete spec:\n"+no(e,null,2))},V.identity);return{list:n,data:nn.map(o,function(n){var e=n();return V.constant(e.map(function(n){return{config:n.config(),state:n.state().init(n.config())}}))})}},Dl=function(n){return n.list},Ml=function(n){return n.data},Al=function(n,r){var i={};return nn.each(n,function(n,o){nn.each(n,function(n,e){var t=$t(e,[])(i);i[e]=t.concat([r(o,n)])})}),i},Bl=function(n,e){return{name:V.constant(n),modification:e}},Rl=function(n,e){return 1<n.length?Et.error('Multiple behaviours have tried to change DOM "'+e+'". The guilty behaviours are: '+no(Gn.map(n,function(n){return n.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?Et.value({}):Et.value(n[0].modification().fold(function(){return{}},function(n){return _t(e,n)}))},Il=function(u,a){return Gn.foldl(u,function(n,e){var t=e.modification().getOr({});return n.bind(function(i){var n=nn.mapToArray(t,function(n,e){return i[e]!==undefined?(t=a,o=e,r=u,Et.error("Mulitple behaviours have tried to change the _"+o+'_ "'+t+'". The guilty behaviours are: '+no(Gn.bind(r,function(n){return n.modification().getOr({})[o]!==undefined?[n.name()]:[]}),null,2)+". This is not currently supported.")):Et.value(_t(e,n));var t,o,r});return Xt(n,i)})},Et.value({})).map(function(n){return _t(a,n)})},Fl={classes:function(n,e){var t=Gn.bind(n,function(n){return n.modification().getOr([])});return Et.value(_t(e,t))},attributes:Il,styles:Il,domChildren:Rl,defChildren:Rl,innerHtml:Rl,value:Rl},Nl=function(u,a,n,c){var e=n.slice(0);try{var t=e.sort(function(n,e){var t=n[a](),o=e[a](),r=c.indexOf(t),i=c.indexOf(o);if(-1===r)throw new Error("The ordering for "+u+" does not have an entry for "+t+".\nOrder specified: "+no(c,null,2));if(-1===i)throw new Error("The ordering for "+u+" does not have an entry for "+o+".\nOrder specified: "+no(c,null,2));return r<i?-1:i<r?1:0});return Et.value(t)}catch(v){return Et.error([v])}},Vl=function(n,e){return{handler:V.curry.apply(undefined,[n.handler].concat(e)),purpose:n.purpose}},Hl=function(n){return n.handler},jl=function(n,e){return{name:V.constant(n),handler:V.constant(e)}},zl=function(n,e,t){var o,r,i,u=W.deepMerge(t,(o=e,r=n,i={},Gn.each(o,function(n){i[n.name()]=n.handlers(r)}),i));return Al(u,jl)},Ll=function(n){var e,o=(e=n,j.isFunction(e)?{can:V.constant(!0),abort:V.constant(!1),run:e}:e);return function(n,e){var t=Array.prototype.slice.call(arguments,0);o.abort.apply(undefined,t)?e.stop():o.can.apply(undefined,t)&&o.run.apply(undefined,t)}},Pl=function(n,e,t){var o,r,i=e[t];return i?Nl("Event: "+t,"name",n,i).map(function(n){var e=Gn.map(n,function(n){return n.handler()});return zo(e)}):(o=t,r=n,Et.error(["The event ("+o+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+no(Gn.map(r,function(n){return n.name()}),null,2)]))},Wl=function(n,u){var e=nn.mapToArray(n,function(r,i){return(1===r.length?Et.value(r[0].handler()):Pl(r,u,i)).map(function(n){var e,t=Ll(n),o=1<r.length?Gn.filter(u,function(e){return Gn.contains(r,function(n){return n.name()===e})}).join(" > "):r[0].name();return _t(i,(e=o,{handler:t,purpose:V.constant(e)}))})});return Xt(e,{})},Ul=function(n){return wo("custom.definition",co([po("dom","dom",Bt(),co([Do("tag"),No("styles",{}),No("classes",[]),No("attributes",{}),Ro("value"),Ro("innerHtml")])),Do("components"),Do("uid"),No("events",{}),No("apis",V.constant({})),po("eventOrder","eventOrder",(e={"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]},Mt.mergeWithThunk(V.constant(e))),Oo()),Ro("domModification"),Bi("originalSpec"),No("debug.sketcher","unknown")]),n);var e},Gl=function(n){var e,t={tag:n.dom().tag(),classes:n.dom().classes(),attributes:W.deepMerge((e=n,_t(cs(),e.uid())),n.dom().attributes()),styles:n.dom().styles(),domChildren:Gn.map(n.components(),function(n){return n.element()})};return Zo(W.deepMerge(t,n.dom().innerHtml().map(function(n){return _t("innerHtml",n)}).getOr({}),n.dom().value().map(function(n){return _t("value",n)}).getOr({})))},$l={add:function(e,n){Gn.each(n,function(n){zr.add(e,n)})},remove:function(e,n){Gn.each(n,function(n){zr.remove(e,n)})},toggle:function(e,n){Gn.each(n,function(n){zr.toggle(e,n)})},hasAll:function(e,n){return Gn.forall(n,function(n){return zr.has(e,n)})},hasAny:function(e,n){return Gn.exists(n,function(n){return zr.has(e,n)})},get:function(o){return Hr(o)?function(){for(var n=o.dom().classList,e=new Array(n.length),t=0;t<n.length;t++)e[t]=n.item(t);return e}():Ir(o)}},ql=function(e){if(e.domChildren().isSome()&&e.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+(n=nr(e),no(n,null,2)));return e.domChildren().fold(function(){var n=e.defChildren().getOr([]);return Gn.map(n,Kl)},function(n){return n});var n},_l=function(n){var e=Ae.fromTag(n.tag());Cr.setAll(e,n.attributes().getOr({})),$l.add(e,n.classes().getOr([])),cu.setAll(e,n.styles().getOr({})),ci(e,n.innerHtml().getOr(""));var t=ql(n);return ht.append(e,t),n.value().each(function(n){$f(e,n)}),e},Kl=function(n){var e=Zo(n);return _l(e)},Xl=function(n){var e,t,o,r=(t=qt(e=n,"behaviours").getOr({}),o=Gn.filter(nn.keys(t),function(n){return t[n]!==undefined}),Gn.map(o,function(n){return e.behaviours[n].me}));return El(n,r)},Yl=lr.exactly(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),Jl=function(t){var n,e,o,r,i,u,a,c,s,f,l=function(){return k},d=Gr(Ol(l)),m=xo(Ul(W.deepMerge(t,{behaviours:undefined}))),g=Xl(t),p=Dl(g),h=Ml(g),v=Gl(m),b={"alloy.base.modification":(n=m,n.domModification().fold(function(){return er({})},er))},y=(o=function(e,n,t,o){var r=W.deepMerge({},n);Gn.each(t,function(n){r[n.name()]=n.exhibit(e,o)});var i=Al(r,Bl),u=nn.map(i,function(n){return Gn.bind(n,function(n){return n.modification().fold(function(){return[]},function(){return[n]})})}),a=nn.mapToArray(u,function(e,t){return qt(Fl,t).fold(function(){return Et.error("Unknown field type: "+t)},function(n){return n(e,t)})});return Xt(a,{}).map(er)}(h,b,p,e=v).getOrDie(),r=W.deepMerge({tag:e.tag(),classes:o.classes().getOr([]).concat(e.classes().getOr([])),attributes:W.merge(e.attributes().getOr({}),o.attributes().getOr({})),styles:W.merge(e.styles().getOr({}),o.styles().getOr({}))},o.innerHtml().or(e.innerHtml()).map(function(n){return _t("innerHtml",n)}).getOr({}),tr("domChildren",o.domChildren(),e.domChildren()),tr("defChildren",o.defChildren(),e.defChildren()),o.value().or(e.value()).map(function(n){return _t("value",n)}).getOr({})),Zo(r)),w=_l(y),x={"alloy.base.behaviour":(i=m,i.events())},S=(u=h,a=m.eventOrder(),c=p,s=x,f=zl(u,c,s),Wl(f,a)).getOrDie(),T=Gr(m.components()),k=Yl({getSystem:d.get,config:function(n){if(n===us())return m.apis();var e=h;return(j.isFunction(e[n.name()])?e[n.name()]:function(){throw new Error("Could not find "+n.name()+" in "+no(t,null,2))})()},hasConfigured:function(n){return j.isFunction(h[n.name()])},spec:V.constant(t),readState:function(n){return h[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},connect:function(n){d.set(n)},disconnect:function(){d.set(Ol(l))},element:V.constant(w),syncComponents:function(){var n=dt.children(w),e=Gn.bind(n,function(n){return d.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});T.set(e)},components:T.get,events:V.constant(S)});return k},Ql=function(n){var e,t,o=kl(n),r=(e=o,t=$t("components",[])(e),Gn.map(t,ed)),i=W.deepMerge(Tl,o,_t("components",r));return Et.value(Jl(i))},Zl=function(n){var e=Ae.fromText(n);return nd({element:e})},nd=function(n){var t=To("external.component",co([Do("element"),Ro("uid")]),n),e=Gr(Ol());t.uid().each(function(n){var e;e=t.element(),Cr.set(e,fs,n)});var o=Yl({getSystem:e.get,config:K.none,hasConfigured:V.constant(!1),connect:function(n){e.set(n)},disconnect:function(){e.set(Ol(function(){return o}))},element:V.constant(t.element()),spec:V.constant(n),readState:V.constant("No state"),syncComponents:V.noop,components:V.constant([]),events:V.constant({})});return rs(o)},ed=function(e){return(n=e,qt(n,ts)).fold(function(){var n=W.deepMerge({uid:ms("")},e);return Ql(n).getOrDie()},function(n){return n});var n},td=rs,od="alloy.item-hover",rd="alloy.item-focus",id=function(n){(ni(n.element()).isNone()||eu.isFocused(n))&&(eu.isFocused(n)||eu.focus(n),Ce(n,od,{item:n}))},ud=function(n){Ce(n,rd,{item:n})},ad=V.constant(od),cd=V.constant(rd),sd=[Do("data"),Do("components"),Do("dom"),Ro("toggling"),No("itemBehaviours",{}),No("ignoreFocus",!1),No("domModification",{}),Ai("builder",function(n){return{dom:W.deepMerge(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:W.deepMerge(pr([n.toggling().fold($i.revoke,function(n){return $i.config(W.deepMerge({aria:{mode:"checked"}},n))}),eu.config({ignore:n.ignoreFocus(),onFocus:function(n){ud(n)}}),vc.config({mode:"execution"}),nf.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:Lo([(e=be(),o=Oe,Wo(e,function(e,t){e.getSystem().getByDom(t.event().target()).each(function(n){o(e,n,t)})})),qo(rn()),Wo(cn(),id),Wo(he(),eu.focus)]),components:n.components(),domModification:n.domModification(),eventOrder:n.eventOrder()};var e,o}),No("eventOrder",{})],fd=[Do("dom"),Do("components"),Ai("builder",function(n){return{dom:n.dom(),components:n.components(),events:Lo([(e=he(),Wo(e,function(n,e){e.stop()}))])};var e})],ld=V.constant("item-widget"),dd=V.constant([Uc({name:"widget",overrides:function(n){return{behaviours:pr([nf.config({store:{mode:"manual",getValue:function(){return n.data()},setValue:function(){}}})])}}})]),md=Co("type",{widget:[Do("uid"),Do("data"),Do("components"),Do("dom"),No("autofocus",!1),No("domModification",{}),es(dd()),Ai("builder",function(t){var n=Yc(ld(),t,dd()),e=Jc(ld(),t,n.internals()),o=function(n){return Qc(n,t,"widget").map(function(n){return vc.focusIn(n),n})},r=function(n,e){return Yu(e.event().target())||t.autofocus()&&e.setSource(n.element()),K.none()};return W.deepMerge({dom:t.dom(),components:e,domModification:t.domModification(),events:Lo([Yo(function(n,e){o(n).each(function(){e.stop()})}),Wo(cn(),id),Wo(he(),function(n){t.autofocus()?o(n):eu.focus(n)})]),behaviours:pr([nf.config({store:{mode:"memory",initialValue:t.data()}}),eu.config({onFocus:function(n){ud(n)}}),vc.config({mode:"special",focusIn:t.autofocus()?function(n){o(n)}:yr(),onLeft:r,onRight:r,onEscape:function(n,e){return eu.isFocused(n)||t.autofocus()?(t.autofocus()&&e.setSource(n.element()),K.none()):(eu.focus(n),K.some(!0))}})])})})],item:sd,separator:fd}),gd=V.constant([$c({factory:{sketch:function(n){var e=To("menu.spec item",md,n);return e.builder()(e)}},name:"items",unit:"item",defaults:function(n,e){var t=ms("");return W.deepMerge({uid:t},e)},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})]),pd=V.constant([Do("value"),Do("items"),Do("dom"),Do("components"),No("eventOrder",{}),bc("menuBehaviours",[Gu,nf,Wf,vc]),Vo("movement",{mode:"menu",moveOnTab:!0},Co("mode",{grid:[Ri(),Ai("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:e.initSize().numColumns(),numRows:e.initSize().numRows()},focusManager:n.focusManager()}})],menu:[No("moveOnTab",!0),Ai("config",function(n,e){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:e.moveOnTab(),focusManager:n.focusManager()}})]})),Mo("markers",Ti()),No("fakeFocus",!1),No("focusManager",$u()),Oi("onHighlight")]),hd=(V.constant("menu"),V.constant("alloy.menu-focus")),vd=ws({name:"Menu",configFields:pd(),partFields:gd(),factory:function(n,e){return W.deepMerge({dom:W.deepMerge(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:W.deepMerge(pr([Gu.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),nf.config({store:{mode:"memory",initialValue:n.value()}}),Wf.config({find:V.identity}),vc.config(n.movement().config()(n,n.movement()))]),yc(n.menuBehaviours())),events:Lo([Wo(cd(),function(e,t){var n=t.event();e.getSystem().getByDom(n.target()).each(function(n){Gu.highlight(e,n),t.stop(),Ce(e,hd(),{menu:e,item:n})})}),Wo(ad(),function(n,e){var t=e.event().item();Gu.highlight(n,t)})]),components:e,eventOrder:n.eventOrder()})}}),bd=function(n,e,t,o){var r=n.getSystem().build(o);St(n,r,t)},yd=function(n){return n.components()},wd=Object.freeze({append:function(n,e,t,o){bd(n,0,pt.append,o)},prepend:function(n,e,t,o){bd(n,0,pt.prepend,o)},remove:function(n,e,t,o){var r=yd(n,e);Gn.find(r,function(n){return rt(o.element(),n.element())}).each(kt)},set:function(e,n,t,o){var r,i,u,a,c,s;i=(r=e).components(),Gn.each(i,Tt),bt.empty(r.element()),r.syncComponents(),u=function(){var n=Gn.map(o,e.getSystem().build);Gn.each(n,function(n){xt(e,n)})},a=e.element(),c=dt.owner(a),s=Zr(c).bind(function(e){var n=function(n){return rt(e,n)};return n(a)?K.some(a):Kr.descendant(a,n)}),u(a),s.each(function(e){Zr(c).filter(function(n){return rt(n,e)}).orThunk(function(){Jr(e)})})},contents:yd}),xd=vr({fields:[],name:"replacing",apis:wd}),Sd=function(t,o,r,n){return qt(r,n).bind(function(n){return qt(t,n).bind(function(n){var e=Sd(t,o,r,n);return K.some([n].concat(e))})}).getOr([])},Td=function(n,e){var t={};nn.each(n,function(n,e){Gn.each(n,function(n){t[n]=e})});var o,r=e,i=(o=e,nn.tupleMap(o,function(n,e){return{k:n,v:e}})),u=nn.map(i,function(n,e){return[e].concat(Sd(t,r,i,e))});return nn.map(t,function(n){return qt(u,n).getOr([n])})},kd=V.constant("collapse-item"),Cd=ys({name:"TieredMenu",configFields:[Mi("onExecute"),Mi("onEscape"),Di("onOpenMenu"),Di("onOpenSubmenu"),Oi("onCollapseMenu"),No("openImmediately",!0),Bo("data",[Do("primary"),Do("menus"),Do("expansions")]),No("fakeFocus",!1),Oi("onHighlight"),Oi("onHover"),Bo("markers",[Do("backgroundMenu")].concat(xi()).concat(Si())),Do("dom"),No("navigateOnHover",!0),No("stayInDom",!1),bc("tmenuBehaviours",[vc,Gu,Wf,xd]),No("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)}},factory:function(u,r){var a,c,s,f,l,n,o=function(o,n){return nn.map(n,function(n,e){var t=vd.sketch(W.deepMerge(n,{value:e,items:n.items,markers:Wt(r.markers,["item","selectedItem"]),fakeFocus:u.fakeFocus(),onHighlight:u.onHighlight(),focusManager:u.fakeFocus()?{get:function(n){return Gu.getHighlighted(n).map(function(n){return n.element()})},set:function(e,n){e.getSystem().getByDom(n).fold(V.noop,function(n){Gu.highlight(e,n)})}}:$u()}));return o.getSystem().build(t)})},i=(a=Gr({}),c=Gr({}),s=Gr({}),f=Gr(K.none()),l=Gr(V.constant([])),{setContents:function(n,e,t,o){f.set(K.some(n)),a.set(t),c.set(e),l.set(o);var r=o(e),i=Td(r,t);s.set(i)},expand:function(t){return qt(a.get(),t).map(function(n){var e=qt(s.get(),t).getOr([]);return[n].concat(e)})},refresh:function(n){return qt(s.get(),n)},collapse:function(n){return qt(s.get(),n).bind(function(n){return 1<n.length?K.some(n.slice(1)):K.none()})},lookupMenu:n=function(n){return qt(c.get(),n)},otherMenus:function(n){var e=l.get()(c.get());return Gn.difference(nn.keys(e),n)},getPrimary:function(){return f.get().bind(n)},getMenus:function(){return c.get()},clear:function(){a.set({}),c.set({}),s.set({}),f.set(K.none())},isClear:function(){return f.get().isNone()}}),d=function(n){return nf.getValue(n).value},m=function(){return nn.map(u.data().menus(),function(n){return Gn.bind(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},g=function(e,n){Gu.highlight(e,n),Gu.getHighlighted(n).orThunk(function(){return Gu.getFirst(n)}).each(function(n){Ee(e,n.element(),he())})},p=function(n,e){return gi(Gn.map(e,n.lookupMenu))},h=function(o,r,i){return K.from(i[0]).bind(r.lookupMenu).map(function(n){var e=p(r,i.slice(1));Gn.each(e,function(n){zr.add(n.element(),u.markers().backgroundMenu())}),Ge.inBody(n.element())||xd.append(o,td(n)),$l.remove(n.element(),[u.markers().backgroundMenu()]),g(o,n);var t=p(r,r.otherMenus(i));return Gn.each(t,function(n){$l.remove(n.element(),[u.markers().backgroundMenu()]),u.stayInDom()||xd.remove(o,n)}),n})},v=function(e,t){var n=d(t);return i.expand(n).bind(function(n){return K.from(n[0]).bind(i.lookupMenu).each(function(n){Ge.inBody(n.element())||xd.append(e,td(n)),u.onOpenSubmenu()(e,t,n),Gu.highlightFirst(n)}),h(e,i,n)})},b=function(e,t){var n=d(t);return i.collapse(n).bind(function(n){return h(e,i,n).map(function(n){return u.onCollapseMenu()(e,t,n),n})})},e=function(t){return function(e,n){return xu(n.getSource(),"."+u.markers().item()).bind(function(n){return e.getSystem().getByDom(n).bind(function(n){return t(e,n)})})}},t=Lo([Wo(hd(),function(n,e){var t=e.event().menu();Gu.highlight(n,t)}),Yo(function(e,n){var t=n.event().target();return e.getSystem().getByDom(t).bind(function(n){return 0===d(n).indexOf("collapse-item")?b(e,n):v(e,n).orThunk(function(){return u.onExecute()(e,n)})})}),_o(function(e){var t,n;(t=e,n=o(t,u.data().menus()),i.setContents(u.data().primary(),n,u.data().expansions(),function(n){return m(t,n)}),i.getPrimary()).each(function(n){xd.append(e,td(n)),u.openImmediately()&&(g(e,n),u.onOpenMenu()(e,n))})})].concat(u.navigateOnHover()?[Wo(ad(),function(n,e){var t,o,r=e.event().item();t=n,o=d(r),i.refresh(o).bind(function(n){return h(t,i,n)}),v(n,r),u.onHover()(n,r)})]:[]));return{uid:u.uid(),dom:u.dom(),behaviours:W.deepMerge(pr([vc.config({mode:"special",onRight:e(function(n,e){return Yu(e.element())?K.none():v(n,e)}),onLeft:e(function(n,e){return Yu(e.element())?K.none():b(n,e)}),onEscape:e(function(n,e){return b(n,e).orThunk(function(){return u.onEscape()(n,e)})}),focusIn:function(e){i.getPrimary().each(function(n){Ee(e,n.element(),he())})}}),Gu.config({highlightClass:u.markers().selectedMenu(),itemClass:u.markers().menu()}),Wf.config({find:function(n){return Gu.getHighlighted(n)}}),xd.config({})]),yc(u.tmenuBehaviours())),eventOrder:u.eventOrder(),apis:{collapseMenu:function(e){Gu.getHighlighted(e).each(function(n){Gu.getHighlighted(n).each(function(n){b(e,n)})})}},events:t}},extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:_t(n,e),expansions:{}}},collapseItem:function(n){return{value:Mc(kd()),text:n}}}}),Od=function(n,e,t,o){return qt(e.routes(),o.start()).map(V.apply).bind(function(n){return qt(n,o.destination()).map(V.apply)})},Ed=function(n,e,t,o){return Od(0,e,0,o).bind(function(e){return e.transition().map(function(n){return{transition:V.constant(n),route:V.constant(e)}})})},Dd=function(t,o,n){var e,r,i;(e=t,r=o,i=n,Md(e,r,i).bind(function(n){return Ed(e,r,i,n)})).each(function(n){var e=n.transition();zr.remove(t.element(),e.transitionClass()),Cr.remove(t.element(),o.destinationAttr())})},Md=function(n,e){var t=n.element();return Cr.has(t,e.destinationAttr())?K.some({start:V.constant(Cr.get(n.element(),e.stateAttr())),destination:V.constant(Cr.get(n.element(),e.destinationAttr()))}):K.none()},Ad=function(n,e,t,o){Dd(n,e,t),Cr.has(n.element(),e.stateAttr())&&Cr.get(n.element(),e.stateAttr())!==o&&e.onFinish()(n,o),Cr.set(n.element(),e.stateAttr(),o)},Bd=Object.freeze({findRoute:Od,disableTransition:Dd,getCurrentRoute:Md,jumpTo:Ad,progressTo:function(t,o,r,i){var n,e;e=o,Cr.has((n=t).element(),e.destinationAttr())&&(Cr.set(n.element(),e.stateAttr(),Cr.get(n.element(),e.destinationAttr())),Cr.remove(n.element(),e.destinationAttr()));var u,a,c,s=(u=t,a=o,c=i,{start:V.constant(Cr.get(u.element(),a.stateAttr())),destination:V.constant(c)});Ed(t,o,r,s).fold(function(){Ad(t,o,r,i)},function(n){Dd(t,o,r);var e=n.transition();zr.add(t.element(),e.transitionClass()),Cr.set(t.element(),o.destinationAttr(),i)})},getState:function(n,e){var t=n.element();return Cr.has(t,e.stateAttr())?K.some(Cr.get(t,e.stateAttr())):K.none()}}),Rd=Object.freeze({events:function(r,i){return Lo([Wo(mn(),function(t,n){var o=n.event().raw();Md(t,r,i).each(function(e){Od(0,r,0,e).each(function(n){n.transition().each(function(n){o.propertyName===n.property()&&(Ad(t,r,i,e.destination()),r.onTransition()(t,e))})})})}),_o(function(n){Ad(n,r,i,r.initialState())})])}}),Id=[No("destinationAttr","data-transitioning-destination"),No("stateAttr","data-transitioning-state"),Do("initialState"),Oi("onTransition"),Oi("onFinish"),Mo("routes",lo(Et.value,lo(Et.value,co([Fo("transition",[Do("property"),Do("transitionClass")])]))))],Fd=vr({fields:Id,name:"transitioning",active:Rd,apis:Bd,extra:{createRoutes:function(n){var o={};return nn.each(n,function(n,e){var t=e.split("<->");o[t[0]]=_t(t[1],n),o[t[1]]=_t(t[0],n)}),o},createBistate:function(n,e,t){return Kt([{key:n,value:_t(e,t)},{key:e,value:_t(n,t)}])},createTristate:function(n,e,t,o){return Kt([{key:n,value:Kt([{key:e,value:o},{key:t,value:o}])},{key:e,value:Kt([{key:n,value:o},{key:t,value:o}])},{key:t,value:Kt([{key:n,value:o},{key:e,value:o}])}])}}}),Nd=Yi.resolve("scrollable"),Vd={register:function(n){zr.add(n,Nd)},deregister:function(n){zr.remove(n,Nd)},scrollable:V.constant(Nd)},Hd=function(n){return qt(n,"format").getOr(n.title)},jd=function(n,e,t,o,r){return{data:{value:n,text:e},type:"item",dom:{tag:"div",classes:r?[Yi.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:Yi.resolve("format-matches"),selected:t},itemBehaviours:pr(r?[]:[qi(n,function(n,e){(e?$i.on:$i.off)(n)})]),components:[{dom:{tag:"div",attributes:{style:o},innerHtml:e}}]}},zd=function(n,e,t,o){return{value:n,dom:{tag:"div"},components:[xs.sketch({dom:{tag:"div",classes:[Yi.resolve("styles-collapser")]},components:o?[{dom:{tag:"span",classes:[Yi.resolve("styles-collapse-icon")]}},Zl(n)]:[Zl(n)],action:function(n){if(o){var e=t().get(n);Cd.collapseMenu(e)}}}),{dom:{tag:"div",classes:[Yi.resolve("styles-menu-items-container")]},components:[vd.parts().items({})],behaviours:pr([zf("adhoc-scrollable-menu",[_o(function(n){cu.set(n.element(),"overflow-y","auto"),cu.set(n.element(),"-webkit-overflow-scrolling","touch"),Vd.register(n.element())}),Ko(function(n){cu.remove(n.element(),"overflow-y"),cu.remove(n.element(),"-webkit-overflow-scrolling"),Vd.deregister(n.element())})])])}],items:e,menuBehaviours:pr([Fd.config({initialState:"after",routes:Fd.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},Ld=function(o){var r,i,n,e,t,u=(r=o.formats,i=function(){return a},n=zd("Styles",[].concat(Gn.map(r.items,function(n){return jd(Hd(n),n.title,n.isSelected(),n.getPreview(),Yt(r.expansions,Hd(n)))})),i,!1),e=nn.map(r.menus,function(n,e){var t=Gn.map(n,function(n){return jd(Hd(n),n.title,n.isSelected!==undefined&&n.isSelected(),n.getPreview!==undefined?n.getPreview():"",Yt(r.expansions,Hd(n)))});return zd(e,t,i,!0)}),t=W.deepMerge(e,_t("styles",n)),{tmenu:Cd.tieredData("styles",t,r.expansions)}),a=xf(Cd.sketch({dom:{tag:"div",classes:[Yi.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(n,e){var t=nf.getValue(e);o.handle(e,t.value)},onEscape:function(){},onOpenMenu:function(n,e){var t=uf(n.element());rf(e.element(),t),Fd.jumpTo(e,"current")},onOpenSubmenu:function(n,e,t){var o=uf(n.element()),r=yu(e.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(r).getOrDie();rf(t.element(),o),Fd.progressTo(i,"before"),Fd.jumpTo(t,"after"),Fd.progressTo(t,"current")},onCollapseMenu:function(n,e,t){var o=yu(e.element(),'[role="menu"]').getOrDie("hacky"),r=n.getSystem().getByDom(o).getOrDie();Fd.progressTo(r,"after"),Fd.progressTo(t,"current")},navigateOnHover:!1,openImmediately:!0,data:u.tmenu,markers:{backgroundMenu:Yi.resolve("styles-background-menu"),menu:Yi.resolve("styles-menu"),selectedMenu:Yi.resolve("styles-selected-menu"),item:Yi.resolve("styles-item"),selectedItem:Yi.resolve("styles-selected-item")}}));return a.asSpec()},Pd=function(n){return Yt(n,"items")?(e=n,t=W.deepMerge(Ut(e,["items"]),{menu:!0}),o=Wd(e.items),{item:t,menus:W.deepMerge(o.menus,_t(e.title,o.items)),expansions:W.deepMerge(o.expansions,_t(e.title,e.title))}):{item:n,menus:{},expansions:{}};var e,t,o},Wd=function(n){return Gn.foldr(n,function(n,e){var t=Pd(e);return{menus:W.deepMerge(n.menus,t.menus),items:[t.item].concat(n.items),expansions:W.deepMerge(n.expansions,t.expansions)}},{menus:{},expansions:{},items:[]})},Ud={expand:Wd},Gd=function(a,n){var c=function(n){return function(){return a.formatter.match(n)}},s=function(n){return function(){return a.formatter.getCssText(n)}},e=qt(n,"style_formats").getOr(Sl),f=function(n){return Gn.map(n,function(n){if(Yt(n,"items")){var e=f(n.items);return W.deepMerge((u=n,W.deepMerge(u,{isSelected:V.constant(!1),getPreview:V.constant("")})),{items:e})}return Yt(n,"format")?(i=n,W.deepMerge(i,{isSelected:c(i.format),getPreview:s(i.format)})):(o=Mc((t=n).title),r=W.deepMerge(t,{format:o,isSelected:c(o),getPreview:s(o)}),a.formatter.register(o,r),r);var t,o,r,i,u})};return f(e)},$d=function(t,n,o){var e,r,i,u=(e=t,i=(r=function(n){return Gn.bind(n,function(n){return n.items!==undefined?0<r(n.items).length?[n]:[]:!Yt(n,"format")||e.formatter.canApply(n.format)?[n]:[]})})(n),Ud.expand(i));return Ld({formats:u,handle:function(n,e){t.undoManager.transact(function(){$i.isOn(n)?t.formatter.remove(e):t.formatter.apply(e)}),o()}})},qd=["undo","bold","italic","link","image","bullist","styleselect"],_d=function(n){var e=n.replace(/\|/g," ").trim();return 0<e.length?e.split(/\s+/):[]},Kd=function(n){return Gn.bind(n,function(n){return j.isArray(n)?Kd(n):_d(n)})},Xd=function(n){var e=n.toolbar!==undefined?n.toolbar:qd;return j.isArray(e)?Kd(e):_d(e)},Yd=function(o,r){var n=function(n){return function(){return Ms.forToolbarCommand(r,n)}},e=function(n){return function(){return Ms.forToolbarStateCommand(r,n)}},t=function(n,e,t){return function(){return Ms.forToolbarStateAction(r,n,e,t)}},i=n("undo"),u=n("redo"),a=e("bold"),c=e("italic"),s=e("underline"),f=n("removeformat"),l=t("unlink","link",function(){r.execCommand("unlink",null,!1)}),d=t("unordered-list","ul",function(){r.execCommand("InsertUnorderedList",null,!1)}),m=t("ordered-list","ol",function(){r.execCommand("InsertOrderedList",null,!1)}),g=Gd(r,r.settings),p=function(){return $d(r,g,function(){r.fire("scrollIntoView")})},h=function(n,e){return{isSupported:function(){return n.forall(function(n){return Yt(r.buttons,n)})},sketch:e}};return{undo:h(K.none(),i),redo:h(K.none(),u),bold:h(K.none(),a),italic:h(K.none(),c),underline:h(K.none(),s),removeformat:h(K.none(),f),link:h(K.none(),function(){return e=o,t=r,Ms.forToolbarStateAction(t,"link","link",function(){var n=xl(e,t);e.setContextToolbar(n),jf(t,function(){e.focusToolbar()}),Nf.query(t).each(function(n){t.selection.select(n.dom())})});var e,t}),unlink:h(K.none(),l),image:h(K.none(),function(){return Df(r)}),bullist:h(K.some("bullist"),d),numlist:h(K.some("numlist"),m),fontsizeselect:h(K.none(),function(){return e=r,n={onChange:function(n){bf.apply(e,n)},getInitialValue:function(){return bf.get(e)}},sf(o,"font-size",function(){return wf(n)});var e,n}),forecolor:h(K.none(),function(){return lf(o,r)}),styleselect:h(K.none(),function(){return Ms.forToolbar("style-formats",function(n){r.fire("toReading"),o.dropup().appear(p,$i.on,n)},pr([$i.config({toggleClass:Yi.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Fi.config({channels:Kt([Ki(ri.orientationChanged(),$i.off),Ki(ri.dropupDismissed(),$i.off)])})]))})}},Jd=function(n,t){var e=Xd(n),o={};return Gn.bind(e,function(n){var e=!Yt(o,n)&&Yt(t,n)&&t[n].isSupported()?[t[n].sketch()]:[];return o[n]=!0,e})},Qd=function(m,g){return function(n){if(m(n)){var e,t,o,r,i,u,a,c=Ae.fromDom(n.target),s=function(){n.stopPropagation()},f=function(){n.preventDefault()},l=V.compose(f,s),d=(e=c,t=n.clientX,o=n.clientY,r=s,i=f,u=l,a=n,{target:V.constant(e),x:V.constant(t),y:V.constant(o),stop:r,prevent:i,kill:u,raw:V.constant(a)});g(d)}}},Zd=function(n,e,t,o,r){var i=Qd(t,o);return n.dom().addEventListener(e,i,r),{unbind:V.curry(nm,n,e,i,r)}},nm=function(n,e,t,o){n.dom().removeEventListener(e,t,o)},em=function(n,e,t,o){return Zd(n,e,t,o,!1)},tm=function(n,e,t,o){return Zd(n,e,t,o,!0)},om=V.constant(!0),rm={bind:function(n,e,t){return em(n,e,om,t)},capture:function(n,e,t){return tm(n,e,om,t)}},im=function(n){var e=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:V.constant(e)}},um=im,am=function(o,e){var n=Ae.fromDom(o),r=null,t=rm.bind(n,"orientationchange",function(){clearInterval(r);var n=im(o);e.onChange(n),i(function(){e.onReady(n)})}),i=function(n){clearInterval(r);var e=o.innerHeight,t=0;r=setInterval(function(){e!==o.innerHeight?(clearInterval(r),
n(K.some(o.innerHeight))):20<t&&(clearInterval(r),n(K.none())),t++},50)};return{onAdjustment:i,destroy:function(){t.unbind()}}},cm=function(n){var e=fe.detect().os.isiOS(),t=im(n).isPortrait();return e&&!t?n.screen.height:n.screen.width},sm=function(n){return n.raw().touches===undefined||1!==n.raw().touches.length?K.none():K.some(n.raw().touches[0])},fm=function(t){var o,r,i,u=Gr(K.none()),a=(o=function(n){u.set(K.none()),t.triggerEvent(ye(),n)},r=400,i=null,{cancel:function(){null!==i&&(clearTimeout(i),i=null)},schedule:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=arguments;i=setTimeout(function(){o.apply(null,t),i=null},r)}}),c=Kt([{key:en(),value:function(t){return sm(t).each(function(n){a.cancel();var e={x:V.constant(n.clientX),y:V.constant(n.clientY),target:t.target};a.schedule(t),u.set(K.some(e))}),K.none()}},{key:tn(),value:function(n){return a.cancel(),sm(n).each(function(i){u.get().each(function(n){var e,t,o,r;e=i,t=n,o=Math.abs(e.clientX-t.x()),r=Math.abs(e.clientY-t.y()),(5<o||5<r)&&u.set(K.none())})}),K.none()}},{key:on(),value:function(e){return a.cancel(),u.get().filter(function(n){return rt(n.target(),e.target())}).map(function(){return t.triggerEvent(ve(),e)})}}]);return{fireIfReady:function(e,n){return qt(c,n).bind(function(n){return n(e)})}}},lm=function(t){var e=fm({triggerEvent:function(n,e){t.onTapContent(e)}});return{fireTouchstart:function(n){e.fireIfReady(n,"touchstart")},onTouchend:function(){return rm.bind(t.body(),"touchend",function(n){e.fireIfReady(n,"touchend")})},onTouchmove:function(){return rm.bind(t.body(),"touchmove",function(n){e.fireIfReady(n,"touchmove")})}}},dm=6<=fe.detect().os.version.major,mm=function(o,e,t){var r=lm(o),i=dt.owner(e),u=function(n){return!rt(n.start(),n.finish())||n.soffset()!==n.foffset()},n=function(){var n=o.doc().dom().hasFocus()&&o.getSelection().exists(u);t.getByDom(e).each(!0===(n||Zr(i).filter(function(n){return"input"===Pe.name(n)}).exists(function(n){return n.dom().selectionStart!==n.dom().selectionEnd}))?$i.on:$i.off)},a=[rm.bind(o.body(),"touchstart",function(n){o.onTouchContent(),r.fireTouchstart(n)}),r.onTouchmove(),r.onTouchend(),rm.bind(e,"touchstart",function(){o.onTouchToolstrip()}),o.onToReading(function(){Qr(o.body())}),o.onToEditing(V.noop),o.onScrollToCursor(function(n){n.preventDefault(),o.getCursorBox().each(function(n){var e=o.win(),t=n.top()>e.innerHeight||n.bottom()>e.innerHeight?n.bottom()-e.innerHeight+50:0;0!==t&&e.scrollTo(e.pageXOffset,e.pageYOffset+t)})})].concat(!0===dm?[]:[rm.bind(Ae.fromDom(o.win()),"blur",function(){t.getByDom(e).each($i.off)}),rm.bind(i,"select",n),rm.bind(o.doc(),"selectionchange",n)]);return{destroy:function(){Gn.each(a,function(n){n.unbind()})}}},gm=function(n,e){var t=parseInt(Cr.get(n,e),10);return isNaN(t)?0:t},pm=(M=Pe.isText,A="text",B=function(n){return M(n)?K.from(n.dom().nodeValue):K.none()},R=fe.detect().browser,{get:function(n){if(!M(n))throw new Error("Can only get "+A+" value of a "+A+" node");return I(n).getOr("")},getOption:I=R.isIE()&&10===R.version.major?function(n){try{return B(n)}catch(g){return K.none()}}:B,set:function(n,e){if(!M(n))throw new Error("Can only set raw "+A+" value of a "+A+" node");n.dom().nodeValue=e}}),hm=function(n){return pm.getOption(n)},vm=function(n){return"img"===Pe.name(n)?1:hm(n).fold(function(){return dt.children(n).length},function(n){return n.length})},bm=Dt([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),ym={before:bm.before,on:bm.on,after:bm.after,cata:function(n,e,t,o){return n.fold(e,t,o)},getStart:function(n){return n.fold(V.identity,V.identity,V.identity)}},wm=Dt([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),xm=_e.immutable("start","soffset","finish","foffset"),Sm={domRange:wm.domRange,relative:wm.relative,exact:wm.exact,exactFromRange:function(n){return wm.exact(n.start(),n.soffset(),n.finish(),n.foffset())},range:xm,getWin:function(n){var e=n.match({domRange:function(n){return Ae.fromDom(n.startContainer)},relative:function(n){return ym.getStart(n)},exact:function(n){return n}});return dt.defaultView(e)}},Tm=function(n,e,t,o){var r=dt.owner(n).dom().createRange();return r.setStart(n.dom(),e),r.setEnd(t.dom(),o),r},km=function(n,e,t,o){var r=Tm(n,e,t,o),i=rt(n,t)&&e===o;return r.collapsed&&!i},Cm=function(n,e){n.selectNodeContents(e.dom())},Om=function(n){n.deleteContents()},Em=function(n){return{left:V.constant(n.left),top:V.constant(n.top),right:V.constant(n.right),bottom:V.constant(n.bottom),width:V.constant(n.width),height:V.constant(n.height)}},Dm={create:function(n){return n.document.createRange()},replaceWith:function(n,e){Om(n),n.insertNode(e.dom())},selectNodeContents:function(n,e){var t=n.document.createRange();return Cm(t,e),t},selectNodeContentsUsing:Cm,relativeToNative:function(n,e,t){var o,r,i=n.document.createRange();return o=i,e.fold(function(n){o.setStartBefore(n.dom())},function(n,e){o.setStart(n.dom(),e)},function(n){o.setStartAfter(n.dom())}),r=i,t.fold(function(n){r.setEndBefore(n.dom())},function(n,e){r.setEnd(n.dom(),e)},function(n){r.setEndAfter(n.dom())}),i},exactToNative:function(n,e,t,o,r){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(o.dom(),r),i},deleteContents:Om,cloneFragment:function(n){var e=n.cloneContents();return Ae.fromDom(e)},getFirstRect:function(n){var e=n.getClientRects(),t=0<e.length?e[0]:n.getBoundingClientRect();return 0<t.width||0<t.height?K.some(t).map(Em):K.none()},getBounds:function(n){var e=n.getBoundingClientRect();return 0<e.width||0<e.height?K.some(e).map(Em):K.none()},isWithin:function(n,e){return e.compareBoundaryPoints(n.END_TO_START,n)<1&&-1<e.compareBoundaryPoints(n.START_TO_END,n)},toString:function(n){return n.toString()}},Mm=Dt([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),Am=function(n,e,t){return e(Ae.fromDom(t.startContainer),t.startOffset,Ae.fromDom(t.endContainer),t.endOffset)},Bm=function(n,e){var r,t,o,i=(r=n,e.match({domRange:function(n){return{ltr:V.constant(n),rtl:K.none}},relative:function(n,e){return{ltr:pn(function(){return Dm.relativeToNative(r,n,e)}),rtl:pn(function(){return K.some(Dm.relativeToNative(r,e,n))})}},exact:function(n,e,t,o){return{ltr:pn(function(){return Dm.exactToNative(r,n,e,t,o)}),rtl:pn(function(){return K.some(Dm.exactToNative(r,t,o,n,e))})}}}));return(o=(t=i).ltr()).collapsed?t.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return Mm.rtl(Ae.fromDom(n.endContainer),n.endOffset,Ae.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return Am(0,Mm.ltr,o)}):Am(0,Mm.ltr,o)},Rm=(Mm.ltr,Mm.rtl,Bm),Im=function(i,n){return Bm(i,n).match({ltr:function(n,e,t,o){var r=i.document.createRange();return r.setStart(n.dom(),e),r.setEnd(t.dom(),o),r},rtl:function(n,e,t,o){var r=i.document.createRange();return r.setStart(t.dom(),o),r.setEnd(n.dom(),e),r}})},Fm=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n,e){var t=Pe.name(n);return"input"===t?ym.after(n):Gn.contains(["br","img"],t)?0===e?ym.before(n):ym.after(n):ym.on(n,e)}),Nm=function(n,e,t,o){var r=Fm(n,e),i=Fm(t,o);return Sm.relative(r,i)},Vm=function(n,e){K.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(e)})},Hm=function(n,e,t,o,r){var i=Dm.exactToNative(n,e,t,o,r);Vm(n,i)},jm=function(i,n){return Rm(i,n).match({ltr:function(n,e,t,o){Hm(i,n,e,t,o)},rtl:function(n,e,t,o){var r=i.getSelection();r.setBaseAndExtent?r.setBaseAndExtent(n.dom(),e,t.dom(),o):r.extend?(r.collapse(n.dom(),e),r.extend(t.dom(),o)):Hm(i,t,o,n,e)}})},zm=function(n){var e=Ae.fromDom(n.anchorNode),t=Ae.fromDom(n.focusNode);return km(e,n.anchorOffset,t,n.focusOffset)?K.some(Sm.range(Ae.fromDom(n.anchorNode),n.anchorOffset,Ae.fromDom(n.focusNode),n.focusOffset)):function(n){if(0<n.rangeCount){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return K.some(Sm.range(Ae.fromDom(e.startContainer),e.startOffset,Ae.fromDom(t.endContainer),t.endOffset))}return K.none()}(n)},Lm=function(n){return K.from(n.getSelection()).filter(function(n){return 0<n.rangeCount}).bind(zm)},Pm=function(n,e,t,o,r){var i=Nm(e,t,o,r);jm(n,i)},Wm=Lm,Um=function(n){return Lm(n).map(function(n){return Sm.exact(n.start(),n.soffset(),n.finish(),n.foffset())})},Gm=function(n){n.getSelection().removeAllRanges()},$m=function(n,e){var t=Im(n,e);return Dm.getFirstRect(t)},qm=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:V.constant(2),height:n.height}},_m=function(n){return{left:V.constant(n.left),top:V.constant(n.top),right:V.constant(n.right),bottom:V.constant(n.bottom),width:V.constant(n.width),height:V.constant(n.height)}},Km={getRectangles:function(n){var e=n.getSelection();return e!==undefined&&0<e.rangeCount?function(t){if(t.collapsed){var o=Ae.fromDom(t.startContainer);return dt.parent(o).bind(function(n){var e=Sm.exact(o,t.startOffset,n,vm(n));return $m(t.startContainer.ownerDocument.defaultView,e).map(qm).map(Gn.pure)}).getOr([])}return Gn.map(t.getClientRects(),_m)}(e.getRangeAt(0)):[]}},Xm=function(n){n.focus();var e=Ae.fromDom(n.document.body);(Zr().exists(function(n){return Gn.contains(["input","textarea"],Pe.name(n))})?function(n){setTimeout(function(){n()},0)}:V.apply)(function(){Zr().each(Qr),Jr(e)})},Ym="data-"+Yi.resolve("last-outer-height"),Jm=function(n,e){Cr.set(n,Ym,e)},Qm=function(n){return{top:V.constant(n.top()),bottom:V.constant(n.top()+n.height())}},Zm=function(n,e){var t=gm(e,Ym),o=n.innerHeight;return o<t?K.some(t-o):K.none()},ng=function(n,u){var e=Ae.fromDom(u.document.body),t=rm.bind(Ae.fromDom(n),"resize",function(){Zm(n,e).each(function(i){var n,e;(n=u,e=Km.getRectangles(n),0<e.length?K.some(e[0]).map(Qm):K.none()).each(function(n){var e,t,o,r=(e=u,o=i,(t=n).top()>e.innerHeight||t.bottom()>e.innerHeight?Math.min(o,t.bottom()-e.innerHeight+50):0);0!==r&&u.scrollTo(u.pageXOffset,u.pageYOffset+r)})}),Jm(e,n.innerHeight)});return Jm(e,n.innerHeight),{toEditing:function(){Xm(u)},destroy:function(){t.unbind()}}},eg=function(n){return K.some(Ae.fromDom(n.dom().contentWindow.document.body))},tg=function(n){return K.some(Ae.fromDom(n.dom().contentWindow.document))},og=function(n){return K.from(n.dom().contentWindow)},rg=function(n){return og(n).bind(Wm)},ig=function(n){return n.getFrame()},ug=function(n,t){return function(e){return e[n].getOrThunk(function(){var n=ig(e);return function(){return t(n)}})()}},ag=function(n,e,t,o){return n[t].getOrThunk(function(){return function(n){return rm.bind(e,o,n)}})},cg=function(n){return{left:V.constant(n.left),top:V.constant(n.top),right:V.constant(n.right),bottom:V.constant(n.bottom),width:V.constant(n.width),height:V.constant(n.height)}},sg={getBody:ug("getBody",eg),getDoc:ug("getDoc",tg),getWin:ug("getWin",og),getSelection:ug("getSelection",rg),getFrame:ig,getActiveApi:function(a){var c=ig(a);return eg(c).bind(function(u){return tg(c).bind(function(i){return og(c).map(function(r){var n=Ae.fromDom(i.dom().documentElement),e=a.getCursorBox.getOrThunk(function(){return function(){return Um(r).bind(function(n){return $m(r,n).orThunk(function(){return Wm(r).filter(function(n){return rt(n.start(),n.finish())&&n.soffset()===n.foffset()}).bind(function(n){var e=n.start().dom().getBoundingClientRect();return 0<e.width||0<e.height?K.some(e).map(cg):K.none()})})})}}),t=a.setSelection.getOrThunk(function(){return function(n,e,t,o){Pm(r,n,e,t,o)}}),o=a.clearSelection.getOrThunk(function(){return function(){Gm(r)}});return{body:V.constant(u),doc:V.constant(i),win:V.constant(r),html:V.constant(n),getSelection:V.curry(rg,c),setSelection:t,clearSelection:o,frame:V.constant(c),onKeyup:ag(a,i,"onKeyup","keyup"),onNodeChanged:ag(a,i,"onNodeChanged","selectionchange"),onDomChanged:a.onDomChanged,onScrollToCursor:a.onScrollToCursor,onScrollToElement:a.onScrollToElement,onToReading:a.onToReading,onToEditing:a.onToEditing,onToolbarScrollStart:a.onToolbarScrollStart,onTouchContent:a.onTouchContent,onTapContent:a.onTapContent,onTouchToolstrip:a.onTouchToolstrip,getCursorBox:e}})})})}},fg="data-ephox-mobile-fullscreen-style",lg="position:absolute!important;",dg="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;",mg=fe.detect().os.isAndroid(),gg=function(n,e){var t,o,r=function(o){return function(n){var e=Cr.get(n,"style"),t=e===undefined?"no-styles":e.trim();t!==o&&(Cr.set(n,fg,t),Cr.set(n,"style",o))}},i=gu(n,"*"),u=Gn.bind(i,function(n){return pu(n,"*")}),a=(t=e,(o=cu.get(t,"background-color"))!==undefined&&""!==o?"background-color:"+o+"!important":"background-color:rgb(255,255,255)!important;");Gn.each(u,r("display:none!important;")),Gn.each(i,r(lg+dg+a)),r((!0===mg?"":lg)+dg+a)(n)},pg=function(){var n=mu("["+fg+"]");Gn.each(n,function(n){var e=Cr.get(n,fg);"no-styles"!==e?Cr.set(n,"style",e):Cr.remove(n,"style"),Cr.remove(n,fg)})},hg=function(){var e=bu("head").getOrDie(),n=bu('meta[name="viewport"]').getOrThunk(function(){var n=Ae.fromTag("meta");return Cr.set(n,"name","viewport"),pt.append(e,n),n}),t=Cr.get(n,"content");return{maximize:function(){Cr.set(n,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){t!==undefined&&null!==t&&0<t.length?Cr.set(n,"content",t):Cr.set(n,"content","user-scalable=yes")}}},vg=function(e,n){var t=hg(),o=hl.api(),r=hl.api();return{enter:function(){n.hide(),zr.add(e.container,Yi.resolve("fullscreen-maximized")),zr.add(e.container,Yi.resolve("android-maximized")),t.maximize(),zr.add(e.body,Yi.resolve("android-scroll-reload")),o.set(ng(e.win,sg.getWin(e.editor).getOrDie("no"))),sg.getActiveApi(e.editor).each(function(n){gg(e.container,n.body()),r.set(mm(n,e.toolstrip,e.alloy))})},exit:function(){t.restore(),n.show(),zr.remove(e.container,Yi.resolve("fullscreen-maximized")),zr.remove(e.container,Yi.resolve("android-maximized")),pg(),zr.remove(e.body,Yi.resolve("android-scroll-reload")),r.clear(),o.clear()}}},bg=function(e,t){var o=null;return{cancel:function(){null!==o&&(clearTimeout(o),o=null)},throttle:function(){var n=arguments;null===o&&(o=setTimeout(function(){e.apply(null,n),n=o=null},t))}}},yg=function(e,t){var o=null;return{cancel:function(){null!==o&&(clearTimeout(o),o=null)},throttle:function(){var n=arguments;null!==o&&clearTimeout(o),o=setTimeout(function(){e.apply(null,n),n=o=null},t)}}},wg=function(n){var e=xf(Uf.sketch({dom:Cs('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:pr([$i.config({toggleClass:Yi.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),t=bg(n,200);return Uf.sketch({dom:Cs('<div class="${prefix}-disabled-mask"></div>'),components:[Uf.sketch({dom:Cs('<div class="${prefix}-content-container"></div>'),components:[xs.sketch({dom:Cs('<div class="${prefix}-content-tap-section"></div>'),components:[e.asSpec()],action:function(){t.throttle()},buttonBehaviours:pr([$i.config({toggleClass:Yi.resolve("mask-tap-icon-selected")})])})]})]})},xg=so([Bo("editor",[Do("getFrame"),Ro("getBody"),Ro("getDoc"),Ro("getWin"),Ro("getSelection"),Ro("setSelection"),Ro("clearSelection"),Ro("cursorSaver"),Ro("onKeyup"),Ro("onNodeChanged"),Ro("getCursorBox"),Do("onDomChanged"),No("onTouchContent",V.noop),No("onTapContent",V.noop),No("onTouchToolstrip",V.noop),No("onScrollToCursor",V.constant({unbind:V.noop})),No("onScrollToElement",V.constant({unbind:V.noop})),No("onToEditing",V.constant({unbind:V.noop})),No("onToReading",V.constant({unbind:V.noop})),No("onToolbarScrollStart",V.identity)]),Do("socket"),Do("toolstrip"),Do("dropup"),Do("toolbar"),Do("container"),Do("alloy"),Ho("win",function(n){return dt.owner(n.socket).dom().defaultView}),Ho("body",function(n){return Ae.fromDom(n.socket.dom().ownerDocument.body)}),No("translate",V.identity),No("setReadOnly",V.noop),No("readOnlyOnInit",V.constant(!0))]),Sg={produce:function(n){var e=So("Getting AndroidWebapp schema",xg,n);cu.set(e.toolstrip,"width","100%");var t=ed(wg(function(){e.setReadOnly(e.readOnlyOnInit()),r.enter()},e.translate));e.alloy.add(t);var o={show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}};pt.append(e.container,t.element());var r=vg(e,o);return{setReadOnly:e.setReadOnly,refreshStructure:V.noop,enter:r.enter,exit:r.exit,destroy:V.noop}}},Tg=V.constant([No("shell",!0),bc("toolbarBehaviours",[xd])]),kg=V.constant([Gc({name:"groups",overrides:function(){return{behaviours:pr([xd.config({})])}}})]),Cg=(V.constant("Toolbar"),ws({name:"Toolbar",configFields:Tg(),partFields:kg(),factory:function(e,n){var t=function(n){return e.shell()?K.some(n):Qc(n,e,"groups")},o=e.shell()?{behaviours:[xd.config({})],components:[]}:{behaviours:[],components:n};return{uid:e.uid(),dom:e.dom(),components:o.components,behaviours:W.deepMerge(pr(o.behaviours),yc(e.toolbarBehaviours())),apis:{setGroups:function(n,e){t(n).fold(function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(n){xd.set(n,e)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,e,t){n.setGroups(e,t)}}})),Og=V.constant([Do("items"),(F=["itemClass"],Bo("markers",Gn.map(F,Do))),bc("tgroupBehaviours",[vc])]),Eg=V.constant([$c({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})]),Dg=(V.constant("ToolbarGroup"),ws({name:"ToolbarGroup",configFields:Og(),partFields:Eg(),factory:function(n,e,t){return W.deepMerge({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:e,behaviours:W.deepMerge(pr([vc.config({mode:"flow",selector:"."+n.markers().itemClass()})]),yc(n.tgroupBehaviours())),"debug.sketcher":t["debug.sketcher"]})}})),Mg="data-"+Yi.resolve("horizontal-scroll"),Ag=function(n){return 0<n.dom().scrollTop||function(n){n.dom().scrollTop=1;var e=0!==n.dom().scrollTop;return n.dom().scrollTop=0,e}(n)},Bg=function(n){return 0<n.dom().scrollLeft||function(n){n.dom().scrollLeft=1;var e=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,e}(n)},Rg=function(n){return"true"===Cr.get(n,Mg)?Bg:Ag},Ig={exclusive:function(n,e){return rm.bind(n,"touchmove",function(n){xu(n.target(),e).filter(Rg).fold(function(){n.raw().preventDefault()},V.noop)})},markAsHorizontal:function(n){Cr.set(n,Mg,"true")}},Fg=function(n,e){xd.append(n,td(e))},Ng=function(n,e){xd.remove(n,e)},Vg={makeEditSwitch:function(n){return ed(xs.sketch({dom:Cs('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run(function(n){n.setReadOnly(!1)})}}))},makeSocket:function(){return ed(Uf.sketch({dom:Cs('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:pr([xd.config({})])}))},updateMode:function(n,e,t,o){(!0===t?Ur.toAlpha:Ur.toOmega)(o),(t?Fg:Ng)(n,e)}},Hg=function(e,n){return n.getAnimationRoot().fold(function(){return e.element()},function(n){return n(e)})},jg=function(n){return n.dimension().property()},zg=function(n,e){return n.dimension().getDimension()(e)},Lg=function(n,e){var t=Hg(n,e);$l.remove(t,[e.shrinkingClass(),e.growingClass()])},Pg=function(n,e){zr.remove(n.element(),e.openClass()),zr.add(n.element(),e.closedClass()),cu.set(n.element(),jg(e),"0px"),cu.reflow(n.element())},Wg=function(n,e){zr.remove(n.element(),e.closedClass()),zr.add(n.element(),e.openClass()),cu.remove(n.element(),jg(e))},Ug=function(n,e,t){t.setCollapsed(),cu.set(n.element(),jg(e),zg(e,n.element())),cu.reflow(n.element());var o=Hg(n,e);zr.add(o,e.shrinkingClass()),Pg(n,e),e.onStartShrink()(n)},Gg=function(n,e,t){var o=function(n,e){Wg(n,e);var t=zg(e,n.element());return Pg(n,e),t}(n,e),r=Hg(n,e);zr.add(r,e.growingClass()),Wg(n,e),cu.set(n.element(),jg(e),o),t.setExpanded(),e.onStartGrow()(n)},$g=function(n,e){var t=Hg(n,e);return!0===zr.has(t,e.growingClass())},qg=function(n,e){var t=Hg(n,e);return!0===zr.has(t,e.shrinkingClass())},_g=Object.freeze({grow:function(n,e,t){t.isExpanded()||Gg(n,e,t)},shrink:function(n,e,t){t.isExpanded()&&Ug(n,e,t)},immediateShrink:function(n,e,t){var o,r;t.isExpanded()&&(o=n,r=e,t.setCollapsed(),cu.set(o.element(),jg(r),zg(r,o.element())),cu.reflow(o.element()),Lg(o,r),Pg(o,r),r.onStartShrink()(o),r.onShrunk()(o))},hasGrown:function(n,e,t){return t.isExpanded()},hasShrunk:function(n,e,t){return t.isCollapsed()},isGrowing:$g,isShrinking:qg,isTransitioning:function(n,e){return!0===$g(n,e)||!0===qg(n,e)},toggleGrow:function(n,e,t){(t.isExpanded()?Ug:Gg)(n,e,t)},disableTransitions:Lg}),Kg=Object.freeze({exhibit:function(n,e){var t=e.expanded();return er(t?{classes:[e.openClass()],styles:{}}:{classes:[e.closedClass()],styles:_t(e.dimension().property(),"0px")})},events:function(t,o){return Lo([Wo(mn(),function(n,e){e.event().raw().propertyName===t.dimension().property()&&(Lg(n,t),o.isExpanded()&&cu.remove(n.element(),t.dimension().property()),(o.isExpanded()?t.onGrown():t.onShrunk())(n,e))})])}}),Xg=[Do("closedClass"),Do("openClass"),Do("shrinkingClass"),Do("growingClass"),Ro("getAnimationRoot"),Oi("onShrunk"),Oi("onStartShrink"),Oi("onGrown"),Oi("onStartGrow"),No("expanded",!1),Mo("dimension",Co("property",{width:[Ai("property","width"),Ai("getDimension",function(n){return uf(n)+"px"})],height:[Ai("property","height"),Ai("getDimension",function(n){return fu(n)+"px"})]}))],Yg=Object.freeze({init:function(n){var e=Gr(n.expanded());return dr({isExpanded:function(){return!0===e.get()},isCollapsed:function(){return!1===e.get()},setCollapsed:V.curry(e.set,!1),setExpanded:V.curry(e.set,!0),readState:function(){return"expanded: "+e.get()}})}}),Jg=vr({fields:Xg,name:"sliding",active:Kg,apis:_g,state:Yg}),Qg=function(e,t){var o=ed(Uf.sketch({dom:{tag:"div",classes:Yi.resolve("dropup")},components:[],containerBehaviours:pr([xd.config({}),Jg.config({closedClass:Yi.resolve("dropup-closed"),openClass:Yi.resolve("dropup-open"),shrinkingClass:Yi.resolve("dropup-shrinking"),growingClass:Yi.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(n){e(),t(),xd.set(n,[])},onGrown:function(){e(),t()}}),_i(function(){n(V.noop)})])})),n=function(n){window.requestAnimationFrame(function(){n(),Jg.shrink(o)})};return{appear:function(n,e,t){!0===Jg.hasShrunk(o)&&!1===Jg.isTransitioning(o)&&window.requestAnimationFrame(function(){e(t),xd.set(o,[n()]),Jg.grow(o)})},disappear:n,component:V.constant(o),element:o.element}},Zg=fe.detect().browser.isFirefox(),np=co([Ao("triggerEvent"),Ao("broadcastEvent"),No("stopBackspace",!0)]),ep=function(e,n){var t,o,r,i,u=So("Getting GUI events settings",np,n),a=fe.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],c=fm(u),s=Gn.map(a.concat(["selectstart","input","contextmenu","change","transitionend","dragstart","dragover","drop"]),function(n){return rm.bind(e,n,function(e){c.fireIfReady(e,n).each(function(n){n&&e.kill()}),u.triggerEvent(n,e)&&e.kill()})}),f=rm.bind(e,"keydown",function(n){var e;u.triggerEvent("keydown",n)?n.kill():!0!==u.stopBackspace||(e=n).raw().which!==Su.BACKSPACE()[0]||Gn.contains(["input","textarea"],Pe.name(e.target()))||n.prevent()}),l=(t=e,o=function(n){u.triggerEvent("focusin",n)&&n.kill()},Zg?rm.capture(t,"focus",o):rm.bind(t,"focusin",o)),d=(r=e,i=function(n){u.triggerEvent("focusout",n)&&n.kill(),setTimeout(function(){u.triggerEvent(me(),n)},0)},Zg?rm.capture(r,"blur",i):rm.bind(r,"focusout",i)),m=dt.defaultView(e),g=rm.bind(m,"scroll",function(n){u.broadcastEvent(xe(),n)&&n.kill()});return{unbind:function(){Gn.each(s,function(n){n.unbind()}),f.unbind(),l.unbind(),d.unbind(),g.unbind()}}},tp=function(n,e){var t=qt(n,"target").map(function(n){return n()}).getOr(e);return Gr(t)},op=Dt([{stopped:[]},{resume:["element"]},{complete:[]}]),rp=function(n,o,e,t,r,i){var u,a,c,s,f=n(o,t),l=(u=e,a=r,c=Gr(!1),s=Gr(!1),{stop:function(){c.set(!0)},cut:function(){s.set(!0)},isStopped:c.get,isCut:s.get,event:V.constant(u),setSource:a.set,getSource:a.get});return f.fold(function(){return i.logEventNoHandlers(o,t),op.complete()},function(e){var t=e.descHandler();return Hl(t)(l),l.isStopped()?(i.logEventStopped(o,e.element(),t.purpose()),op.stopped()):l.isCut()?(i.logEventCut(o,e.element(),t.purpose()),op.complete()):dt.parent(e.element()).fold(function(){return i.logNoParent(o,e.element(),t.purpose()),op.complete()},function(n){return i.logEventResponse(o,e.element(),t.purpose()),op.resume(n)})})},ip=function(e,t,o,n,r,i){return rp(e,t,o,n,r,i).fold(function(){return!0},function(n){return ip(e,t,o,n,r,i)},function(){return!1})},up=function(n,e){var t,o,r=(t=e,o=Gr(!1),{stop:function(){o.set(!0)},cut:V.noop,isStopped:o.get,isCut:V.constant(!1),event:V.constant(t),setTarget:V.die("Cannot set target of a broadcasted event"),getTarget:V.die("Cannot get target of a broadcasted event")});return Gn.each(n,function(n){var e=n.descHandler();Hl(e)(r)}),r.isStopped()},ap=function(n,e,t,o,r){var i=tp(t,o);return ip(n,e,t,o,i,r)},cp=function(n,e,t){return Kr.closest(n,function(n){return e(n).isSome()},t).bind(e)},sp=_e.immutable("element","descHandler"),fp=function(n,e){return{id:V.constant(n),descHandler:V.constant(e)}},lp=function(t){var o=function(e){return dt.parent(t.element()).fold(function(){return!0},function(n){return rt(e,n)})},r=p(),s=function(n,e){return r.find(o,n,e)},n=ep(t.element(),{triggerEvent:function(u,a){return wi(u,a.target(),function(n){return e=s,t=u,r=n,i=(o=a).target(),ap(e,t,o,i,r);var e,t,o,r,i})},broadcastEvent:function(n,e){var t=r.filter(n);return up(t,e)}}),i=Cl({debugInfo:V.constant("real"),triggerEvent:function(e,t,o){wi(e,t,function(n){ap(s,e,o,t,n)})},triggerFocus:function(a,c){ds(a).fold(function(){Jr(a)},function(){wi(de(),a,function(n){var e,t,o,r,i,u;e=s,t=de(),o={originator:V.constant(c),target:V.constant(a)},i=n,u=tp(o,r=a),rp(e,t,o,r,u,i)})})},triggerEscape:function(n,e){i.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return m(n)},getByDom:function(n){return g(n)},build:ed,addToGui:function(n){a(n)},removeFromGui:function(n){c(n)},addToWorld:function(n){e(n)},removeFromWorld:function(n){u(n)},broadcast:function(n){l(n)},broadcastOn:function(n,e){d(n,e)},isConnected:V.constant(!0)}),e=function(n){n.connect(i),Pe.isText(n.element())||(r.register(n),Gn.each(n.components(),e),i.triggerEvent(we(),n.element(),{target:V.constant(n.element())}))},u=function(n){Pe.isText(n.element())||(Gn.each(n.components(),u),r.unregister(n)),n.disconnect()},a=function(n){xt(t,n)},c=function(n){kt(n)},f=function(t){var n=r.filter(ge());Gn.each(n,function(n){var e=n.descHandler();Hl(e)(t)})},l=function(n){f({universal:V.constant(!0),data:V.constant(n)})},d=function(n,e){f({universal:V.constant(!1),channels:V.constant(n),data:V.constant(e)})},m=function(n){return r.getById(n).fold(function(){return Et.error(new Error('Could not find component with uid: "'+n+'" in system.'))},Et.value)},g=function(n){var e=ds(n).getOr("not found");return m(e)};return e(t),{root:V.constant(t),element:t.element,destroy:function(){n.unbind(),bt.remove(t.element())},add:a,remove:c,getByUid:m,getByDom:g,addToWorld:e,removeFromWorld:u,broadcast:l,broadcastOn:d}},dp=V.constant(Yi.resolve("readonly-mode")),mp=V.constant(Yi.resolve("edit-mode")),gp=function(n,e){var t=Ae.fromTag("input");cu.setAll(t,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),pt.append(n,t),Jr(t),e(t),bt.remove(t)},pp=function(n){var e=n.getSelection();if(0<e.rangeCount){var t=e.getRangeAt(0),o=n.document.createRange();o.setStart(t.startContainer,t.startOffset),o.setEnd(t.endContainer,t.endOffset),e.removeAllRanges(),e.addRange(o)}},hp={resume:function(n,e){Zr().each(function(n){rt(n,e)||Qr(n)}),n.focus(),Jr(Ae.fromDom(n.document.body)),pp(n)}},vp={stubborn:function(n,e,t,o){var r=function(){hp.resume(e,o)},i=rm.bind(t,"keydown",function(n){Gn.contains(["input","textarea"],Pe.name(n.target()))||r()});return{toReading:function(){gp(n,Qr)},toEditing:r,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},timid:function(n,e,t,o){var r=function(){Qr(o)};return{toReading:function(){r()},toEditing:function(){hp.resume(e,o)},onToolbarTouch:function(){r()},destroy:V.noop}}},bp=function(t,o,r,i){var u=function(){o.run(function(n){n.refreshSelection()})},e=function(n,e){var t=n-i.dom().scrollTop;o.run(function(n){n.scrollIntoView(t,t+e)})},a=function(){o.run(function(n){n.clearSelection()})},c=function(){t.getCursorBox().each(function(n){e(n.top(),n.height())}),o.run(function(n){n.syncHeight()})},s=lm(t),f=yg(c,300),n=[t.onKeyup(function(){a(),f.throttle()}),t.onNodeChanged(u),t.onDomChanged(f.throttle),t.onDomChanged(u),t.onScrollToCursor(function(n){n.preventDefault(),f.throttle()}),t.onScrollToElement(function(n){n.element(),e(o,i)}),t.onToEditing(function(){o.run(function(n){n.toEditing()})}),t.onToReading(function(){o.run(function(n){n.toReading()})}),rm.bind(t.doc(),"touchend",function(n){rt(t.html(),n.target())||rt(t.body(),n.target())}),rm.bind(r,"transitionend",function(n){var e;"height"===n.raw().propertyName&&(e=fu(r),o.run(function(n){n.setViewportOffset(e)}),u(),c())}),rm.capture(r,"touchstart",function(n){var e;o.run(function(n){n.highlightSelection()}),e=n,o.run(function(n){n.onToolbarTouch(e)}),t.onTouchToolstrip()}),rm.bind(t.body(),"touchstart",function(n){a(),t.onTouchContent(),s.fireTouchstart(n)}),s.onTouchmove(),s.onTouchend(),rm.bind(t.body(),"click",function(n){n.kill()}),rm.bind(r,"touchmove",function(){t.onToolbarScrollStart()})];return{destroy:function(){Gn.each(n,function(n){n.unbind()})}}},yp=function(n){var t=K.none(),e=[],o=function(n){r()?u(n):e.push(n)},r=function(){return t.isSome()},i=function(n){Gn.each(n,u)},u=function(e){t.each(function(n){setTimeout(function(){e(n)},0)})};return n(function(n){t=K.some(n),i(e),e=[]}),{get:o,map:function(t){return yp(function(e){o(function(n){e(t(n))})})},isReady:r}},wp={nu:yp,pure:function(e){return yp(function(n){n(e)})}},xp=function(t){return function(){var n=Array.prototype.slice.call(arguments),e=this;setTimeout(function(){t.apply(e,n)},0)}},Sp=function(e){var r=function(n){e(xp(n))};return{map:function(o){return Sp(function(t){r(function(n){var e=o(n);t(e)})})},bind:function(t){return Sp(function(e){r(function(n){t(n).get(e)})})},anonBind:function(e){return Sp(function(n){r(function(){e.get(n)})})},toLazy:function(){return wp.nu(r)},get:r}},Tp={nu:Sp,pure:function(e){return Sp(function(n){n(e)})}},kp=function(n,e,t){return Math.abs(n-e)<=t?K.none():n<e?K.some(n+t):K.some(n-t)},Cp=function(){var s=null;return{animate:function(o,r,n,i,e,t){var u=!1,a=function(n){u=!0,e(n)};clearInterval(s);var c=function(n){clearInterval(s),a(n)};s=setInterval(function(){var t=o();kp(t,r,n).fold(function(){clearInterval(s),a(r)},function(n){if(i(n,c),!u){var e=o();(e!==n||Math.abs(e-r)>Math.abs(t-r))&&(clearInterval(s),a(r))}})},t)}}},Op=function(e,t){return pi([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(n){return e<=n.width&&t<=n.height?K.some(n.keyboard):K.none()}).getOr({portrait:t/5,landscape:e/4})},Ep=function(n){var e,t=um(n).isPortrait(),o=Op((e=n).screen.width,e.screen.height),r=t?o.portrait:o.landscape;return(t?n.screen.height:n.screen.width)-n.innerHeight>r?0:r},Dp=function(n,e){var t=dt.owner(n).dom().defaultView;return fu(n)+fu(e)-Ep(t)},Mp=Dp,Ap=function(n,e,t){var o=Dp(e,t),r=fu(e)+fu(t)-o;cu.set(n,"padding-bottom",r+"px")},Bp=Dt([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),Rp="data-"+Yi.resolve("position-y-fixed"),Ip="data-"+Yi.resolve("y-property"),Fp="data-"+Yi.resolve("scrolling"),Np="data-"+Yi.resolve("last-window-height"),Vp=function(n){return gm(n,Rp)},Hp=function(n,e){var t=Cr.get(n,Ip);return Bp.fixed(n,t,e)},jp=function(n,e){return Bp.scroller(n,e)},zp=function(n){var e=Vp(n);return("true"===Cr.get(n,Fp)?jp:Hp)(n,e)},Lp=function(n,e,t){var o=dt.owner(n).dom().defaultView.innerHeight;return Cr.set(n,Np,o+"px"),o-e-t},Pp=function(n){var e=hu(n,"["+Rp+"]");return Gn.map(e,zp)},Wp=function(o,r,i,u){var n,e,t,a,c,s,f,l,d=dt.owner(o).dom().defaultView,m=(l=Cr.get(f=i,"style"),cu.setAll(f,{position:"absolute",top:"0px"}),Cr.set(f,Rp,"0px"),Cr.set(f,Ip,"top"),{restore:function(){Cr.set(f,"style",l||""),Cr.remove(f,Rp),Cr.remove(f,Ip)}}),g=fu(i),p=fu(u),h=(a=Lp(o,t=g,p),s=Cr.get(c=o,"style"),Vd.register(c),cu.setAll(c,{position:"absolute",height:a+"px",width:"100%",top:t+"px"}),Cr.set(c,Rp,t+"px"),Cr.set(c,Fp,"true"),
Cr.set(c,Ip,"top"),{restore:function(){Vd.deregister(c),Cr.set(c,"style",s||""),Cr.remove(c,Rp),Cr.remove(c,Fp),Cr.remove(c,Ip)}}),v=(e=Cr.get(n=u,"style"),cu.setAll(n,{position:"absolute",bottom:"0px"}),Cr.set(n,Rp,"0px"),Cr.set(n,Ip,"bottom"),{restore:function(){Cr.set(n,"style",e||""),Cr.remove(n,Rp),Cr.remove(n,Ip)}}),b=!0,y=function(){var n=d.innerHeight;return gm(o,Np)<n},w=function(){if(b){var n=fu(i),e=fu(u),t=Lp(o,n,e);Cr.set(o,Rp,n+"px"),cu.set(o,"height",t+"px"),cu.set(u,"bottom",-(n+t+e)+"px"),Ap(r,o,u)}};return Ap(r,o,u),{setViewportOffset:function(n){Cr.set(o,Rp,n+"px"),w()},isExpanding:y,isShrinking:V.not(y),refresh:w,restore:function(){b=!1,m.restore(),h.restore(),v.restore()}}},Up=Vp,Gp=Cp(),$p="data-"+Yi.resolve("last-scroll-top"),qp=function(n){var e=cu.getRaw(n,"top").getOr(0);return parseInt(e,10)},_p=function(n){return parseInt(n.dom().scrollTop,10)},Kp=function(n,e){var t=e+Up(n)+"px";cu.set(n,"top",t)},Xp=function(t,o,r){return Tp.nu(function(n){var e=V.curry(_p,t);Gp.animate(e,o,15,function(n){t.dom().scrollTop=n,cu.set(t,"top",qp(t)+15+"px")},function(){t.dom().scrollTop=o,cu.set(t,"top",r+"px"),n(o)},10)})},Yp=function(r,i){return Tp.nu(function(n){var e=V.curry(_p,r);Cr.set(r,$p,e());var t=Math.abs(i-e()),o=Math.ceil(t/10);Gp.animate(e,i,o,function(n,e){gm(r,$p)!==r.dom().scrollTop?e(r.dom().scrollTop):(r.dom().scrollTop=n,Cr.set(r,$p,n))},function(){r.dom().scrollTop=i,Cr.set(r,$p,i),n(i)},10)})},Jp=function(i,u){return Tp.nu(function(n){var e=V.curry(qp,i),t=function(n){cu.set(i,"top",n+"px")},o=Math.abs(u-e()),r=Math.ceil(o/10);Gp.animate(e,u,r,t,function(){t(u),n(u)},10)})},Qp=function(e,t,o){var r=dt.owner(e).dom().defaultView;return Tp.nu(function(n){Kp(e,o),Kp(t,o),r.scrollTo(0,o),n(o)})},Zp=function(n,e,t,o,r){var i=Mp(e,t),u=V.curry(pp,n);i<o||i<r?Yp(e,e.dom().scrollTop-i+r).get(u):o<0&&Yp(e,e.dom().scrollTop+o).get(u)},nh=function(u,n){return n(function(o){var r=[],i=0;0===u.length?o([]):Gn.each(u,function(n,e){var t;n.get((t=e,function(n){r[t]=n,++i>=u.length&&o(r)}))})})},eh=function(n){return nh(n,Tp.nu)},th=function(n,c){return n.fold(function(n,e,t){return o=n,r=e,u=c+(i=t),cu.set(o,r,u+"px"),Tp.pure(i);var o,r,i,u},function(n,e){return t=n,r=c+(o=e),i=cu.getRaw(t,"top").getOr(o),u=r-parseInt(i,10),a=t.dom().scrollTop+u,Xp(t,a,r);var t,o,r,i,u,a})},oh=function(n,e){var t=Pp(n),o=Gn.map(t,function(n){return th(n,e)});return eh(o)},rh=function(e,t,n,o,r,i){var u,a,c=(u=function(n){return Qp(e,t,n)},a=Gr(wp.pure({})),{start:function(e){var n=wp.nu(function(n){return u(e).get(n)});a.set(n)},idle:function(n){a.get().get(function(){n()})}}),s=yg(function(){c.idle(function(){oh(n,o.pageYOffset).get(function(){var n;(n=Km.getRectangles(i),K.from(n[0]).bind(function(n){var e=n.top()-t.dom().scrollTop;return e>o.innerHeight+5||e<-5?K.some({top:V.constant(e),bottom:V.constant(e+n.height())}):K.none()})).each(function(n){t.dom().scrollTop=t.dom().scrollTop+n.top()}),c.start(0),r.refresh()})})},1e3),f=rm.bind(Ae.fromDom(o),"scroll",function(){o.pageYOffset<0||s.throttle()});return oh(n,o.pageYOffset).get(V.identity),{unbind:f.unbind}},ih=function(n){var t=n.cWin(),e=n.ceBody(),o=n.socket(),r=n.toolstrip(),i=n.toolbar(),u=n.contentElement(),a=n.keyboardType(),c=n.outerWindow(),s=n.dropup(),f=Wp(o,e,r,s),l=a(n.outerBody(),t,Ge.body(),u,r,i),d=am(c,{onChange:V.noop,onReady:f.refresh});d.onAdjustment(function(){f.refresh()});var m=rm.bind(Ae.fromDom(c),"resize",function(){f.isExpanding()&&f.refresh()}),g=rh(r,o,n.outerBody(),c,f,t),p=function(t,e){var n=t.document,o=Ae.fromTag("div");zr.add(o,Yi.resolve("unfocused-selections")),pt.append(Ae.fromDom(n.documentElement),o);var r=rm.bind(o,"touchstart",function(n){n.prevent(),hp.resume(t,e),u()}),i=function(n){var e=Ae.fromTag("span");return $l.add(e,[Yi.resolve("layer-editor"),Yi.resolve("unfocused-selection")]),cu.setAll(e,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),e},u=function(){bt.empty(o)};return{update:function(){u();var n=Km.getRectangles(t),e=Gn.map(n,i);ht.append(o,e)},isActive:function(){return 0<dt.children(o).length},destroy:function(){r.unbind(),bt.remove(o)},clear:u}}(t,u),h=function(){p.clear()};return{toEditing:function(){l.toEditing(),h()},toReading:function(){l.toReading()},onToolbarTouch:function(n){l.onToolbarTouch(n)},refreshSelection:function(){p.isActive()&&p.update()},clearSelection:h,highlightSelection:function(){p.update()},scrollIntoView:function(n,e){Zp(t,o,s,n,e)},updateToolbarPadding:V.noop,setViewportOffset:function(n){f.setViewportOffset(n),Jp(o,n).get(V.identity)},syncHeight:function(){cu.set(u,"height",u.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:f.refresh,destroy:function(){f.restore(),d.destroy(),g.unbind(),m.unbind(),l.destroy(),p.destroy(),gp(Ge.body(),Qr)}}},uh=function(o,n){var r=hg(),i=hl.value(),u=hl.value(),a=hl.api(),c=hl.api();return{enter:function(){n.hide();var t=Ae.fromDom(document);sg.getActiveApi(o.editor).each(function(n){i.set({socketHeight:cu.getRaw(o.socket,"height"),iframeHeight:cu.getRaw(n.frame(),"height"),outerScroll:document.body.scrollTop}),u.set({exclusives:Ig.exclusive(t,"."+Vd.scrollable())}),zr.add(o.container,Yi.resolve("fullscreen-maximized")),gg(o.container,n.body()),r.maximize(),cu.set(o.socket,"overflow","scroll"),cu.set(o.socket,"-webkit-overflow-scrolling","touch"),Jr(n.body());var e=_e.immutableBag(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);a.set(ih(e({cWin:n.win(),ceBody:n.body(),socket:o.socket,toolstrip:o.toolstrip,toolbar:o.toolbar,dropup:o.dropup.element(),contentElement:n.frame(),cursor:V.noop,outerBody:o.body,outerWindow:o.win,keyboardType:vp.stubborn,isScrolling:function(){return u.get().exists(function(n){return n.socket.isScrolling()})}}))),a.run(function(n){n.syncHeight()}),c.set(bp(n,a,o.toolstrip,o.socket,o.dropup))})},refreshStructure:function(){a.run(function(n){n.refreshStructure()})},exit:function(){r.restore(),c.clear(),a.clear(),n.show(),i.on(function(n){n.socketHeight.each(function(n){cu.set(o.socket,"height",n)}),n.iframeHeight.each(function(n){cu.set(o.editor.getFrame(),"height",n)}),document.body.scrollTop=n.scrollTop}),i.clear(),u.on(function(n){n.exclusives.unbind()}),u.clear(),zr.remove(o.container,Yi.resolve("fullscreen-maximized")),pg(),Vd.deregister(o.toolbar),cu.remove(o.socket,"overflow"),cu.remove(o.socket,"-webkit-overflow-scrolling"),Qr(o.editor.getFrame()),sg.getActiveApi(o.editor).each(function(n){n.clearSelection()})}}},ah={produce:function(n){var e=So("Getting IosWebapp schema",xg,n);cu.set(e.toolstrip,"width","100%"),cu.set(e.container,"position","relative");var t=ed(wg(function(){e.setReadOnly(e.readOnlyOnInit()),o.enter()},e.translate));e.alloy.add(t);var o=uh(e,{show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}});return{setReadOnly:e.setReadOnly,refreshStructure:o.refreshStructure,enter:o.enter,exit:o.exit,destroy:V.noop}}},ch=tinymce.util.Tools.resolve("tinymce.EditorManager"),sh=function(n){var e=qt(n.settings,"skin_url").fold(function(){return ch.baseURL+"/skins/lightgray"},function(n){return n});return{content:e+"/content.mobile.min.css",ui:e+"/skin.mobile.min.css"}},fh=function(n,e,t){n.system().broadcastOn([ri.formatChanged()],{command:e,state:t})},lh=function(t,n){var e=nn.keys(n.formatter.get());Gn.each(e,function(e){n.formatter.formatChanged(e,function(n){fh(t,e,n)})}),Gn.each(["ul","ol"],function(e){n.selection.selectorChanged(e,function(n){fh(t,e,n)})})},dh=(V.constant(["x-small","small","medium","large","x-large"]),function(n){var e=function(){n._skinLoaded=!0,n.fire("SkinLoaded")};return function(){n.initialized?e():n.on("init",e)}}),mh=V.constant("toReading"),gh=V.constant("toEditing");ti.add("mobile",function(C){return{getNotificationManagerImpl:function(){return{open:V.identity,close:V.noop,reposition:V.noop,getArgs:V.identity}},renderUI:function(n){var e=sh(C);0==(!1===C.settings.skin)?(C.contentCSS.push(e.content),ei.DOM.styleSheetLoader.load(e.ui,dh(C))):dh(C)();var t,o,r,i,u,a,c,s,f,l,d,m,g,p,h=function(){C.fire("scrollIntoView")},v=Ae.fromTag("div"),b=fe.detect().os.isAndroid()?(s=h,f=E({classes:[Yi.resolve("android-container")]}),l=O(),d=hl.api(),m=Vg.makeEditSwitch(d),g=Vg.makeSocket(),p=Qg(V.noop,s),f.add(l.wrapper()),f.add(g),f.add(p.component()),{system:V.constant(f),element:f.element,init:function(n){d.set(Sg.produce(n))},exit:function(){d.run(function(n){n.exit(),xd.remove(g,m)})},setToolbarGroups:function(n){var e=l.createGroups(n);l.setGroups(e)},setContextToolbar:function(n){var e=l.createGroups(n);l.setContextToolbar(e)},focusToolbar:function(){l.focus()},restoreToolbar:function(){l.restoreToolbar()},updateMode:function(n){Vg.updateMode(g,m,n,f.root())},socket:V.constant(g),dropup:V.constant(p)}):(t=h,o=E({classes:[Yi.resolve("ios-container")]}),r=O(),i=hl.api(),u=Vg.makeEditSwitch(i),a=Vg.makeSocket(),c=Qg(function(){i.run(function(n){n.refreshStructure()})},t),o.add(r.wrapper()),o.add(a),o.add(c.component()),{system:V.constant(o),element:o.element,init:function(n){i.set(ah.produce(n))},exit:function(){i.run(function(n){xd.remove(a,u),n.exit()})},setToolbarGroups:function(n){var e=r.createGroups(n);r.setGroups(e)},setContextToolbar:function(n){var e=r.createGroups(n);r.setContextToolbar(e)},focusToolbar:function(){r.focus()},restoreToolbar:function(){r.restoreToolbar()},updateMode:function(n){Vg.updateMode(a,u,n,o.root())},socket:V.constant(a),dropup:V.constant(c)}),y=Ae.fromDom(n.targetNode);pt.after(y,v),function(n,e){pt.append(n,e.element());var t=dt.children(e.element());Gn.each(t,function(n){e.getByDom(n).each(wt)})}(v,b.system());var w=n.targetNode.ownerDocument.defaultView,x=am(w,{onChange:function(){b.system().broadcastOn([ri.orientationChanged()],{width:cm(w)})},onReady:V.noop}),S=function(n,e,t,o){!1===o&&C.selection.collapse();var r=T(n,e,t);b.setToolbarGroups(!0===o?r.readOnly:r.main),C.setMode(!0===o?"readonly":"design"),C.fire(!0===o?mh():gh()),b.updateMode(o)},T=function(n,e,t){var o=n.get();return{readOnly:o.backToMask.concat(e.get()),main:o.backToMask.concat(t.get())}},k=function(n,e){return C.on(n,e),{unbind:function(){C.off(n)}}};return C.on("init",function(){b.init({editor:{getFrame:function(){return Ae.fromDom(C.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:V.noop}},onToReading:function(n){return k(mh(),n)},onToEditing:function(n){return k(gh(),n)},onScrollToCursor:function(e){return C.on("scrollIntoView",function(n){e(n)}),{unbind:function(){C.off("scrollIntoView"),x.destroy()}}},onTouchToolstrip:function(){e()},onTouchContent:function(){var n;(n=Ae.fromDom(C.editorContainer.querySelector("."+Yi.resolve("toolbar"))),ni(n).bind(function(n){return b.system().getByDom(n).toOption()})).each(Oe),b.restoreToolbar(),e()},onTapContent:function(n){var e=n.target();"img"===Pe.name(e)?(C.selection.select(e.dom()),n.kill()):"a"===Pe.name(e)&&b.system().getByDom(Ae.fromDom(C.editorContainer)).each(function(n){Ur.isAlpha(n)&&oi(e.dom())})}},container:Ae.fromDom(C.editorContainer),socket:Ae.fromDom(C.contentAreaContainer),toolstrip:Ae.fromDom(C.editorContainer.querySelector("."+Yi.resolve("toolstrip"))),toolbar:Ae.fromDom(C.editorContainer.querySelector("."+Yi.resolve("toolbar"))),dropup:b.dropup(),alloy:b.system(),translate:V.noop,setReadOnly:function(n){S(c,a,u,n)},readOnlyOnInit:function(){return!1}});var e=function(){b.dropup().disappear(function(){b.system().broadcastOn([ri.dropupDismissed()],{})})},n={label:"The first group",scrollable:!1,items:[Ms.forToolbar("back",function(){C.selection.collapse(),b.exit()},{})]},t={label:"Back to read only",scrollable:!1,items:[Ms.forToolbar("readonly-back",function(){S(c,a,u,!0)},{})]},o=Yd(b,C),r=Jd(C.settings,o),i={label:"The extra group",scrollable:!1,items:[]},u=Gr([{label:"the action group",scrollable:!0,items:r},i]),a=Gr([{label:"The read only mode group",scrollable:!0,items:[]},i]),c=Gr({backToMask:[n],backToReadOnly:[t]});lh(b,C)}),{iframeContainer:b.socket().element().dom(),editorContainer:b.element().dom()}}}})}();